<html lang="pt-BR">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Visualizar Registros</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .dark-mode {
            background-color: #1a202c;
            color: #cbd5e0;
        }
        .dark-mode .bg-white {
            background-color: #2d3748;
        }
        .dark-mode .text-orange-500 {
            color: #f6ad55;
        }
        .dark-mode .bg-gradient-to-r {
            background: linear-gradient(to right, #9f7aea, #d53f8c);
        }
        .dark-mode .text-gray-800 {
            color: #e2e8f0;
        }
        .dark-mode .text-gray-600 {
            color: #a0aec0;
        }
        .dark-mode .border-gray-300 {
            border-color: #4a5568;
        }
    </style>
</head>
<body class="bg-orange-500 flex flex-col items-center min-h-screen">
    <nav class="bg-white w-full py-4 shadow-md flex justify-between items-center px-4">
        <h1 class="text-2xl font-bold text-orange-500">Caixinha de Histórias</h1>
        <button id="theme-toggle" class="text-orange-500 focus:outline-none">
            <i id="theme-icon" class="fas fa-sun text-2xl"></i>
        </button>
    </nav>
    <div class="container mx-auto px-4 py-4">
        <div class="flex flex-col items-center space-y-4">
            <input type="text" placeholder="Pesquisar histórias..." class="w-full max-w-md p-2 border border-gray-300 rounded-md"/>
            <div id="message-counter" class="text-white text-lg font-bold"></div>
        </div>
    </div>
    <div id="registros-container" class="space-y-4 container mx-auto px-4 py-4"></div>
    <script>
        const url = "https://script.google.com/macros/s/AKfycbz8kSNNEv8_wAkIJoyH0An2eagian11eWQztsmLNevOQh5rXm2wlbM-2uNF_aS4vnO8pg/exec?view=all";

        function timeAgo(date) {
            const now = new Date();
            const seconds = Math.floor((now - new Date(date)) / 1000);
            let interval = Math.floor(seconds / 31536000);
            if (interval > 1) return interval + "a atrás";
            interval = Math.floor(seconds / 2592000);
            if (interval > 1) return interval + "m atrás";
            interval = Math.floor(seconds / 86400);
            if (interval > 1) return interval + "d atrás";
            interval = Math.floor(seconds / 3600);
            if (interval > 1) return interval + "h atrás";
            interval = Math.floor(seconds / 60);
            if (interval > 1) return interval + "min atrás";
            return Math.floor(seconds) + "s atrás";
        }

        async function fetchData() {
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data;
            } catch (err) {
                console.error("Erro ao carregar registros:", err);
                return [];
            }
        }

        function createCard(registro) {
            const card = document.createElement("div");
            card.className = "bg-white rounded-lg shadow-lg max-w-xs mx-auto";

            const header = document.createElement("div");
            header.className = "bg-gradient-to-r from-pink-500 to-purple-500 rounded-t-lg p-3";
            header.innerHTML = `
                <div class="flex justify-between items-center">
                    <div class="flex space-x-1">
                        <div class="w-1 h-1 bg-white rounded-full"></div>
                        <div class="w-1 h-1 bg-white rounded-full"></div>
                        <div class="w-1 h-1 bg-white rounded-full"></div>
                    </div>
                    <div class="text-white text-sm font-bold mx-auto">Mande sua história!!</div>
                    <i class="bi bi-chat-right-text-fill text-white text-sm"></i>
                </div>
            `;
            card.appendChild(header);

            const content = document.createElement("div");
            content.className = "p-3";
            content.innerHTML = `
                <div class="flex items-start mb-2">
                    <svg class="w-4 h-4 mr-2 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-languages">
                        <path d="m5 8 6 6"/>
                        <path d="m4 14 6-6 2-3"/>
                        <path d="M2 5h12"/>
                        <path d="M7 2h1"/>
                        <path d="m22 22-5-10-5 10"/>
                        <path d="M14 18h6"/>
                    </svg>
                    <p class="text-gray-800 text-sm flex-grow">${registro.historia}</p>
                </div>
                <div class="flex items-center mb-2">
                    <svg class="w-6 h-6 mr-2" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user-round-check">
                        <path d="M2 21a8 8 0 0 1 13.292-6"/>
                        <circle cx="10" cy="8" r="5"/>
                        <path d="m16 19 2 2 4-4"/>
                    </svg>
                    <div class="bg-purple-800 text-white rounded-full px-2 py-1">
                        <p class="text-xs font-bold">${registro.nome}</p>
                    </div>
                </div>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-gray-600 text-xs">${timeAgo(registro.dataHora)}</span>
                </div>
                <hr class="border-gray-300 mb-2"/>
                <div class="text-center text-gray-600 text-xs flex items-center justify-between">
                    <div class="flex items-center space-x-1">
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pill">
                            <path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"></path>
                            <path d="m8.5 8.5 7 7"></path>
                        </svg>
                        <span class="font-bold">Neext Story</span>
                    </div>
                    <div class="flex space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-infinity">
                                <path d="M6 16c5 0 7-8 12-8a4 4 0 0 1 0 8c-5 0-7-8-12-8a4 4 0 1 0 0 8"></path>
                            </svg>
                        </div>
                        <div class="w-8 h-8 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chrome">
                                <circle cx="12" cy="12" r="10"/>
                                <circle cx="12" cy="12" r="4"/>
                                <line x1="21.17" x2="12" y1="8" y2="8"/>
                                <line x1="3.95" x2="8.54" y1="6.06" y2="14"/>
                                <line x1="10.88" x2="15.46" y1="21.94" y2="14"/>
                            </svg>
                        </div>
                        <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-teal-500 rounded-full flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-flask-round">
                                <path d="M10 2v6.292a7 7 0 1 0 4 0V2"></path>
                                <path d="M5 15h14"></path>
                                <path d="M8.5 2h7"></path>
                            </svg>
                        </div>
                        <div class="w-8 h-8 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-gift">
                                <rect x="3" y="8" width="18" height="4" rx="1"/>
                                <path d="M12 8v13"/>
                                <path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/>
                                <path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/>
                            </svg>
                        </div>
                    </div>
                </div>
            `;
            card.appendChild(content);
            return card;
        }

        async function renderCards() {
            const container = document.getElementById("registros-container");
            const data = await fetchData();
            const fragment = document.createDocumentFragment();

            data.forEach(registro => {
                const card = createCard(registro);
                fragment.appendChild(card);
            });

            container.appendChild(fragment);

            // Atualiza o contador de mensagens
            const messageCounter = document.getElementById("message-counter");
            messageCounter.textContent = `Total de mensagens: ${data.length}`;
        }

        document.addEventListener("DOMContentLoaded", renderCards);

        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');

        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
            } else {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
        });
    </script>
</body>
</html>