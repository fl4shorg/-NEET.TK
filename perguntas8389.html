<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zen Gradient Inbox</title>
  <meta name="description" content="Anonymous messaging inbox application" />
  <meta name="author" content="Lovable" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap">

  <meta property="og:title" content="Zen Gradient Inbox" />
  <meta property="og:description" content="Anonymous messaging inbox application" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@lovable_dev" />
  <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  <style>
    /* Base Styles */
    :root {
      --background: 0 0% 100%;
      --foreground: 222.2 84% 4.9%;
      --card: 0 0% 100%;
      --card-foreground: 222.2 84% 4.9%;
      --popover: 0 0% 100%;
      --popover-foreground: 222.2 84% 4.9%;
      --primary: 222.2 47.4% 11.2%;
      --primary-foreground: 210 40% 98%;
      --secondary: 210 40% 96.1%;
      --secondary-foreground: 222.2 47.4% 11.2%;
      --muted: 210 40% 96.1%;
      --muted-foreground: 215.4 16.3% 46.9%;
      --accent: 210 40% 96.1%;
      --accent-foreground: 222.2 47.4% 11.2%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 210 40% 98%;
      --border: 214.3 31.8% 91.4%;
      --input: 214.3 31.8% 91.4%;
      --ring: 222.2 84% 4.9%;
      --radius: 0.5rem;

      /* Gradient variables */
      --gradient-purple-from: 271 91% 65%;
      --gradient-purple-to: 262 83% 58%;
      --gradient-blue-from: 217 91% 60%;
      --gradient-blue-to: 199 89% 48%;
      --gradient-pink-from: 336 80% 58%;
      --gradient-pink-to: 345 83% 41%;
      --gradient-green-from: 142 71% 45%;
      --gradient-green-to: 160 84% 39%;
      --gradient-orange-from: 27 96% 61%;
      --gradient-orange-to: 43 96% 50%;
      
      /* Custom gradient variables */
      --custom-gradient: linear-gradient(90deg, #7c3aed 0%, #2563eb 100%);
      --custom-gradient-text: #ffffff;
    }

    .dark {
      --background: 222.2 84% 4.9%;
      --foreground: 210 40% 98%;
      --card: 222.2 84% 4.9%;
      --card-foreground: 210 40% 98%;
      --popover: 222.2 84% 4.9%;
      --popover-foreground: 210 40% 98%;
      --primary: 210 40% 98%;
      --primary-foreground: 222.2 47.4% 11.2%;
      --secondary: 217.2 32.6% 17.5%;
      --secondary-foreground: 210 40% 98%;
      --muted: 217.2 32.6% 17.5%;
      --muted-foreground: 215 20.2% 65.1%;
      --accent: 217.2 32.6% 17.5%;
      --accent-foreground: 210 40% 98%;
      --destructive: 0 62.8% 30.6%;
      --destructive-foreground: 210 40% 98%;
      --border: 217.2 32.6% 17.5%;
      --input: 217.2 32.6% 17.5%;
      --ring: 212.7 26.8% 83.9%;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      transition: background-color 0.3s, color 0.3s;
    }

    .app {
      max-width: 430px;
      margin: 0 auto;
      min-height: 100vh;
      position: relative;
    }

    .dark .app {
      background-color: rgb(24, 24, 27);
    }

    /* Header Styles */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
      border-bottom: 1px solid hsl(var(--border));
    }

    .dark header {
      border-bottom-color: hsl(var(--border));
    }

    header h2 {
      font-weight: 800;
      font-size: 1.25rem;
      text-align: center;
      color: hsl(var(--foreground));
    }

    .header-left {
      display: flex;
      align-items: center;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .gradient-circle {
      width: 2rem;
      height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      margin-right: 0.75rem;
    }

    .icon-button {
      background-color: hsl(var(--secondary));
      border-radius: 50%;
      width: 2rem;
      height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      color: hsl(var(--foreground));
      transition: background-color 0.2s;
    }

    .dark .icon-button {
      color: hsl(var(--foreground));
    }

    .icon-button:hover {
      background-color: hsl(var(--accent));
    }

    /* Main Content */
    main {
      padding: 1rem;
      padding-bottom: 5rem;
    }

    /* Message Card */
    .message-card {
      background-color: hsl(var(--card));
      border-radius: 1rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
      overflow: hidden;
      border: 1px solid hsl(var(--border));
      width: 100%;
      max-width: 24rem;
      margin-left: auto;
      margin-right: auto;
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-10px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .message-header {
      background: var(--custom-gradient);
      color: var(--custom-gradient-text);
      font-weight: 700;
      font-size: 1.25rem;
      padding: 1rem;
      text-align: center;
      line-height: 1.2;
      user-select: text;
    }

    .message-content {
      padding: 1.5rem;
      text-align: center;
      font-size: 1.125rem;
      font-weight: 600;
      color: hsl(var(--card-foreground));
      line-height: 1.4;
      user-select: text;
    }

    .message-actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      padding: 1rem;
      align-items: center;
    }

    .action-button {
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
      cursor: pointer;
      border: none;
      outline-offset: 2px;
      background: none;
      color: white;
      position: relative;
    }

    .action-button:focus-visible {
      outline: 2px solid #8B5CF6;
      outline-offset: 2px;
    }

    .action-button:hover {
      transform: scale(1.05);
    }

    .action-button.info {
      background: var(--custom-gradient);
    }

    .action-button.share {
      background: linear-gradient(135deg, #dc2626, #b91c1c);
    }

    .action-button.arrow {
      background-color: #22c55e;
    }

    .action-button.other {
      background-color: #f97316;
    }

    /* Bottom Navigation */
    .bottom-nav {
      background-color: hsl(var(--background));
      border-top: 1px solid hsl(var(--border));
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      max-width: 430px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 2.5rem;
      margin: 0 auto;
      z-index: 10;
    }

    .dark .bottom-nav {
      background-color: rgb(24, 24, 27);
      border-top-color: hsl(var(--border));
    }

    .nav-button {
      color: hsl(var(--muted-foreground));
      padding: 0.5rem;
      border-radius: 0.5rem;
      transition: all 0.2s;
      border: none;
      background: transparent;
      cursor: pointer;
      position: relative;
    }

    .nav-button.active::after {
      content: "";
      position: absolute;
      bottom: -6px;
      left: 0;
      right: 0;
      height: 3px;
      border-radius: 9999px;
      background: var(--custom-gradient);
    }

    .btn-gradient {
      background: var(--custom-gradient);
      color: var(--custom-gradient-text);
      padding: 1rem;
      border-radius: 50%;
      margin-top: -2rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: box-shadow 0.2s;
      border: none;
      cursor: pointer;
    }

    .btn-gradient:hover {
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
    }

    .btn-secondary {
      background-color: hsl(var(--secondary));
      color: hsl(var(--secondary-foreground));
    }

    /* Message Item */
    .message-item {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      padding: 0.75rem 1rem;
      border-radius: 9999px;
      transition: all 0.2s;
      border: 1px solid transparent;
      margin-bottom: 0.5rem;
      cursor: pointer;
    }

    .message-item:hover {
      background-color: hsl(var(--secondary));
    }

    .message-item.active {
      background-color: #f87171; /* red-400 */
      color: white;
      border-color: #ef4444; /* red-500 */
    }

    .dark .message-item.active {
      background-color: #b91c1c; /* red-700 */
      border-color: #dc2626; /* red-600 */
    }

    .message-item .avatar {
      background-color: hsl(var(--secondary));
      border-radius: 50%;
      padding: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .message-item img {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      object-fit: cover;
    }

    .message-item .text-group {
      flex-grow: 1;
      overflow: hidden;
    }

    .message-item .title {
      font-weight: 700;
      font-size: 1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .message-item .subtitle {
      font-size: 0.875rem;
      color: hsl(var(--muted-foreground));
    }

    .message-item.active .subtitle {
      color: rgba(255, 255, 255, 0.8);
    }

    .message-item .chevron {
      color: hsl(var(--muted-foreground));
    }

    .message-item.active .chevron {
      color: rgba(255, 255, 255, 0.8);
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
      margin-top: 2rem;
    }

    .pagination button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 0.5rem;
      border: 1px solid hsl(var(--border));
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      cursor: pointer;
      transition: all 0.2s;
    }

    .pagination button:hover:not(:disabled) {
      background-color: hsl(var(--accent));
    }

    .pagination button.active {
      background-color: hsl(var(--accent));
      color: hsl(var(--accent-foreground));
      font-weight: 600;
    }

    .pagination button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Loading skeletons */
    .skeleton {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      background-color: hsl(var(--secondary));
      border-radius: 0.375rem;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: .5;
      }
    }

    .skeleton-item {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      align-items: center;
    }

    .skeleton-circle {
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
    }

    .skeleton-line {
      height: 1rem;
      width: 100%;
    }

    .skeleton-line-short {
      width: 60%;
      margin-top: 0.5rem;
    }

    /* Gradient Picker */
    .gradient-picker {
      position: relative;
    }

    .gradient-picker-button {
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .gradient-picker-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background-color: hsl(var(--background));
      border: 1px solid hsl(var(--border));
      border-radius: 0.5rem;
      padding: 0.5rem;
      margin-top: 0.5rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      display: none;
      z-index: 50;
    }

    .gradient-picker-dropdown.show {
      display: block;
    }

    .gradient-option {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      margin: 0.25rem;
      cursor: pointer;
      border: 2px solid transparent;
      display: inline-block;
    }

    .gradient-option.active {
      border-color: white;
      box-shadow: 0 0 0 2px hsl(var(--primary));
    }

    /* Custom Gradient Picker */
    .custom-gradient-picker {
      padding: 1rem;
      border-top: 1px solid hsl(var(--border));
      margin-top: 0.5rem;
    }

    .custom-gradient-picker h4 {
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
      color: hsl(var(--foreground));
    }

    .color-inputs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .color-input {
      flex: 1;
    }

    .color-input input {
      width: 100%;
      height: 1.5rem;
      border: none;
      padding: 0;
      background: transparent;
    }

    .color-input label {
      display: block;
      font-size: 0.75rem;
      margin-bottom: 0.25rem;
      color: hsl(var(--muted-foreground));
    }

    .apply-button {
      width: 100%;
      padding: 0.5rem;
      border: none;
      background: var(--custom-gradient);
      color: white;
      border-radius: 0.25rem;
      font-weight: 500;
      cursor: pointer;
      margin-top: 0.5rem;
    }

    .apply-button:hover {
      opacity: 0.9;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease-in-out;
    }

    .modal-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-content {
      background-color: hsl(var(--background));
      border-radius: 0.5rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 400px;
      padding: 1.5rem;
      transform: scale(0.95);
      transition: transform 0.2s ease-in-out;
    }

    .modal-overlay.active .modal-content {
      transform: scale(1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .modal-header h3 {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: hsl(var(--foreground));
    }

    .no-messages {
      text-align: center;
      padding: 2rem 0;
      color: hsl(var(--muted-foreground));
    }

    /* Custom Gradient Dialog */
    .gradient-dialog {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease-in-out;
    }

    .gradient-dialog.active {
      opacity: 1;
      pointer-events: auto;
    }

    .gradient-dialog-content {
      background-color: hsl(var(--background));
      border-radius: 0.5rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 400px;
      padding: 1.5rem;
      transform: scale(0.95);
      transition: transform 0.2s ease-in-out;
    }

    .gradient-dialog.active .gradient-dialog-content {
      transform: scale(1);
    }
    
    .gradient-preview {
      height: 6rem;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .angle-control {
      margin-bottom: 1rem;
    }
    
    .angle-control label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    
    .angle-control input {
      width: 100%;
    }
    
    .separator {
      height: 1px;
      background-color: hsl(var(--border));
      margin: 1rem 0;
    }
    
    .colors-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .color-stop {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .color-preview {
      width: 2rem;
      height: 2rem;
      border-radius: 0.25rem;
      border: 1px solid hsl(var(--border));
    }
    
    .color-input-group {
      flex: 1;
      display: flex;
      gap: 0.5rem;
    }
    
    .position-input {
      width: 4rem;
    }
    
    .add-color-button {
      padding: 0.25rem 0.5rem;
      background-color: hsl(var(--secondary));
      color: hsl(var(--secondary-foreground));
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.875rem;
    }
    
    .remove-color-button {
      background: none;
      border: none;
      color: hsl(var(--muted-foreground));
      cursor: pointer;
      padding: 0.25rem;
    }
    
    .save-button-container {
      display: flex;
      justify-content: flex-end;
      margin-top: 1rem;
    }
    
    .save-gradient-button {
      padding: 0.5rem 1rem;
      background: var(--custom-gradient);
      color: white;
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
  </style>
</head>
<body>
  <div id="app" class="app">
    <!-- App content will be rendered here -->
  </div>

  <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
  <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
  
  <script>
    // Main application state
    const state = {
      currentView: 'inbox', // inbox, messages, profile
      theme: localStorage.getItem('theme') || 'light', // light, dark
      gradientTheme: localStorage.getItem('gradientTheme') || 'purple', // purple, blue, pink, green, orange
      customGradient: localStorage.getItem('customGradient') || { from: '#7c3aed', to: '#2563eb', textColor: '#ffffff' },
      messages: [],
      expandedIndex: null,
      loading: true,
      showGradientPicker: false,
      currentPage: 1,
      totalPages: 1,
      pageSize: 10,
      gradientColors: [
        { color: "#7c3aed", position: 0 },
        { color: "#2563eb", position: 100 }
      ],
      gradientAngle: 90,
      showGradientDialog: false
    };
    
    // Apply initial theme
    document.body.classList.toggle('dark', state.theme === 'dark');
    
    // Update the custom gradient variables
    function updateCustomGradient(colors, angle, textColor) {
      const sortedColors = [...colors].sort((a, b) => a.position - b.position);
      const gradientStr = `linear-gradient(${angle}deg, ${sortedColors.map(c => `${c.color} ${c.position}%`).join(', ')})`;
      
      document.documentElement.style.setProperty('--custom-gradient', gradientStr);
      document.documentElement.style.setProperty('--custom-gradient-text', textColor);
      
      // Save to state and localStorage
      state.customGradient = { colors: sortedColors, angle, textColor };
      localStorage.setItem('customGradient', JSON.stringify({ colors: sortedColors, angle, textColor }));
    }
    
    // Load custom gradient from localStorage if available
    function loadCustomGradient() {
      try {
        const savedGradient = localStorage.getItem('customGradient');
        if (savedGradient) {
          const parsed = JSON.parse(savedGradient);
          if (parsed.colors) {
            state.gradientColors = parsed.colors;
            state.gradientAngle = parsed.angle || 90;
            updateCustomGradient(parsed.colors, parsed.angle || 90, parsed.textColor || '#ffffff');
          } else if (parsed.from) {
            // Legacy format support
            state.gradientColors = [
              { color: parsed.from, position: 0 },
              { color: parsed.to, position: 100 }
            ];
            updateCustomGradient(state.gradientColors, 90, parsed.textColor || '#ffffff');
          }
        }
      } catch (error) {
        console.error("Error loading custom gradient:", error);
      }
    }
    
    // Initialize the custom gradient
    loadCustomGradient();
    
    // Predefined gradient themes
    const gradientThemes = {
      purple: { colors: [{ color: 'hsl(271, 91%, 65%)', position: 0 }, { color: 'hsl(262, 83%, 58%)', position: 100 }], textColor: '#ffffff' },
      blue: { colors: [{ color: 'hsl(217, 91%, 60%)', position: 0 }, { color: 'hsl(199, 89%, 48%)', position: 100 }], textColor: '#ffffff' },
      pink: { colors: [{ color: 'hsl(336, 80%, 58%)', position: 0 }, { color: 'hsl(345, 83%, 41%)', position: 100 }], textColor: '#ffffff' },
      green: { colors: [{ color: 'hsl(142, 71%, 45%)', position: 0 }, { color: 'hsl(160, 84%, 39%)', position: 100 }], textColor: '#ffffff' },
      orange: { colors: [{ color: 'hsl(27, 96%, 61%)', position: 0 }, { color: 'hsl(43, 96%, 50%)', position: 100 }], textColor: '#ffffff' }
    };
    
    // Apply a predefined gradient theme
    function setGradientTheme(themeName) {
      if (gradientThemes[themeName]) {
        const { colors, textColor } = gradientThemes[themeName];
        state.gradientColors = colors;
        updateCustomGradient(colors, state.gradientAngle, textColor);
        state.gradientTheme = themeName;
        localStorage.setItem('gradientTheme', themeName);
      }
      
      toggleGradientPicker(false);
      renderApp();
    }
    
    // Toggle the gradient picker dropdown
    function toggleGradientPicker(forceState = null) {
      if (forceState !== null) {
        state.showGradientPicker = forceState;
      } else {
        state.showGradientPicker = !state.showGradientPicker;
      }
      renderApp();
    }
    
    // Toggle the gradient dialog
    function toggleGradientDialog(forceState = null) {
      if (forceState !== null) {
        state.showGradientDialog = forceState;
      } else {
        state.showGradientDialog = !state.showGradientDialog;
      }
      renderApp();
    }
    
    // Add a new color stop
    function addColorStop() {
      if (state.gradientColors.length >= 10) {
        alert("Você pode adicionar no máximo 10 cores.");
        return;
      }
      
      // Find middle position
      const positions = state.gradientColors.map(c => c.position);
      const min = Math.min(...positions);
      const max = Math.max(...positions);
      const middle = Math.floor((min + max) / 2);
      
      state.gradientColors.push({ color: "#ffffff", position: middle });
      renderApp();
    }
    
    // Remove a color stop
    function removeColorStop(index) {
      if (state.gradientColors.length <= 2) {
        alert("Um gradiente precisa de pelo menos 2 cores.");
        return;
      }
      
      state.gradientColors.splice(index, 1);
      renderApp();
    }
    
    // Update color at index
    function updateColorStop(index, newColor) {
      state.gradientColors[index].color = newColor;
      renderApp();
    }
    
    // Update position at index
    function updateColorPosition(index, newPosition) {
      state.gradientColors[index].position = Math.max(0, Math.min(100, newPosition));
      renderApp();
    }
    
    // Update gradient angle
    function updateGradientAngle(newAngle) {
      state.gradientAngle = newAngle;
      renderApp();
    }
    
    // Apply custom gradient
    function applyCustomGradient() {
      // Determine text color based on luminance
      const getContrastYIQ = (hexcolor) => {
        hexcolor = hexcolor.replace('#', '');
        const r = parseInt(hexcolor.substr(0, 2), 16);
        const g = parseInt(hexcolor.substr(2, 2), 16);
        const b = parseInt(hexcolor.substr(4, 2), 16);
        const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
        return yiq >= 128 ? '#000000' : '#ffffff';
      };
      
      const firstColor = state.gradientColors.sort((a, b) => a.position - b.position)[0].color;
      const textColor = getContrastYIQ(firstColor);
      
      updateCustomGradient(state.gradientColors, state.gradientAngle, textColor);
      toggleGradientDialog(false);
      renderApp();
    }

    // Time formatter utility
    function timeAgo(date) {
      const now = new Date();
      const past = new Date(date);
      const diffInSeconds = Math.floor((now - past) / 1000);

      if (diffInSeconds < 60) {
        return 'Agora mesmo';
      } else if (diffInSeconds < 3600) {
        const minutes = Math.floor(diffInSeconds / 60);
        return `${minutes} ${minutes === 1 ? 'minuto' : 'minutos'} atrás`;
      } else if (diffInSeconds < 86400) {
        const hours = Math.floor(diffInSeconds / 3600);
        return `${hours} ${hours === 1 ? 'hora' : 'horas'} atrás`;
      } else if (diffInSeconds < 604800) {
        const days = Math.floor(diffInSeconds / 86400);
        return `${days} ${days === 1 ? 'dia' : 'dias'} atrás`;
      } else {
        const options = { day: 'numeric', month: 'short' };
        return past.toLocaleDateString('pt-BR', options);
      }
    }

    // Fetch messages from API with pagination
    async function fetchMessages(page = 1, pageSize = 10) {
      try {
        state.loading = true;
        renderApp();
        
        const response = await fetch('https://script.google.com/macros/s/AKfycbyMh9YnzKtxF9Nc_awc9w8KSPyXa4OzXf0iiW748b8-dY4W0SxkoYy77Wcudn7ky9xUJg/exec');
        
        if (!response.ok) {
          throw new Error('Failed to fetch messages');
        }
        
        const data = await response.json();
        
        // Process all messages
        const allMessages = data.perguntas ? data.perguntas.reverse().map((msg, index) => ({
          id: `msg-${index}`,
          pergunta: msg.pergunta,
          data: msg.data
        })) : [];
        
        // Calculate pagination
        state.totalPages = Math.ceil(allMessages.length / pageSize);
        
        // Get current page messages
        const startIndex = (page - 1) * pageSize;
        const endIndex = startIndex + pageSize;
        
        return allMessages.slice(startIndex, endIndex);
      } catch (error) {
        console.error('Error fetching messages:', error);
        alert("Erro ao carregar mensagens. Tente novamente mais tarde.");
        return [];
      } finally {
        state.loading = false;
        renderApp();
      }
    }

    // Toggle theme between light and dark
    function toggleTheme() {
      state.theme = state.theme === 'dark' ? 'light' : 'dark';
      document.body.classList.toggle('dark', state.theme === 'dark');
      localStorage.setItem('theme', state.theme);
      renderApp();
    }

    // Navigate between views
    function navigate(view) {
      state.currentView = view;
      state.expandedIndex = null;
      renderApp();
      
      if (view === 'inbox' || view === 'messages') {
        loadMessages();
      }
    }

    // Toggle message expansion
    function toggleExpand(index) {
      state.expandedIndex = state.expandedIndex === index ? null : index;
      renderApp();
    }

    // Change page
    function changePage(newPage) {
      if (newPage >= 1 && newPage <= state.totalPages) {
        state.currentPage = newPage;
        state.expandedIndex = null;
        loadMessages();
      }
    }

    // Initial app load
    async function loadApp() {
      await loadMessages();
    }

    // Load messages for current page
    async function loadMessages() {
      state.loading = true;
      renderApp();
      state.messages = await fetchMessages(state.currentPage, state.pageSize);
      state.loading = false;
      renderApp();
    }

    // Render the message box
    function renderMessageBox(message = "Sua mensagem anônima aparecerá aqui.") {
      return `
        <div class="message-card">
          <div class="message-header">
            me mande mensagens<br>
            anônimas!
          </div>
          <div class="message-content">
            ${message}
          </div>
          <div class="message-actions">
            <button class="action-button info" title="Info">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-gift">
                <rect x="3" y="8" width="18" height="4" rx="1"/>
                <path d="M12 8v13"/>
                <path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/>
                <path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/>
              </svg>
            </button>
            <button class="action-button share" title="Share">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plug">
                <path d="M12 22v-5"/>
                <path d="M9 8V2"/>
                <path d="M15 8V2"/>
                <path d="M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z"/>
              </svg>
            </button>
            <button class="action-button arrow" title="Arrow">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cannabis">
                <path d="M12 22v-4"/>
                <path d="M7 12c-1.5 0-4.5 1.5-5 3 3.5 1.5 6 1 6 1-1.5 1.5-2 3.5-2 5 2.5 0 4.5-1.5 6-3 1.5 1.5 3.5 3 6 3 0-1.5-.5-3.5-2-5 0 0 2.5.5 6-1-.5-1.5-3.5-3-5-3 1.5-1 4-4 4-6-2.5 0-5.5 1.5-7 3 0-2.5-.5-5-2-7-1.5 2-2 4.5-2 7-1.5-1.5-4.5-3-7-3 0 2 2.5 5 4 6"/>
              </svg>
            </button>
            <button class="action-button other" onclick="toggleGradientDialog()" title="Custom Gradient">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pill-bottle">
                <path d="M18 11h-4a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h4"/>
                <path d="M6 7v13a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7"/>
                <rect width="16" height="5" x="4" y="2" rx="1"/>
              </svg>
            </button>
          </div>
        </div>
      `;
    }

    // Render the custom gradient dialog
    function renderGradientDialog() {
      // If dialog is not active, don't render it
      if (!state.showGradientDialog) return '';
      
      // Sort colors by position
      const sortedColors = [...state.gradientColors].sort((a, b) => a.position - b.position);
      
      // Create gradient string for preview
      const gradientStr = `linear-gradient(${state.gradientAngle}deg, ${sortedColors.map(c => `${c.color} ${c.position}%`).join(', ')})`;
      
      return `
        <div class="gradient-dialog active">
          <div class="gradient-dialog-content">
            <h3 style="margin-bottom: 1rem; font-weight: bold;">Personalizar Gradiente</h3>
            
            <div class="gradient-preview" style="background: ${gradientStr}"></div>
            
            <div class="angle-control">
              <label>Ângulo: ${state.gradientAngle}°</label>
              <input 
                type="range" 
                min="0" 
                max="360" 
                value="${state.gradientAngle}" 
                oninput="updateGradientAngle(this.value)" 
              />
            </div>
            
            <div class="separator"></div>
            
            <div class="colors-header">
              <h4>Cores</h4>
              <button class="add-color-button" onclick="addColorStop()">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 5v14M5 12h14"/>
                </svg>
                Adicionar
              </button>
            </div>
            
            <div class="color-stops-container">
              ${state.gradientColors.map((color, index) => `
                <div class="color-stop">
                  <div class="color-preview" style="background-color: ${color.color}"></div>
                  <div class="color-input-group">
                    <input 
                      type="color" 
                      value="${color.color}" 
                      oninput="updateColorStop(${index}, this.value)" 
                      style="flex: 1; min-width: 0;"
                    />
                    <input 
                      type="number" 
                      value="${color.position}" 
                      min="0" 
                      max="100" 
                      oninput="updateColorPosition(${index}, this.value)" 
                      class="position-input" 
                    />
                    <span>%</span>
                  </div>
                  <button 
                    class="remove-color-button" 
                    onclick="removeColorStop(${index})" 
                    ${state.gradientColors.length <= 2 ? 'disabled' : ''}
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                    </svg>
                  </button>
                </div>
              `).join('')}
            </div>
            
            <div class="save-button-container">
              <button class="save-gradient-button" onclick="applyCustomGradient()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="m16 3 5 5v13a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                  <path d="M17 21v-8H7v8"/>
                  <path d="M7 3v5h8"/>
                </svg>
                Salvar Gradiente
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // Render the message item
    function renderMessageItem(message, index) {
      const isActive = state.expandedIndex === index;
      const timeText = timeAgo(message.data);
      const avatarUrl = 'https://storage.googleapis.com/a1aa/image/e40343bf-df76-4d75-b5e8-5c994ba061d0.jpg';
      
      return `
        <div class="message-item ${isActive ? 'active' : ''}" 
            onclick="toggleExpand(${index})">
          <div class="avatar">
            <img src="${avatarUrl}" alt="Avatar">
          </div>
          <div class="text-group">
            <div class="title">
              ${message.pergunta.length > 20 ? message.pergunta.slice(0, 20) + '...' : message.pergunta}
            </div>
            <div class="subtitle">
              ${timeText}
            </div>
          </div>
          <div class="chevron">
            ${isActive ? 
              '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 15 6-6 6 6"/></svg>' : 
              '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 6 6 6-6 6"/></svg>'
            }
          </div>
        </div>
      `;
    }

    // Render loading skeletons
    function renderSkeletons(count = 3) {
      let skeletons = '';
      for (let i = 0; i < count; i++) {
        skeletons += `
          <div class="skeleton-item">
            <div class="skeleton skeleton-circle"></div>
            <div style="flex-grow: 1;">
              <div class="skeleton skeleton-line"></div>
              <div class="skeleton skeleton-line skeleton-line-short"></div>
            </div>
          </div>
        `;
      }
      return skeletons;
    }

    // Render pagination
    function renderPagination() {
      if (state.totalPages <= 1) return '';
      
      let pagination = '<div class="pagination">';
      
      // Previous button
      pagination += `
        <button 
          ${state.currentPage <= 1 ? 'disabled' : ''} 
          onclick="changePage(${state.currentPage - 1})"
          aria-label="Previous page"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
      `;
      
      // Page numbers
      for (let i = 1; i <= state.totalPages; i++) {
        // Show only relevant page numbers to avoid cluttering the UI
        if (
          i === 1 || 
          i === state.totalPages || 
          (i >= state.currentPage - 1 && i <= state.currentPage + 1)
        ) {
          pagination += `
            <button 
              class="${state.currentPage === i ? 'active' : ''}"
              onclick="changePage(${i})"
              aria-label="Page ${i}"
            >
              ${i}
            </button>
          `;
        } else if (
          (i === 2 && state.currentPage > 3) ||
          (i === state.totalPages - 1 && state.currentPage < state.totalPages - 2)
        ) {
          pagination += '<span>...</span>';
        }
      }
      
      // Next button
      pagination += `
        <button 
          ${state.currentPage >= state.totalPages ? 'disabled' : ''} 
          onclick="changePage(${state.currentPage + 1})"
          aria-label="Next page"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      `;
      
      pagination += '</div>';
      return pagination;
    }

    // Render the gradient picker
    function renderGradientPicker() {
      const gradientOptions = Object.keys(gradientThemes).map(name => {
        const { colors } = gradientThemes[name];
        const isActive = state.gradientTheme === name;
        const from = colors[0].color;
        const to = colors[colors.length - 1].color;
        return `
          <div 
            class="gradient-option ${isActive ? 'active' : ''}"
            style="background-image: linear-gradient(90deg, ${from} 0%, ${to} 100%);"
            onclick="setGradientTheme('${name}')"
            title="${name}"
          ></div>
        `;
      }).join('');
      
      return `
        <div class="gradient-picker">
          <div 
            class="gradient-picker-button"
            style="background-image: var(--custom-gradient);"
            onclick="toggleGradientPicker()"
          ></div>
          <div class="gradient-picker-dropdown ${state.showGradientPicker ? 'show' : ''}">
            <div>
              ${gradientOptions}
            </div>
            <div class="custom-gradient-picker">
              <h4>Gradiente Personalizado</h4>
              <button class="apply-button" onclick="toggleGradientDialog(true)">
                Editar Cores
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // Render the header
    function renderHeader() {
      let icon = '';
      let title = '';
      
      switch (state.currentView) {
        case 'inbox':
          title = 'INBOX';
          break;
        case 'messages':
          title = 'MENSAGENS';
          break;
        case 'profile':
          icon = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>';
          title = 'PERFIL';
          break;
      }
      
      return `
        <header>
          <div class="header-left">
            ${state.currentView === 'profile' ? `
              <div class="gradient-circle" style="background: var(--custom-gradient);">
                ${icon}
              </div>
            ` : ''}
            <h2>${title}</h2>
          </div>
          
          <div class="header-right">
            ${renderGradientPicker()}
            
            <button class="icon-button" onclick="toggleTheme()" aria-label="Toggle theme">
              ${state.theme === 'dark' ? 
                '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>' : 
                '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>'
              }
            </button>
          </div>
        </header>
      `;
    }

    // Render the inbox view
    function renderInbox() {
      let content = '';
      
      if (state.loading) {
        content = renderSkeletons(5);
      } else if (state.messages.length === 0) {
        content = '<p class="no-messages">Nenhuma mensagem encontrada.</p>';
      } else {
        content = state.messages.map((message, index) => {
          let output = renderMessageItem(message, index);
          if (state.expandedIndex === index) {
            output += renderMessageBox(message.pergunta);
          }
          return output;
        }).join('');
        content += renderPagination();
      }

      return content;
    }

    // Render the messages view
    function renderMessages() {
      let content = '';
      
      if (state.loading) {
        content = renderSkeletons(3);
      } else if (state.messages.length === 0) {
        content = '<p class="no-messages">Nenhuma mensagem encontrada.</p>';
      } else {
        content = state.messages.map(message => renderMessageBox(message.pergunta)).join('');
        content += renderPagination();
      }

      return content;
    }

    // Render the profile view
    function renderProfile() {
      return `
        <div style="display: flex; flex-direction: column; align-items: center; padding: 2rem 0;">
          <div style="width: 6rem; height: 6rem; border-radius: 50%; background-image: var(--custom-gradient); display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </div>
          <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.25rem;">Usuário</h2>
          <p style="color: hsl(var(--muted-foreground)); margin-bottom: 1.5rem;">@username</p>
          
          <div class="message-card" style="width: 100%; max-width: 18rem;">
            <div style="padding: 1.5rem;">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div style="text-align: center; padding: 0.75rem; background-color: hsl(var(--secondary)); border-radius: 0.5rem;">
                  <p style="color: hsl(var(--muted-foreground)); font-size: 0.875rem; margin-bottom: 0.25rem;">Mensagens</p>
                  <p style="font-size: 1.5rem; font-weight: 700;">
                    ${state.loading ? '<span style="display: inline-block; width: 3rem; height: 1.5rem;" class="skeleton"></span>' : state.messages.length}
                  </p>
                </div>
                <div style="text-align: center; padding: 0.75rem; background-color: hsl(var(--secondary)); border-radius: 0.5rem;">
                  <p style="color: hsl(var(--muted-foreground)); font-size: 0.875rem; margin-bottom: 0.25rem;">Seguidores</p>
                  <p style="font-size: 1.5rem; font-weight: 700;">0</p>
                </div>
                <div style="text-align: center; padding: 0.75rem; background-color: hsl(var(--secondary)); border-radius: 0.5rem;">
                  <p style="color: hsl(var(--muted-foreground)); font-size: 0.875rem; margin-bottom: 0.25rem;">Seguindo</p>
                  <p style="font-size: 1.5rem; font-weight: 700;">0</p>
                </div>
                <div style="text-align: center; padding: 0.75rem; background-color: hsl(var(--secondary)); border-radius: 0.5rem;">
                  <p style="color: hsl(var(--muted-foreground)); font-size: 0.875rem; margin-bottom: 0.25rem;">Likes</p>
                  <p style="font-size: 1.5rem; font-weight: 700;">0</p>
                </div>
              </div>
            </div>
          </div>
          
          <p style="color: hsl(var(--muted-foreground)); margin-top: 1.5rem;">Mais funcionalidades em breve.</p>
        </div>
      `;
    }

    // Render the bottom navigation
    function renderBottomNav() {
      return `
        <nav class="bottom-nav">
          <button 
            class="nav-button ${state.currentView === 'messages' ? 'active' : ''}"
            onclick="navigate('messages')" 
            aria-label="Messages"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
              <path d="M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"/>
            </svg>
          </button>
          
          <button 
            class="btn-gradient ${state.currentView !== 'inbox' ? 'btn-secondary' : ''}"
            onclick="navigate('inbox')" 
            aria-label="Inbox"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 12h-6l-2 3h-4l-2-3H2"/>
              <path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/>
            </svg>
          </button>
          
          <button 
            class="nav-button ${state.currentView === 'profile' ? 'active' : ''}"
            onclick="navigate('profile')" 
            aria-label="Profile"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
          </button>
        </nav>
      `;
    }

    // Master render function
    function renderApp() {
      const app = document.getElementById('app');
      let content = '';
      
      // Render header
      content += renderHeader();
      
      // Render main content
      content += '<main>';
      switch (state.currentView) {
        case 'inbox':
          content += renderInbox();
          break;
        case 'messages':
          content += renderMessages();
          break;
        case 'profile':
          content += renderProfile();
          break;
        default:
          content += renderInbox();
      }
      content += '</main>';
      
      // Render bottom navigation
      content += renderBottomNav();
      
      // Render the gradient dialog if active
      content += renderGradientDialog();
      
      app.innerHTML = content;
    }

    // Make functions accessible to inline event handlers
    window.toggleTheme = toggleTheme;
    window.toggleExpand = toggleExpand;
    window.navigate = navigate;
    window.setGradientTheme = setGradientTheme;
    window.toggleGradientPicker = toggleGradientPicker;
    window.toggleGradientDialog = toggleGradientDialog;
    window.changePage = changePage;
    window.addColorStop = addColorStop;
    window.removeColorStop = removeColorStop;
    window.updateColorStop = updateColorStop;
    window.updateColorPosition = updateColorPosition;
    window.updateGradientAngle = updateGradientAngle;
    window.applyCustomGradient = applyCustomGradient;

    // Initialize the app
    document.addEventListener('DOMContentLoaded', () => {
      renderApp();
      loadApp();
    });
  </script>
</body>
</html>
