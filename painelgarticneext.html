<html class="scroll-smooth" lang="pt-BR">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Garticneext Painel
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <style>
   @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
   body {
     font-family: 'Inter', sans-serif;
   }
   .blurred {
     filter: blur(4px);
     transition: filter 0.3s ease;
   }
  </style>
 </head>
 <body class="bg-[#0B1226] text-white min-h-screen p-4">
  <header class="flex flex-wrap items-center justify-between mb-4 gap-3">
   <div class="flex items-center gap-2 max-w-[60%]">
    <i class="fas fa-pen text-[#6B6BFF] text-lg"></i>
    <h1 class="font-extrabold text-2xl leading-[1.1]">
     Garticneext
     <br/>
     painel
    </h1>
   </div>
   <div id="totalEnvios" class="bg-[#1B243A] rounded-md px-4 py-2 text-sm font-semibold max-w-[35%] text-left">
    Total de
    <br/>
    envios:
    <span class="text-[#6B6BFF]">0</span>
   </div>
   <button aria-label="Toggle dark mode" class="text-white text-xl">
    <i class="fas fa-moon"></i>
   </button>
  </header>
  <form class="mb-4">
   <label class="sr-only" for="search">Pesquisar desenhos</label>
   <div class="relative max-w-full">
    <input class="w-full rounded-md bg-[#121B2B] border border-[#1B243A] py-3 pl-12 pr-4 text-[#6B6BFF] placeholder-[#3B3B4B] focus:outline-none focus:ring-2 focus:ring-[#6B6BFF]" id="search" placeholder="Pesquisar desenhos..." type="search"/>
    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-[#3B3B4B]"></i>
   </div>
  </form>
  <nav class="flex items-center gap-3 border-b border-[#2B2B3B] pb-2 overflow-x-auto scrollbar-thin scrollbar-thumb-[#6B6BFF]/50 scrollbar-track-transparent">
   <button class="flex items-center gap-1 text-white font-semibold whitespace-nowrap">
    <i class="fas fa-filter"></i>
    Filtrar por:
   </button>
   <button class="bg-[#3B3B4B] rounded-md px-4 py-2 font-semibold whitespace-nowrap">Todos</button>
   <button class="text-white font-semibold whitespace-nowrap px-4 py-2 rounded-md hover:bg-[#3B3B4B]">Última hora</button>
   <button class="text-white font-semibold whitespace-nowrap px-4 py-2 rounded-md hover:bg-[#3B3B4B]">Hoje</button>
  </nav>
  <main id="lista" class="mt-6 space-y-6 max-w-md mx-auto"></main>
  <div id="mensagem" class="text-center text-red-600 font-bold mt-4 max-w-md mx-auto"></div>
  <script>
   function tempoDecorrido(dataHoraString) {
    if (!dataHoraString) return '';
    const agora = new Date();
    const dataEnvio = new Date(dataHoraString);
    if (isNaN(dataEnvio)) return '';
    const diffMs = agora - dataEnvio;
    if (diffMs < 0) return 'agora mesmo';
    const segundos = Math.floor(diffMs / 1000);
    if (segundos < 60) return `há ${segundos} segundo${segundos !== 1 ? 's' : ''}`;
    const minutos = Math.floor(segundos / 60);
    if (minutos < 60) return `há ${minutos} minuto${minutos !== 1 ? 's' : ''}`;
    const horas = Math.floor(minutos / 60);
    if (horas < 24) return `há ${horas} hora${horas !== 1 ? 's' : ''}`;
    const dias = Math.floor(horas / 24);
    return `há ${dias} dia${dias !== 1 ? 's' : ''}`;
   }

   async function carregarDesenhos() {
    const lista = document.getElementById('lista');
    const mensagem = document.getElementById('mensagem');
    const totalEnviosSpan = document.querySelector('#totalEnvios span');
    const chave = 'minha_chave_123';
    const url = `https://script.google.com/macros/s/AKfycbwy2V3MIsdN-pZIyGn_Xe8wWMvtXY_EPKWcMU0j6G0eblRZ4pO-Ny7y5cgCheQOw73d/exec?chave=${chave}`;
    try {
      const resposta = await fetch(url);
      if (!resposta.ok) {
        throw new Error('Erro de conexão com o servidor.');
      }
      const dados = await resposta.json();
      if (dados.status !== 'sucesso') {
        mensagem.textContent = dados.mensagem || 'Erro ao buscar dados.';
        return;
      }
      if (dados.registros.length === 0) {
        mensagem.textContent = 'Nenhum desenho encontrado.';
        return;
      }
      mensagem.textContent = '';
      totalEnviosSpan.textContent = dados.registros.length;
      lista.innerHTML = '';
      dados.registros.reverse().forEach(desenho => {
        const tempo = tempoDecorrido(desenho.dataHora);
        const artigo = document.createElement('article');
        artigo.className = 'border border-[#6B6BFF] rounded-lg p-4 relative';
        artigo.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <h2 class="text-[#6B6BFF] font-semibold text-sm flex items-center gap-2">
              <i class="fas fa-pen text-[#6B6BFF]"></i>
              Garticneext
            </h2>
            <button aria-label="Editar" class="text-[#6B6BFF] text-lg"><i class="fas fa-palette"></i></button>
          </div>
          <div class="flex justify-between items-center mb-2">
            <div class="flex items-center gap-2 text-white font-semibold text-lg">
              <h3 class="leading-none transition-filter" style="transition: filter 0.3s ease;">${desenho.nomeDesenho || '.'}</h3>
              <button aria-label="Visualizar" class="text-[#6B6BFF] text-lg toggle-blur">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>
          <div class="flex justify-center mb-3">
            <img src="${desenho.linkImagem}" alt="Desenho: ${desenho.nomeDesenho}, artista: ${desenho.nomePessoa}" class="rounded-md max-w-[200px] max-h-[200px] object-cover" width="200" height="200"/>
          </div>
          <div class="flex justify-between text-sm">
            <p><strong>Artista:</strong> ${desenho.nomePessoa}</p>
            <p class="italic text-[#6B6BFF]">${tempo}</p>
          </div>
        `;
        lista.appendChild(artigo);
      });

      // Add event listeners for blur toggle
      lista.querySelectorAll('.toggle-blur').forEach(button => {
        button.addEventListener('click', () => {
          const h3 = button.previousElementSibling;
          if (!h3) return;
          if (h3.classList.contains('blurred')) {
            h3.classList.remove('blurred');
          } else {
            h3.classList.add('blurred');
          }
        });
      });
    } catch (error) {
      console.error('Erro:', error);
      mensagem.textContent = 'Erro ao conectar ao servidor.';
    }
   }
   carregarDesenhos();
  </script>
 </body>
</html>