<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Neext Doações - Resgatar Código</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    rel="stylesheet"
  />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap");

    /* Custom spinner */
    .spinner {
      border: 3px solid rgba(139, 92, 246, 0.3);
      border-top: 3px solid #8b5cf6;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      margin-right: 0.75rem;
      box-sizing: border-box;
      display: inline-block;
      vertical-align: middle;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    /* Toast notification */
    #toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background-color: #8b5cf6;
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      box-shadow: 0 0 10px rgba(139, 92, 246, 0.7);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease-in-out;
      z-index: 9999;
    }

    #toast.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* Override Tailwind yellow colors to purple */
    .bg-yellow-500 {
      background-color: #8b5cf6 !important;
    }
    .border-yellow-500 {
      border-color: #8b5cf6 !important;
    }
    .text-yellow-400 {
      color: #a78bfa !important;
    }
    .focus\:ring-yellow-400:focus {
      --tw-ring-color: #a78bfa !important;
    }
    .drop-shadow-\[0_0_10px_rgba\(251\,191\,36\,0\.9\)\] {
      filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.9)) !important;
    }
    .drop-shadow-\[0_0_15px_rgba\(251\,191\,36\,0\.9\)\] {
      filter: drop-shadow(0 0 15px rgba(139, 92, 246, 0.9)) !important;
    }
    .drop-shadow-\[0_0_8px_rgba\(251\,191\,36\,0\.8\)\] {
      filter: drop-shadow(0 0 8px rgba(139, 92, 246, 0.8)) !important;
    }
    .bg-yellow-900 {
      background-color: rgba(99, 102, 241, 0.2) !important;
    }

    /* Spinner for total accounts */
    .spinner-small {
      border: 3px solid rgba(139, 92, 246, 0.3);
      border-top: 3px solid #8b5cf6;
      border-radius: 50%;
      width: 14px;
      height: 14px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-right: 0.5rem;
    }

    /* Custom error message style */
    #resultado.erro {
      background-color: #fee2e2; /* Tailwind red-200 */
      color: #b91c1c; /* Tailwind red-700 */
      border: 2px solid #f87171; /* Tailwind red-400 */
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 700;
      border-radius: 0.5rem;
      padding: 1rem;
      flex-direction: row;
      flex-wrap: nowrap;
    }

    #resultado.erro i {
      color: #b91c1c;
      font-size: 1.5rem;
      flex-shrink: 0;
    }

    /* Result info container */
    #resultado {
      max-width: 100%;
      word-break: break-word;
      flex-direction: column;
      display: none;
    }

    /* Result info lines */
    .result-line {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      color: #d8b4fe; /* Tailwind purple-300 */
      white-space: normal;
      flex-wrap: wrap;
    }

    .result-line i {
      color: #a78bfa; /* Tailwind purple-400 */
      min-width: 20px;
      text-align: center;
      flex-shrink: 0;
    }

    /* Container for icon and text in result */
    .result-text {
      flex: 1 1 auto;
      word-break: break-word;
    }

    /* Message container for icon and text side by side */
    #msgContainer {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 700;
      color: #a3e635; /* Tailwind green-400 for success */
      font-size: 1.125rem;
    }

    #msgContainer.error {
      color: #b91c1c; /* Tailwind red-700 for error */
    }

    #msgContainer i {
      font-size: 1.5rem;
      flex-shrink: 0;
    }
  </style>
</head>
<body class="bg-[#121212] font-[Roboto Mono] text-purple-400 min-h-screen flex flex-col">
  <main class="flex-grow flex justify-center items-start p-4">
    <section
      class="max-w-md w-full rounded-xl border border-purple-500 p-6 flex flex-col items-center space-y-6 relative"
      style="box-shadow: 0 0 20px 4px #8b5cf6"
    >
      <div class="mb-2 text-purple-400 drop-shadow-[0_0_8px_rgba(139,92,246,0.8)]" aria-hidden="true">
        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ticket-check-icon lucide-ticket-check" >
          <path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/>
          <path d="m9 12 2 2 4-4"/>
        </svg>
      </div>
      <h1
        class="text-purple-400 text-2xl font-semibold tracking-widest drop-shadow-[0_0_8px_rgba(139,92,246,0.8)]"
      >
        Neext Doações
      </h1>
      <button
        class="bg-purple-500 rounded-full px-6 py-2 flex items-center space-x-2 font-semibold text-black drop-shadow-[0_0_10px_rgba(139,92,246,0.9)]"
        type="button"
      >
        <i class="fas fa-star"></i>
        <span>Conta Premium</span>
      </button>

      <div class="w-full flex flex-col items-center space-y-4">
        <input
          id="codigo"
          type="text"
          placeholder="Digite o código"
          class="w-full rounded-lg border border-purple-500 bg-transparent px-4 py-2 text-purple-400 font-mono text-lg focus:outline-none focus:ring-2 focus:ring-purple-400"
        />
        <button
          id="btnResgatar"
          onclick="resgatar()"
          class="bg-purple-500 rounded-xl px-6 py-3 w-full flex items-center justify-center space-x-3 font-semibold text-black drop-shadow-[0_0_15px_rgba(139,92,246,0.9)]"
          type="button"
          aria-live="polite"
          aria-busy="false"
        >
          <span id="btnResgatarContent" class="flex items-center">
            <i class="fas fa-key"></i>
            <span>Resgatar</span>
          </span>
        </button>
        <button
          id="btnCopiar"
          onclick="copiarConta()"
          class="bg-purple-500 rounded-xl px-6 py-3 w-full flex items-center justify-center space-x-3 font-semibold text-black drop-shadow-[0_0_15px_rgba(139,92,246,0.9)] disabled:opacity-50"
          type="button"
          disabled
        >
          <i class="far fa-copy"></i>
          <span>Copiar Conta</span>
        </button>
      </div>

      <div
        id="resultado"
        class="w-full mt-4 rounded-lg p-4 text-left space-y-3 flex flex-col"
        role="alert"
        aria-live="assertive"
      >
        <div id="msgContainer" class="flex items-center gap-2 font-semibold text-purple-300"></div>
        <p id="msg" class="font-semibold"></p>
        <p id="email" class="result-line"><i class="fas fa-user"></i><span class="result-text"></span></p>
        <p id="senha" class="result-line"><i class="fas fa-key"></i><span class="result-text"></span></p>
        <p id="tipoConta" class="result-line"><i class="fas fa-tv"></i><span class="result-text"></span></p>
        <p id="resgatadoEm" class="result-line" style="padding-left: 0; display:none;"><span class="result-text"></span></p>
      </div>

      <div class="flex items-center space-x-3 mt-4">
        <span class="w-4 h-4 rounded-full bg-green-500 block"></span>
        <p id="servidorMsg" class="text-purple-300 font-semibold select-none flex items-center gap-2">
          <i class="fas fa-server text-purple-400"></i>
          <span></span>
        </p>
      </div>

      <div class="flex items-center space-x-3 mt-2">
        <span class="spinner-small"></span>
        <p id="totalContas" class="text-purple-300 font-semibold select-none">Total de contas disponíveis: 0</p>
      </div>

      <button
        id="btnInstagram"
        type="button"
        class="bg-purple-500 rounded-xl px-6 py-3 w-full flex items-center justify-center space-x-3 font-semibold text-black drop-shadow-[0_0_15px_rgba(139,92,246,0.9)] mt-6"
      >
        <i class="fab fa-instagram text-black"></i>
        <span>@neet.tk</span>
      </button>

      <button
        id="btnCanal"
        type="button"
        class="bg-purple-500 rounded-xl px-6 py-3 w-full flex items-center justify-center space-x-3 font-semibold text-black drop-shadow-[0_0_15px_rgba(139,92,246,0.9)] mt-4"
      >
        <i class="fab fa-whatsapp text-black"></i>
        <span>Canal da Neext</span>
      </button>

      <button
        id="btnCreditos"
        type="button"
        class="bg-purple-500 rounded-xl px-6 py-3 w-full flex items-center justify-center space-x-3 font-semibold text-black drop-shadow-[0_0_15px_rgba(139,92,246,0.9)] mt-4"
      >
        <i class="fas fa-info-circle"></i>
        <span>Créditos</span>
      </button>
    </section>
  </main>

  <div id="toast" role="alert" aria-live="assertive" aria-atomic="true">
    Conta copiada para a área de transferência!
  </div>

  <script>
    let ultimaConta = null;
    const btnResgatar = document.getElementById("btnResgatar");
    const btnResgatarContent = document.getElementById("btnResgatarContent");
    const toast = document.getElementById("toast");
    const servidorMsg = document.getElementById("servidorMsg");
    const totalContas = document.getElementById("totalContas");
    const btnCreditos = document.getElementById("btnCreditos");
    const resultado = document.getElementById("resultado");
    const msg = document.getElementById("msg");
    const email = document.getElementById("email");
    const senha = document.getElementById("senha");
    const tipoConta = document.getElementById("tipoConta");
    const resgatadoEm = document.getElementById("resgatadoEm");
    const msgContainer = document.getElementById("msgContainer");
    const servidorMsgSpan = servidorMsg.querySelector("span");

    function atualizarSaudacao() {
      const now = new Date();
      const hour = now.getHours();
      let saudacao = "Olá";

      if (hour >= 5 && hour < 12) {
        saudacao = "Bom dia";
      } else if (hour >= 12 && hour < 18) {
        saudacao = "Boa tarde";
      } else {
        saudacao = "Boa noite";
      }

      servidorMsgSpan.textContent = `${saudacao} - Servidor online`;
    }

    function gerarTotalContas() {
      // Generate a random number between 1000 and 9999
      const valor = Math.floor(Math.random() * 9000) + 1000;
      totalContas.textContent = `Total de contas disponíveis: ${valor}`;
    }

    atualizarSaudacao();
    gerarTotalContas();

    async function resgatar() {
      const codigo = document.getElementById("codigo").value.trim();

      resultado.classList.remove("erro");
      resultado.style.display = "none";
      msg.textContent = "";
      email.querySelector("span").textContent = "";
      senha.querySelector("span").textContent = "";
      tipoConta.querySelector("span").textContent = "";
      resgatadoEm.querySelector("span").textContent = "";
      resgatadoEm.style.display = "none";
      email.style.display = "flex";
      senha.style.display = "flex";
      tipoConta.style.display = "flex";
      btnCopiar.disabled = true;
      ultimaConta = null;
      msgContainer.innerHTML = "";

      if (!codigo) {
        alert("Digite um código!");
        return;
      }

      // Show loading spinner and disable button
      btnResgatar.disabled = true;
      btnResgatar.setAttribute("aria-busy", "true");
      btnResgatarContent.innerHTML = `
        <span class="spinner" aria-hidden="true"></span>
        <span class="ml-1">Carregando...</span>
      `;

      try {
        const url = `https://script.google.com/macros/s/AKfycbxBevrtJRJafWTxR79Ze4b26MQDx6vYErqUhIKTFu6KhGIY1wJ59Rbq8_5FptfIMmxH/exec?acao=resgatar&codigo=${codigo}`;
        const res = await fetch(url);
        const data = await res.json();

        resultado.style.display = "flex";

        if (data.mensagem === "Código resgatado com sucesso.") {
          resultado.classList.remove("erro");
          msgContainer.innerHTML = `<i class="fas fa-check-circle text-green-400 text-xl"></i><span>${data.mensagem}</span>`;
          msg.textContent = "";

          if (data.usuario && data.senha && data.servidor) {
            // IPTV type account
            email.style.display = "flex";
            senha.style.display = "flex";
            tipoConta.style.display = "flex";

            email.querySelector("span").textContent = data.usuario;
            senha.querySelector("span").textContent = data.senha;
            tipoConta.querySelector("span").textContent = "IPTV";

            ultimaConta = {
              email: data.usuario,
              senha: data.senha,
              tipoConta: "IPTV",
            };
          } else {
            // Old type with email, senha, tipoConta
            email.style.display = "flex";
            senha.style.display = "flex";
            tipoConta.style.display = "flex";

            email.querySelector("span").textContent = data.email || "";
            senha.querySelector("span").textContent = data.senha || "";
            tipoConta.querySelector("span").textContent = data.tipoConta || "";

            ultimaConta = {
              email: data.email || "",
              senha: data.senha || "",
              tipoConta: data.tipoConta || "",
            };
          }
          resgatadoEm.style.display = "none";
          resgatadoEm.querySelector("span").textContent = "";
          btnCopiar.disabled = false;
        } else if (data.mensagem === "Código já resgatado.") {
          resultado.classList.remove("erro");
          msgContainer.innerHTML = `<i class="fas fa-info-circle text-yellow-400 text-xl"></i><span>${data.mensagem}</span>`;
          msg.textContent = "";
          email.style.display = "none";
          senha.style.display = "none";
          tipoConta.style.display = "none";
          resgatadoEm.querySelector("span").textContent = `Resgatado em: ${new Date(
            data.resgatadoEm
          ).toLocaleString()}`;
          resgatadoEm.style.display = "flex";
          ultimaConta = null;
          btnCopiar.disabled = true;
        } else {
          resultado.classList.add("erro");
          msgContainer.innerHTML = `<i class="fas fa-exclamation-triangle"></i><span>Gift card inválido.</span>`;
          msg.textContent = "";
          email.querySelector("span").textContent = "";
          senha.querySelector("span").textContent = "";
          tipoConta.querySelector("span").textContent = "";
          resgatadoEm.style.display = "none";
          email.style.display = "flex";
          senha.style.display = "flex";
          tipoConta.style.display = "flex";
          ultimaConta = null;
          btnCopiar.disabled = true;
        }
      } catch (error) {
        resultado.style.display = "flex";
        resultado.classList.add("erro");
        msgContainer.innerHTML = `<i class="fas fa-exclamation-triangle"></i><span>Gift card inválido.</span>`;
        msg.textContent = "";
        email.querySelector("span").textContent = "";
        senha.querySelector("span").textContent = "";
        tipoConta.querySelector("span").textContent = "";
        resgatadoEm.style.display = "none";
        email.style.display = "flex";
        senha.style.display = "flex";
        tipoConta.style.display = "flex";
        ultimaConta = null;
        btnCopiar.disabled = true;
      } finally {
        // Restore button content and enable button
        btnResgatarContent.innerHTML = `<i class="fas fa-key"></i><span>Resgatar</span>`;
        btnResgatar.disabled = false;
        btnResgatar.removeAttribute("aria-busy");
      }
    }

    function copiarConta() {
      if (!ultimaConta) return;
      const texto = `Usuário: ${ultimaConta.email}\nSenha: ${ultimaConta.senha}\nTipo de Conta: ${ultimaConta.tipoConta}`;
      navigator.clipboard.writeText(texto).then(() => {
        showToast();
      });
    }

    function showToast() {
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 2500);
    }

    btnCreditos.addEventListener("click", () => {
      Swal.fire({
        icon: "info",
        title: "Créditos",
        text: "Desenvolvido pela Neext",
        confirmButtonColor: "#8b5cf6",
      });
    });
  </script>
</body>
</html>