<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rádio Neext</title>
    <meta name="description" content="Chat app for Rádio Neext" />
    <meta name="author" content="Rádio Neext" />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
      
      :root {
        --background: 210 40% 98%;
        --foreground: 222 47% 11%;
        --card: 0 0% 100%;
        --card-foreground: 222 47% 11%;
        --popover: 0 0% 100%;
        --popover-foreground: 222 47% 11%;
        --primary: 155 100% 29%;
        --primary-foreground: 210 40% 98%;
        --secondary: 210 40% 96%;
        --secondary-foreground: 222 47% 11%;
        --muted: 210 40% 96%;
        --muted-foreground: 215 16% 47%;
        --accent: 155 70% 95%;
        --accent-foreground: 222 47% 11%;
        --destructive: 0 84% 60%;
        --destructive-foreground: 210 40% 98%;
        --border: 214 32% 91%;
        --input: 214 32% 91%;
        --ring: 222 84% 5%;
        --radius: 0.75rem;
        
        /* Premium colors */
        --premium-purple: 265 60% 60%;
        --premium-blue: 220 70% 60%;
        --premium-green: 150 60% 50%;
        --premium-pink: 330 70% 65%;
        --premium-orange: 25 90% 60%;
        --premium-red: 0 70% 60%;
        
        /* Gradients */
        --gradient-premium: linear-gradient(135deg, hsl(265, 60%, 60%), hsl(220, 70%, 60%));
        --gradient-message: linear-gradient(135deg, hsl(150, 100%, 35%), hsl(170, 80%, 40%));
        --gradient-login: linear-gradient(135deg, hsl(265, 83%, 45%), hsl(230, 90%, 55%));
      }

      .dark {
        --background: 222 47% 11%;
        --foreground: 210 40% 98%;
        --card: 222 47% 11%;
        --card-foreground: 210 40% 98%;
        --popover: 222 47% 11%;
        --popover-foreground: 210 47% 11%;
        --primary: 155 100% 33%;
        --primary-foreground: 210 40% 98%;
        --secondary: 217 33% 18%;
        --secondary-foreground: 210 40% 98%;
        --muted: 217 33% 18%;
        --muted-foreground: 215 20% 65%;
        --accent: 155 70% 15%;
        --accent-foreground: 210 40% 98%;
        --destructive: 0 63% 31%;
        --destructive-foreground: 210 40% 98%;
        --border: 217 33% 18%;
        --input: 217 33% 18%;
        --ring: 213 27% 84%;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      }

      body {
        background-color: hsl(var(--background));
        color: hsl(var(--foreground));
        height: 100vh;
        transition: all 0.2s ease;
      }

      /* Utility Classes */
      .flex { display: flex; }
      .flex-col { flex-direction: column; }
      .items-center { align-items: center; }
      
      .items-start { align-items: flex-start; }
      .items-end { align-items: flex-end; }
      .justify-between { justify-content: space-between; }
      .justify-center { justify-content: center; }
      .gap-1 { gap: 0.25rem; }
      .gap-2 { gap: 0.5rem; }
      .gap-3 { gap: 0.75rem; }
      
      .text-xs { font-size: 0.75rem; }
      .text-sm { font-size: 0.875rem; }
      .text-lg { font-size: 1.125rem; }
      .text-xl { font-size: 1.25rem; }
      .text-2xl { font-size: 1.5rem; }
      
      .font-medium { font-weight: 500; }
      .font-semibold { font-weight: 600; }
      .font-bold { font-weight: 700; }
      
      .h-screen { height: 100vh; }
      .min-h-screen { min-height: 100vh; }
      .w-full { width: 100%; }
      .max-w-md { max-width: 28rem; }
      .max-w-3xl { max-width: 48rem; }
      
      .p-1 { padding: 0.25rem; }
      .p-2 { padding: 0.5rem; }
      .p-3 { padding: 0.75rem; }
      .p-4 { padding: 1rem; }
      .p-6 { padding: 1.5rem; }
      
      .px-1 { padding-left: 0.25rem; padding-right: 0.25rem; }
      .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
      .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
      .px-4 { padding-left: 1rem; padding-right: 1rem; }
      
      .py-0\.5 { padding-top: 0.125rem; padding-bottom: 0.125rem; }
      .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
      .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
      .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
      
      .pr-10 { padding-right: 2.5rem; }
      .pt-2 { padding-top: 0.5rem; }
      
      .space-y-2 > * + * { margin-top: 0.5rem; }
      .space-y-4 > * + * { margin-top: 1rem; }
      
      .rounded-md { border-radius: 0.375rem; }
      .rounded-lg { border-radius: 0.5rem; }
      .rounded-xl { border-radius: 0.75rem; }
      .rounded-2xl { border-radius: 1rem; }
      .rounded-full { border-radius: 9999px; }
      
      .rounded-tr-none { border-top-right-radius: 0; }
      .rounded-tl-none { border-top-left-radius: 0; }
      
      .border { border: 1px solid hsl(var(--border)); }
      .border-t { border-top: 1px solid hsl(var(--border)); }
      
      .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
      .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
      .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
      .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
      
      .text-white { color: white; }
      .text-foreground { color: hsl(var(--foreground)); }
      .text-muted-foreground { color: hsl(var(--muted-foreground)); }
      
      .bg-primary { background-color: hsl(var(--primary)); }
      .bg-secondary { background-color: hsl(var(--secondary)); }
      .bg-card { background-color: hsl(var(--card)); }
      .bg-background { background-color: hsl(var(--background)); }
      
      .hover\:bg-primary\/90:hover { background-color: hsla(var(--primary), 0.9); }
      .hover\:bg-secondary\/80:hover { background-color: hsla(var(--secondary), 0.8); }
      .hover\:bg-white\/10:hover { background-color: rgba(255, 255, 255, 0.1); }
      .hover\:opacity-90:hover { opacity: 0.9; }
      .hover\:shadow-lg:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
      
      .transition-colors { transition-property: background-color, border-color, color; transition-duration: 0.15s; }
      .transition-all { transition-property: all; transition-duration: 0.15s; }
      .duration-300 { transition-duration: 0.3s; }
      
      .overflow-y-auto { overflow-y: auto; }
      .flex-1 { flex: 1 1 0%; }
      .flex-shrink-0 { flex-shrink: 0; }
      
      .ml-auto { margin-left: auto; }
      .mr-auto { margin-right: auto; }
      .mx-auto { margin-left: auto; margin-right: auto; }
      
      .mb-1 { margin-bottom: 0.25rem; }
      .mb-4 { margin-bottom: 1rem; }
      .mt-1 { margin-top: 0.25rem; }
      
      .resize-none { resize: none; }
      
      .h-3 { height: 0.75rem; }
      .w-3 { width: 0.75rem; }
      .h-4 { height: 1rem; }
      .w-4 { width: 1rem; }
      .h-5 { height: 1.25rem; }
      .w-5 { width: 1.25rem; }
      .h-6 { height: 1.5rem; }
      .w-6 { width: 1.5rem; }
      .h-7 { height: 1.75rem; }
      .w-7 { width: 1.75rem; }
      .h-10 { height: 2.5rem; }
      .w-10 { width: 2.5rem; }
      
      .max-w-\[80\%\] { max-width: 80%; }
      .max-w-\[70\%\] { max-width: 70%; }
      .max-h-32 { max-height: 8rem; }
      
      .opacity-70 { opacity: 0.7; }
      .hidden, [style*="display: none"] { display: none; }
      
      .grid { display: grid; }
      .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      
      .relative { position: relative; }
      .fixed { position: fixed; }
      .z-50 { z-index: 50; }
      
      .bottom-4 { bottom: 1rem; }
      .left-1\/2 { left: 50%; }
      
      .transform { transform: translate(var(--translate-x, 0), var(--translate-y, 0)); }
      .-translate-x-1\/2 { --translate-x: -50%; }
      .translate-y-0 { --translate-y: 0; }
      .translate-y-2 { --translate-y: 0.5rem; }

      /* Premium Classes */
      .bg-premium-purple { background-color: hsl(var(--premium-purple)); }
      .bg-premium-blue { background-color: hsl(var(--premium-blue)); }
      .bg-premium-green { background-color: hsl(var(--premium-green)); }
      .bg-premium-pink { background-color: hsl(var(--premium-pink)); }
      .bg-premium-orange { background-color: hsl(var(--premium-orange)); }
      .bg-premium-red { background-color: hsl(var(--premium-red)); }
      
      .bg-gradient-premium { background-image: var(--gradient-premium); }
      .bg-gradient-message { background-image: var(--gradient-message); }
      .bg-gradient-login { background-image: var(--gradient-login); }
      
      .avatar-premium {
        display: flex;
        flex-shrink: 0;
        height: 2.5rem;
        width: 2.5rem;
        border-radius: 9999px;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      
      .message-bubble-premium {
        padding: 0.75rem;
        border-radius: 1rem;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        backdrop-filter: blur(4px);
      }
      
      .message-bubble-sent {
        background-image: var(--gradient-message);
        color: white;
        border-top-right-radius: 0;
      }
      
      .message-bubble-received {
        background-color: hsl(var(--card));
        border-top-left-radius: 0;
        border: 1px solid hsl(var(--border));
      }
      
      .badge-premium {
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.125rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.75rem;
      }
      
      .radio-icon-premium {
        color: white;
        animation: pulse-light 2s infinite;
      }
      
      .glass-effect {
        backdrop-filter: blur(4px);
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      
      .btn-premium {
        transition-property: all;
        transition-duration: 0.3s;
        outline: none;
        border: none;
      }
      .btn-premium:hover {
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      
      .input-premium {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid hsl(var(--border));
        border-radius: 0.5rem;
        background-color: hsl(var(--background));
        transition-property: all;
        transition-duration: 0.2s;
      }
      .input-premium:focus {
        outline: none;
        box-shadow: 0 0 0 2px hsla(var(--primary), 0.5);
      }
      
      .login-card-premium {
        width: 100%;
        max-width: 28rem;
        background-color: hsl(var(--card));
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        border-radius: 1rem;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: fade-in 0.3s ease-out forwards;
      }

      /* Animations */
      @keyframes pulse-light {
        0% { opacity: 0.7; }
        50% { opacity: 1; }
        100% { opacity: 0.7; }
      }

      @keyframes messageAppear {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      .animate-message-appear {
        animation: messageAppear 0.3s ease-out forwards;
      }

      .animate-fade-in {
        animation: fadeIn 0.3s ease-out forwards;
      }

      /* Button Resets */
      .button-no-border {
        border: none !important;
        outline: none !important;
      }
      
      .icon-button {
        border: none !important;
        outline: none !important;
        background: transparent;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div id="root">
      <div id="app">
        <!-- Login Form -->
        <div id="loginForm" class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-background to-secondary">
          <div class="login-card-premium">
            <div class="bg-gradient-login p-6 flex items-center justify-center gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="radio-icon-premium">
                <path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"></path>
                <path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"></path>
                <circle cx="12" cy="12" r="2"></circle>
                <path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"></path>
                <path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"></path>
              </svg>
              <h2 class="text-2xl font-bold text-white">Rádio Neext</h2>
            </div>

            <form id="userForm" class="p-6 space-y-4">
              <div class="space-y-2">
                <label class="text-sm font-medium" for="id">ID</label>
                <input
                  id="id"
                  type="text"
                  placeholder="Digite seu ID"
                  class="input-premium"
                  required
                />
              </div>

              <div class="space-y-2">
                <label class="text-sm font-medium" for="senha">Senha</label>
                <input
                  id="senha"
                  type="password"
                  placeholder="Digite sua senha"
                  class="input-premium"
                  required
                />
              </div>

              <div class="space-y-2">
                <label class="text-sm font-medium" for="nome">Nome</label>
                <input
                  id="nome"
                  type="text"
                  placeholder="Digite seu nome"
                  class="input-premium"
                  required
                />
              </div>

              <div class="grid grid-cols-2 gap-3 pt-2">
                <button
                  id="loginBtn"
                  type="button"
                  class="button-no-border w-full py-2 rounded-md bg-secondary text-foreground font-medium hover:bg-secondary/80 transition-colors btn-premium"
                >
                  Login
                </button>
                <button
                  type="submit"
                  class="button-no-border w-full py-2 rounded-md bg-gradient-premium text-white font-medium hover:opacity-90 transition-colors btn-premium"
                >
                  Registro
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Chat Container -->
        <div id="chatContainer" class="flex flex-col h-screen" style="display: none;">
          <!-- Header -->
          <header class="bg-gradient-premium text-white p-3 flex items-center justify-between shadow-lg">
            <div class="flex items-center gap-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="radio-icon-premium">
                <path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"></path>
                <path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"></path>
                <circle cx="12" cy="12" r="2"></circle>
                <path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"></path>
                <path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"></path>
              </svg>
              <h1 class="text-lg font-semibold">Rádio Neext</h1>
            </div>
            <div class="flex items-center gap-2">
              <button
                id="themeToggle"
                class="icon-button p-2 rounded-full hover:bg-white/10 transition-colors"
                aria-label="Toggle theme"
              >
                <svg id="moonIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
                </svg>
                <svg id="sunIcon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
                  <circle cx="12" cy="12" r="4"></circle>
                  <path d="M12 2v2"></path>
                  <path d="M12 20v2"></path>
                  <path d="m4.93 4.93 1.41 1.41"></path>
                  <path d="m17.66 17.66 1.41 1.41"></path>
                  <path d="M2 12h2"></path>
                  <path d="M20 12h2"></path>
                  <path d="m6.34 17.66-1.41 1.41"></path>
                  <path d="m19.07 4.93-1.41 1.41"></path>
                </svg>
              </button>
              <button
                id="logoutBtn"
                class="icon-button p-2 hover:bg-white/10 rounded-full transition-colors"
                aria-label="Logout"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                  <polyline points="16 17 21 12 16 7"></polyline>
                  <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
              </button>
            </div>
          </header>

          <!-- Messages -->
          <div id="messages" class="flex-1 p-4 overflow-y-auto bg-background">
            <div class="max-w-3xl mx-auto space-y-3">
              <!-- Messages will be inserted here -->
            </div>
          </div>

          <!-- Input -->
          <form id="messageForm" class="p-3 bg-card border-t flex items-end gap-2 shadow-md">
            <div class="flex-1 relative">
              <textarea
                id="messageInput"
                placeholder="Digite uma mensagem..."
                rows="1"
                class="w-full resize-none p-3 pr-10 rounded-xl border bg-background max-h-32 focus:ring-2 focus:ring-primary/50 focus:outline-none"
              ></textarea>
            </div>
            <button
              type="submit"
              class="button-no-border p-3 rounded-full bg-gradient-premium text-white hover:opacity-90 transition-all duration-300 shadow-md hover:shadow-lg"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m22 2-7 20-4-9-9-4Z"></path>
                <path d="m22 2-7 20-4-9-9-4Z"></path>
              </svg>
            </button>
          </form>
        </div>

        <!-- Toast -->
        <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg bg-foreground text-background shadow-lg z-50 transition-all duration-300 opacity-0 translate-y-2" style="display: none;"></div>
      </div>
    </div>
    
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script>
      // Theme Management
      const themeToggle = document.getElementById('themeToggle');
      const moonIcon = document.getElementById('moonIcon');
      const sunIcon = document.getElementById('sunIcon');
      const htmlElement = document.documentElement;
      
      // Check for saved theme preference or respect OS setting
      function getThemePreference() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          return savedTheme;
        }
        
        // Check for OS preference
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }
      
      // Apply the theme
      function applyTheme(theme) {
        localStorage.setItem('theme', theme);
        
        if (theme === 'dark') {
          htmlElement.classList.add('dark');
          moonIcon.style.display = 'none';
          sunIcon.style.display = 'block';
        } else {
          htmlElement.classList.remove('dark');
          moonIcon.style.display = 'block';
          sunIcon.style.display = 'none';
        }
      }
      
      // Initialize theme
      applyTheme(getThemePreference());
      
      // Toggle theme
      themeToggle.addEventListener('click', () => {
        const currentTheme = localStorage.getItem('theme') || 'light';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        applyTheme(newTheme);
      });

      // Toast functionality
      function showToast(message, duration = 3000) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.style.display = 'block';
        
        // Show with animation
        setTimeout(() => {
          toast.classList.remove('opacity-0', 'translate-y-2');
          toast.classList.add('opacity-100', 'translate-y-0');
        }, 10);
        
        // Hide after duration
        setTimeout(() => {
          toast.classList.remove('opacity-100', 'translate-y-0');
          toast.classList.add('opacity-0', 'translate-y-2');
          
          // Hide element after animation completes
          setTimeout(() => {
            toast.style.display = 'none';
          }, 300);
        }, duration);
      }

      // Get initials from name
      function getInitials(name) {
        const nameParts = name.trim().split(" ");
        if (nameParts.length === 1) {
          return nameParts[0].charAt(0).toUpperCase();
        } else {
          return (
            nameParts[0].charAt(0).toUpperCase() +
            nameParts[nameParts.length - 1].charAt(0).toUpperCase()
          );
        }
      }
      
      // Generate consistent color based on name
      function generateColor(name) {
        const colors = [
          "bg-premium-purple",
          "bg-premium-blue",
          "bg-premium-green",
          "bg-premium-pink",
          "bg-premium-orange",
          "bg-premium-red"
        ];
        
        let hash = 0;
        for (let i = 0; i < name.length; i++) {
          hash = name.charCodeAt(i) + ((hash << 5) - hash);
        }
        
        return colors[Math.abs(hash) % colors.length];
      }

      // Format relative time
      function formatRelativeTime(dateString) {
        const now = new Date();
        const date = new Date(dateString);
        const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);

        if (seconds < 60) return "agora";
        const minutes = Math.floor(seconds / 60);
        if (minutes < 60) return `${minutes} ${minutes === 1 ? 'minuto' : 'minutos'} atrás`;
        const hours = Math.floor(minutes / 60);
        if (hours < 24) return `${hours} ${hours === 1 ? 'hora' : 'horas'} atrás`;
        const days = Math.floor(hours / 24);
        if (days < 7) return `${days} ${days === 1 ? 'dia' : 'dias'} atrás`;
        const weeks = Math.floor(days / 7);
        if (weeks < 4) return `${weeks} ${weeks === 1 ? 'semana' : 'semanas'} atrás`;
        const months = Math.floor(days / 30);
        if (months < 12) return `${months} ${months === 1 ? 'mês' : 'meses'} atrás`;
        const years = Math.floor(days / 365);
        return `${years} ${years === 1 ? 'ano' : 'anos'} atrás`;
      }

      // Load messages
      async function loadMessages() {
        try {
          const response = await fetch(
            "https://script.google.com/macros/s/AKfycby--rU7xxW3RTJ0WbRNdhc4WfK2n6DGNdz-UY5FDJfNvBthSluG8y4NoGgNr20PwNKC-w/exec"
          );
          const messages = await response.json();
          const messagesContainer = document.querySelector('#messages > div');
          messagesContainer.innerHTML = '';

          const currentUserId = localStorage.getItem('id');

          messages.forEach(message => {
            const messageEl = createMessageElement(message, currentUserId);
            messagesContainer.appendChild(messageEl);
          });
          
          // Scroll to bottom
          const messagesDiv = document.getElementById('messages');
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        } catch (error) {
          showToast('Erro ao carregar mensagens');
          console.error(error);
        }
      }

      // Create message element with avatars based on initials
      function createMessageElement(message, currentUserId) {
        const isCurrentUser = message.id === currentUserId;
        const messageEl = document.createElement('div');
        messageEl.className = `message flex gap-2 mb-4 max-w-[80%] lg:max-w-[70%] animate-message-appear ${isCurrentUser ? 'ml-auto' : 'mr-auto'}`;
        
        // Get user initials and avatar color
        const initials = getInitials(message.nome);
        const avatarColor = isCurrentUser ? "bg-gradient-premium" : generateColor(message.nome);
        
        // Create HTML for the message
        let html = '';
        
        // Avatar for other users
        if (!isCurrentUser) {
          html += `
            <div class="avatar-premium ${avatarColor}">
              ${initials}
            </div>
          `;
        }
        
        // Message content
        html += `
          <div class="flex flex-col ${isCurrentUser ? 'items-end' : 'items-start'}">
            <div class="message-bubble-premium ${isCurrentUser ? 'message-bubble-sent' : 'message-bubble-received'}">
              
              <!-- Sender info with ID badge -->
              ${!isCurrentUser ? `
                <div class="flex items-center gap-1 mb-1 text-xs font-medium">
                  <span class="font-semibold">${message.nome}</span>
                  <div class="badge-premium">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M4 12V4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2h-12a2 2 0 0 1-2-2v-4"></path>
                      <path d="M2 8h12"></path>
                      <path d="M2 16h12"></path>
                      <path d="M2 12h12"></path>
                    </svg>
                    <span>${message.id}</span>
                  </div>
                </div>
              ` : ''}
              
              <!-- Message content -->
              <div class="message-content text-sm">${message.mensagem}</div>
              
              <!-- Time and status -->
              <div class="flex items-center justify-end gap-1 mt-1 text-xs opacity-70">
                <span>${formatRelativeTime(message.data)}</span>
                ${isCurrentUser ? `
                  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                ` : ''}
              </div>
            </div>
          </div>
        `;
        
        // Avatar for current user
        if (isCurrentUser) {
          html += `
            <div class="avatar-premium ${avatarColor}">
              ${initials}
            </div>
          `;
        }
        
        messageEl.innerHTML = html;
        return messageEl;
      }

      // Send Message
      async function sendMessage(e) {
        if (e) e.preventDefault();
        
        const messageInput = document.getElementById('messageInput');
        const message = messageInput.value.trim();
        
        if (!message) return;
        
        const id = localStorage.getItem('id');
        const senha = localStorage.getItem('senha');
        const nome = localStorage.getItem('nome');
        
        if (!id || !senha || !nome) {
          showToast('Você precisa estar logado para enviar mensagens');
          return;
        }
        
        // Create message object
        const messageObj = {
          id,
          nome,
          mensagem: message,
          data: new Date().toISOString()
        };
        
        // Add message to UI immediately
        const messagesContainer = document.querySelector('#messages > div');
        const messageEl = createMessageElement(messageObj, id);
        messagesContainer.appendChild(messageEl);
        
        // Clear input and reset height
        messageInput.value = '';
        messageInput.style.height = 'auto';
        
        // Scroll to bottom
        const messagesDiv = document.getElementById('messages');
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        
        try {
          await fetch(
            "https://script.google.com/macros/s/AKfycby--rU7xxW3RTJ0WbRNdhc4WfK2n6DGNdz-UY5FDJfNvBthSluG8y4NoGgNr20PwNKC-w/exec",
            {
              method: "POST",
              mode: "no-cors",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                id,
                senha,
                nome,
                mensagem: message,
              }),
            }
          );
          
          // Reload messages after a short delay
          setTimeout(loadMessages, 1000);
        } catch (error) {
          showToast("Erro ao enviar mensagem");
          console.error(error);
        }
      }

      // Auth Functions
      function handleRegister(e) {
        e.preventDefault();
        
        const id = document.getElementById('id').value;
        const senha = document.getElementById('senha').value;
        const nome = document.getElementById('nome').value;
        
        if (!id || !senha || !nome) {
          showToast("Todos os campos são obrigatórios");
          return;
        }
        
        localStorage.setItem("id", id);
        localStorage.setItem("senha", senha);
        localStorage.setItem("nome", nome);
        
        checkAuth();
        showToast("Registro realizado com sucesso!");
      }

      function handleLogin() {
        const id = document.getElementById('id').value;
        const senha = document.getElementById('senha').value;
        const nome = document.getElementById('nome').value;
        
        if (!id || !senha || !nome) {
          showToast("Todos os campos são obrigatórios");
          return;
        }
        
        localStorage.setItem("id", id);
        localStorage.setItem("senha", senha);
        localStorage.setItem("nome", nome);
        
        checkAuth();
        showToast("Login realizado com sucesso!");
      }

      function checkAuth() {
        const id = localStorage.getItem("id");
        const senha = localStorage.getItem("senha");
        const nome = localStorage.getItem("nome");
        
        if (id && senha && nome) {
          document.getElementById("loginForm").style.display = "none";
          document.getElementById("chatContainer").style.display = "flex";
          loadMessages();
        } else {
          document.getElementById("loginForm").style.display = "flex";
          document.getElementById("chatContainer").style.display = "none";
        }
      }

      function logout() {
        localStorage.removeItem("id");
        localStorage.removeItem("senha");
        localStorage.removeItem("nome");
        checkAuth();
        showToast("Logout realizado com sucesso!");
      }

      // Event Listeners
      document.getElementById("userForm").addEventListener("submit", handleRegister);
      document.getElementById("loginBtn").addEventListener("click", handleLogin);
      document.getElementById("logoutBtn").addEventListener("click", logout);
      document.getElementById("messageForm").addEventListener("submit", sendMessage);
      
      // Auto-growing textarea
      const messageInput = document.getElementById("messageInput");
      messageInput.addEventListener("input", function() {
        this.style.height = "auto";
        this.style.height = this.scrollHeight + "px";
      });
      
      // Handle enter key (send message) but allow shift+enter for new line
      messageInput.addEventListener("keydown", function(e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      // Initial auth check
      checkAuth();
    </script>
  </body>
</html>
