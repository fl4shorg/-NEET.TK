
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Respostas Gartic</title>
  <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
  <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
  
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'gartic-purple': '#9b87f5',
            'gartic-gold': '#FFD700',
            'gartic-silver': '#C0C0C0',
            'gartic-bronze': '#CD7F32'
          }
        }
      }
    }
  </script>

  <style>
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .animate-fade-in {
      animation: fadeIn 0.5s ease-out;
    }

    .animate-pulse-opacity {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    .medal-gold {
      background: #FFD700;
      color: black;
      font-weight: bold;
      border-radius: 9999px;
      width: 1.5rem;
      height: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .medal-silver {
      background: #C0C0C0;
      color: black;
      font-weight: bold;
      border-radius: 9999px;
      width: 1.5rem;
      height: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .medal-bronze {
      background: #CD7F32;
      color: black;
      font-weight: bold;
      border-radius: 9999px;
      width: 1.5rem;
      height: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .trophy-icon {
      color: #9b87f5;
    }

    .dark .trophy-icon {
      color: #b4a3f7;
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
  <!-- Theme Toggle -->
  <button 
    id="themeToggle"
    class="fixed top-4 right-4 p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
  >
    <svg id="sunIcon" class="w-6 h-6 text-yellow-500 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
    </svg>
    <svg id="moonIcon" class="w-6 h-6 text-gray-800 dark:text-gray-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
    </svg>
  </button>

  <!-- Navbar -->
  <nav class="sticky top-0 z-50 w-full border-b border-gray-200 dark:border-gray-700 bg-white/95 dark:bg-gray-800/95 backdrop-blur supports-[backdrop-filter]:bg-white/60">
    <div class="container mx-auto px-4 h-16 flex items-center justify-between">
      <div class="text-2xl font-bold bg-gradient-to-r from-gartic-purple to-blue-500 bg-clip-text text-transparent">
        Respostas Gartic
      </div>
      <div class="flex items-center space-x-2">
        <span class="text-gray-600 dark:text-gray-300">Total Respostas:</span>
        <span class="font-bold text-gartic-purple" id="totalRespostas">0</span>
      </div>
    </div>
  </nav>

  <main class="container mx-auto px-4 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Ranking Section -->
      <div class="lg:col-span-1">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 animate-fade-in">
          <h2 class="text-xl font-bold mb-4 text-center bg-gradient-to-r from-gartic-purple to-blue-500 bg-clip-text text-transparent">
            Top 10 Jogadores
          </h2>
          <div id="ranking" class="space-y-3"></div>
        </div>
      </div>

      <!-- Responses Section -->
      <div class="lg:col-span-2">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 animate-fade-in">
          <!-- Search Bar -->
          <div class="relative mb-6">
            <input
              type="text"
              id="searchInput"
              placeholder="Pesquisar respostas..."
              class="w-full px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-gartic-purple focus:border-transparent"
            >
            <svg class="absolute right-3 top-2.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>

          <!-- Filter Buttons -->
          <div class="flex flex-wrap gap-2 mb-6">
            <button
              id="filterAll"
              class="flex-1 px-4 py-2 rounded-md bg-gartic-purple text-white hover:bg-opacity-90 transition-colors"
            >
              Todos
            </button>
            <button
              id="filterPending"
              class="flex-1 px-4 py-2 rounded-md border border-gartic-purple text-gartic-purple hover:bg-gartic-purple hover:text-white transition-colors"
            >
              NÃ£o Respondidos
            </button>
            <button
              id="filterAnswered"
              class="flex-1 px-4 py-2 rounded-md border border-gartic-purple text-gartic-purple hover:bg-gartic-purple hover:text-white transition-colors"
            >
              Respondidos
            </button>
          </div>

          <!-- Sort Buttons -->
          <div class="flex justify-center gap-2 mb-6">
            <button
              id="sortAlpha"
              class="px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"/>
              </svg>
            </button>
            <button
              id="sortRecent"
              class="px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </button>
            <button
              id="sortPoints"
              class="px-4 py-2 rounded-md border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            >
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
              </svg>
            </button>
          </div>

          <!-- Responses List -->
          <div id="responsesList" class="space-y-4"></div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // API Configuration
    const API_URL = 'https://script.google.com/macros/s/AKfycbyyQ8wPaVhxUh8AiKvJEREHqQUcd3OE_pL4eewfGcQs3LgvE5sVWtNxjWbLiZe3RwF6ig/exec';
    const API_TOKEN = 'SUA_CHAVE_SECRETA';

    // State Management
    let allResponses = [];
    let currentFilter = 'all';
    let currentSort = 'recent';
    let searchTerm = '';

    // Theme Management
    const themeToggle = document.getElementById('themeToggle');
    const sunIcon = document.getElementById('sunIcon');
    const moonIcon = document.getElementById('moonIcon');

    // Check for saved theme preference or system preference
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
      sunIcon.classList.remove('hidden');
      moonIcon.classList.add('hidden');
    } else {
      document.documentElement.classList.remove('dark');
      moonIcon.classList.remove('hidden');
      sunIcon.classList.add('hidden');
    }

    // Theme toggle handler
    themeToggle.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      sunIcon.classList.toggle('hidden');
      moonIcon.classList.toggle('hidden');
      localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
    });

    // Fetch and render data
    async function fetchData() {
      try {
        const response = await fetch(`${API_URL}?id=&token=${API_TOKEN}`);
        const data = await response.json();

        if (data.status === 'sucesso') {
          allResponses = data.dados;
          document.getElementById('totalRespostas').textContent = data.dados.length;
          renderRanking();
          filterAndRenderResponses();
        } else {
          throw new Error(data.mensagem || 'Erro desconhecido');
        }
      } catch (error) {
        console.error('Erro ao buscar dados:', error);
        showToast('Erro ao carregar dados', 'error');
      }
    }

    // Render ranking
    function renderRanking() {
      const rankingContainer = document.getElementById('ranking');
      const sortedPlayers = [...allResponses].sort((a, b) => b.pontos - a.pontos).slice(0, 10);

      rankingContainer.innerHTML = sortedPlayers.map((player, index) => `
        <div class="flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
          <div class="flex items-center space-x-3">
            ${index === 0 ? '<span class="medal-gold">1</span>' :
              index === 1 ? '<span class="medal-silver">2</span>' :
              index === 2 ? '<span class="medal-bronze">3</span>' :
              `<div class="w-6 h-6 flex items-center justify-center">
                <svg class="trophy-icon h-5 w-5" style="opacity: ${1 - (index * 0.06)}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                </svg>
              </div>`
            }
            <span class="font-medium ${
              index === 0 ? 'text-gartic-gold' :
              index === 1 ? 'text-gartic-silver' :
              index === 2 ? 'text-gartic-bronze' : ''
            }">
              ${player.nome}
            </span>
          </div>
          <span class="font-bold text-gartic-purple">${player.pontos} pts</span>
        </div>
      `).join('');
    }

    // Filter and render responses
    function filterAndRenderResponses() {
      let filtered = [...allResponses];

      // Apply search filter
      if (searchTerm) {
        const term = searchTerm.toLowerCase();
        filtered = filtered.filter(response =>
          String(response.resposta).toLowerCase().includes(term) ||
          response.nome.toLowerCase().includes(term)
        );
      }

      // Apply status filter
      if (currentFilter === 'pending') {
        filtered = filtered.filter(r => r.novaRespostaCampo === "Sim");
      } else if (currentFilter === 'answered') {
        filtered = filtered.filter(r => r.novaRespostaCampo === "NÃ£o");
      }

      // Apply sorting
      filtered.sort((a, b) => {
        if (currentSort === 'alphabetical') {
          return String(a.resposta).localeCompare(String(b.resposta));
        } else if (currentSort === 'recent') {
          return new Date(b.dataHora).getTime() - new Date(a.dataHora).getTime();
        } else if (currentSort === 'points') {
          return b.pontos - a.pontos;
        }
        return 0;
      });

      // Render responses
      const responsesContainer = document.getElementById('responsesList');
      responsesContainer.innerHTML = filtered.map(response => `
        <div class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-300 ${
          response.novaRespostaCampo === "Sim" ? 'border-l-4 border-l-gartic-purple' : ''
        }">
          <div class="flex flex-col space-y-2">
            <div class="flex justify-between items-center">
              <div class="font-medium text-gray-900 dark:text-gray-100">${response.nome}</div>
              <div class="text-sm bg-gray-200/50 dark:bg-gray-600/50 px-2 py-0.5 rounded-full">
                ${response.pontos} pontos
              </div>
            </div>
            
            <div class="text-lg font-semibold text-gray-800 dark:text-gray-200">${response.resposta}</div>
            
            <div class="flex justify-between items-center text-sm text-gray-500 dark:text-gray-400">
              <div>${new Date(response.dataHora).toLocaleString('pt-BR')}</div>
              <div>${response.novaRespostaCampo === "Sim" ? "NÃ£o Respondido" : "Respondido"}</div>
            </div>
            
            ${response.novaRespostaCampo === "Sim" ? `
              <div class="flex justify-end space-x-2 mt-2">
                <button
                  onclick="handleResponse('${response.id}', 'errou')"
                  class="px-4 py-2 rounded-md bg-red-100 hover:bg-red-200 text-red-700 dark:bg-red-900/30 dark:hover:bg-red-900/50 dark:text-red-400 transition-colors flex items-center"
                >
                  <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  Errou
                </button>
                <button
                  onclick="handleResponse('${response.id}', 'acertou')"
                  class="px-4 py-2 rounded-md bg-green-100 hover:bg-green-200 text-green-700 dark:bg-green-900/30 dark:hover:bg-green-900/50 dark:text-green-400 transition-colors flex items-center"
                >
                  <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  Acertou
                </button>
              </div>
            ` : ''}
          </div>
        </div>
      `).join('');
    }

    // Handle response update
    async function handleResponse(id, type) {
      const button = event.target.closest('button');
      const card = button.closest('.bg-gray-50');
      
      // Add loading state
      button.disabled = true;
      card.classList.add('animate-pulse-opacity');

      try {
        const acertou = type === 'acertou' ? 'true' : 'false';
        const errou = type === 'errou' ? 'true' : 'false';
        
        const response = await fetch(`${API_URL}?id=${id}&acertou=${acertou}&errou=${errou}&token=${API_TOKEN}`);
        const data = await response.json();

        if (data.status === 'sucesso') {
          showToast('Resposta atualizada com sucesso!', 'success');
          await fetchData(); // Refresh data
        } else {
          throw new Error(data.mensagem || 'Erro ao atualizar resposta');
        }
      } catch (error) {
        console.error('Erro ao atualizar resposta:', error);
        showToast('Erro ao atualizar resposta', 'error');
      } finally {
        // Remove loading state
        button.disabled = false;
        card.classList.remove('animate-pulse-opacity');
      }
    }

    // Toast notification
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white transform transition-all duration-300 ${
        type === 'error' ? 'bg-red-500' :
        type === 'success' ? 'bg-green-500' :
        'bg-blue-500'
      }`;
      toast.textContent = message;
      document.body.appendChild(toast);

      // Animate in
      requestAnimationFrame(() => {
        toast.style.transform = 'translateY(0)';
        toast.style.opacity = '1';
      });

      // Remove after 3 seconds
      setTimeout(() => {
        toast.style.transform = 'translateY(100%)';
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Event Listeners
    document.getElementById('searchInput').addEventListener('input', (e) => {
      searchTerm = e.target.value;
      filterAndRenderResponses();
    });

    document.getElementById('filterAll').addEventListener('click', () => {
      currentFilter = 'all';
      filterAndRenderResponses();
    });

    document.getElementById('filterPending').addEventListener('click', () => {
      currentFilter = 'pending';
      filterAndRenderResponses();
    });

    document.getElementById('filterAnswered').addEventListener('click', () => {
      currentFilter = 'answered';
      filterAndRenderResponses();
    });

    document.getElementById('sortAlpha').addEventListener('click', () => {
      currentSort = 'alphabetical';
      filterAndRenderResponses();
    });

    document.getElementById('sortRecent').addEventListener('click', () => {
      currentSort = 'recent';
      filterAndRenderResponses();
    });

    document.getElementById('sortPoints').addEventListener('click', () => {
      currentSort = 'points';
      filterAndRenderResponses();
    });

    // Initial load
    fetchData();
  </script>
</body>
</html>
