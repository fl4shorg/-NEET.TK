
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Link Manager Dashboard</title>
  <meta name="description" content="Modern Visual Link Manager" />
  <meta name="author" content="Lovable" />
  <meta property="og:image" content="/og-image.png" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --background: 0 0% 100%;
      --foreground: 222.2 84% 4.9%;
      --card: 0 0% 100%;
      --card-foreground: 222.2 84% 4.9%;
      --popover: 0 0% 100%;
      --popover-foreground: 222.2 84% 4.9%;
      --primary: 221.2 83.2% 53.3%;
      --primary-foreground: 210 40% 98%;
      --secondary: 210 40% 96.1%;
      --secondary-foreground: 222.2 47.4% 11.2%;
      --muted: 210 40% 96.1%;
      --muted-foreground: 215.4 16.3% 46.9%;
      --accent: 210 40% 96.1%;
      --accent-foreground: 222.2 47.4% 11.2%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 210 40% 98%;
      --border: 214.3 31.8% 91.4%;
      --input: 214.3 31.8% 91.4%;
      --ring: 221.2 83.2% 53.3%;
      --radius: 0.5rem;
    }

    .dark {
      --background: 222.2 84% 4.9%;
      --foreground: 210 40% 98%;
      --card: 222.2 84% 4.9%;
      --card-foreground: 210 40% 98%;
      --popover: 222.2 84% 4.9%;
      --popover-foreground: 210 40% 98%;
      --primary: 217.2 91.2% 59.8%;
      --primary-foreground: 222.2 47.4% 11.2%;
      --secondary: 217.2 32.6% 17.5%;
      --secondary-foreground: 210 40% 98%;
      --muted: 217.2 32.6% 17.5%;
      --muted-foreground: 215 20.2% 65.1%;
      --accent: 217.2 32.6% 17.5%;
      --accent-foreground: 210 40% 98%;
      --destructive: 0 62.8% 30.6%;
      --destructive-foreground: 210 40% 98%;
      --border: 217.2 32.6% 17.5%;
      --input: 217.2 32.6% 17.5%;
      --ring: 224.3 76.3% 48%;
    }
    
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 4px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .toast.success {
      background-color: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
    }
    
    .toast.error {
      background-color: hsl(var(--destructive));
      color: hsl(var(--destructive-foreground));
    }
    
    .toast.visible {
      opacity: 1;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      border-radius: var(--radius);
      padding: 20px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    input, select, textarea {
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      border: 1px solid hsl(var(--border));
      border-radius: var(--radius);
      padding: 8px 12px;
      width: 100%;
      margin-bottom: 10px;
    }
    
    button {
      cursor: pointer;
      border-radius: var(--radius);
      font-weight: 500;
      transition: background-color 0.3s ease;
    }
    
    button.primary {
      background-color: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
      border: none;
      padding: 8px 16px;
    }
    
    button.primary:hover {
      opacity: 0.9;
    }
    
    button.secondary {
      background-color: hsl(var(--secondary));
      color: hsl(var(--secondary-foreground));
      border: none;
      padding: 8px 16px;
    }
    
    button.secondary:hover {
      opacity: 0.9;
    }
    
    button.destructive {
      background-color: hsl(var(--destructive));
      color: hsl(var(--destructive-foreground));
      border: none;
      padding: 8px 16px;
    }
    
    button.destructive:hover {
      opacity: 0.9;
    }
    
    .card {
      background-color: hsl(var(--card));
      color: hsl(var(--card-foreground));
      border-radius: var(--radius);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .toggle {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: hsl(var(--muted));
      transition: 0.4s;
      border-radius: 34px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: hsl(var(--primary));
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
  </style>
</head>
<body>
  <div id="app" class="container mx-auto p-4"></div>

  <div id="toast" class="toast"></div>
  
  <!-- Add Link Modal -->
  <div id="addLinkModal" class="modal">
    <div class="modal-content">
      <h2 class="text-xl font-bold mb-4">Add Link</h2>
      <form id="addLinkForm">
        <div class="mb-4">
          <label class="block mb-2">Title</label>
          <input type="text" id="addTitle" required>
        </div>
        <div class="mb-4">
          <label class="block mb-2">URL</label>
          <input type="url" id="addUrl" required>
        </div>
        <div class="mb-4">
          <label class="block mb-2">Category</label>
          <select id="addCategory">
            <option value="social">Social</option>
            <option value="business">Business</option>
            <option value="personal">Personal</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block mb-2">Description</label>
          <textarea id="addDescription" rows="3"></textarea>
        </div>
        <div class="flex justify-end gap-2">
          <button type="button" class="secondary" onclick="closeModal('addLinkModal')">Cancel</button>
          <button type="submit" class="primary">Add</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Edit Link Modal -->
  <div id="editLinkModal" class="modal">
    <div class="modal-content">
      <h2 class="text-xl font-bold mb-4">Edit Link</h2>
      <form id="editLinkForm">
        <input type="hidden" id="editId">
        <div class="mb-4">
          <label class="block mb-2">Title</label>
          <input type="text" id="editTitle" required>
        </div>
        <div class="mb-4">
          <label class="block mb-2">URL</label>
          <input type="url" id="editUrl" required>
        </div>
        <div class="mb-4">
          <label class="block mb-2">Category</label>
          <select id="editCategory">
            <option value="social">Social</option>
            <option value="business">Business</option>
            <option value="personal">Personal</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block mb-2">Description</label>
          <textarea id="editDescription" rows="3"></textarea>
        </div>
        <div class="flex justify-end gap-2">
          <button type="button" class="secondary" onclick="closeModal('editLinkModal')">Cancel</button>
          <button type="submit" class="primary">Save</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Confirm Dialog -->
  <div id="confirmDialog" class="modal">
    <div class="modal-content">
      <h2 class="text-xl font-bold mb-4" id="confirmTitle">Confirm</h2>
      <p id="confirmMessage" class="mb-4">Are you sure you want to proceed?</p>
      <div class="flex justify-end gap-2">
        <button class="secondary" onclick="closeModal('confirmDialog')">Cancel</button>
        <button id="confirmButton" class="destructive">Confirm</button>
      </div>
    </div>
  </div>
  
  <!-- Report Modal -->
  <div id="reportModal" class="modal">
    <div class="modal-content">
      <h2 class="text-xl font-bold mb-4">Link Report</h2>
      <div id="reportContent" class="mb-4 p-4 border rounded">
        <h3 class="text-lg font-bold mb-2">Link Statistics</h3>
        <div id="reportStats" class="mb-4"></div>
        <h3 class="text-lg font-bold mb-2">Active Links</h3>
        <div id="reportLinks" class="mb-4"></div>
      </div>
      <div class="flex justify-end gap-2">
        <button class="secondary" onclick="closeModal('reportModal')">Close</button>
        <button class="primary" onclick="printReport()">Print</button>
        <button class="primary" onclick="downloadReportPDF()">Download PDF</button>
        <button class="primary" onclick="shareReport()">Share</button>
      </div>
    </div>
  </div>

  <script>
    // State
    const state = {
      links: [],
      statistics: {
        totalLinks: 0,
        activeLinks: 0,
        totalClicks: 0,
        categories: {}
      },
      theme: localStorage.getItem('theme') || 'light'
    };

    // Set initial theme
    if (state.theme === 'dark' || (window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('theme'))) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }

    // API Functions
    async function getStatistics() {
      try {
        // In a real app, this would be an API call
        // For demo, we'll calculate based on current links
        state.statistics.totalLinks = state.links.length;
        state.statistics.activeLinks = state.links.filter(link => link.active).length;
        state.statistics.totalClicks = state.links.reduce((sum, link) => sum + (link.clicks || 0), 0);
        
        // Calculate category statistics
        const categories = {};
        state.links.forEach(link => {
          if (!categories[link.category]) {
            categories[link.category] = 0;
          }
          categories[link.category]++;
        });
        state.statistics.categories = categories;
        
        return state.statistics;
      } catch (error) {
        console.error('Failed to fetch statistics:', error);
        showToast('Failed to fetch statistics', 'error');
        return state.statistics;
      }
    }

    async function getLinks() {
      try {
        // In a real app, this would be an API call
        // For demo, we'll use localStorage
        const storedLinks = localStorage.getItem('links');
        if (storedLinks) {
          state.links = JSON.parse(storedLinks);
        }
        return state.links;
      } catch (error) {
        console.error('Failed to fetch links:', error);
        showToast('Failed to fetch links', 'error');
        return [];
      }
    }

    async function createLink(link) {
      try {
        // In a real app, this would be an API call
        const newLink = {
          id: Date.now().toString(),
          ...link,
          active: true,
          created: new Date().toISOString(),
          clicks: 0
        };
        state.links.push(newLink);
        localStorage.setItem('links', JSON.stringify(state.links));
        showToast('Link added successfully', 'success');
        return newLink;
      } catch (error) {
        console.error('Failed to create link:', error);
        showToast('Failed to create link', 'error');
        throw error;
      }
    }

    async function updateLink(id, linkData) {
      try {
        // In a real app, this would be an API call
        const index = state.links.findIndex(link => link.id === id);
        if (index !== -1) {
          state.links[index] = { ...state.links[index], ...linkData };
          localStorage.setItem('links', JSON.stringify(state.links));
          showToast('Link updated successfully', 'success');
          return state.links[index];
        }
        throw new Error('Link not found');
      } catch (error) {
        console.error('Failed to update link:', error);
        showToast('Failed to update link', 'error');
        throw error;
      }
    }

    async function deleteLink(id) {
      try {
        // In a real app, this would be an API call
        const index = state.links.findIndex(link => link.id === id);
        if (index !== -1) {
          state.links.splice(index, 1);
          localStorage.setItem('links', JSON.stringify(state.links));
          showToast('Link deleted successfully', 'success');
          return true;
        }
        throw new Error('Link not found');
      } catch (error) {
        console.error('Failed to delete link:', error);
        showToast('Failed to delete link', 'error');
        throw error;
      }
    }

    async function updateLinkStatus(id, active) {
      try {
        // In a real app, this would be an API call
        const index = state.links.findIndex(link => link.id === id);
        if (index !== -1) {
          state.links[index].active = active;
          localStorage.setItem('links', JSON.stringify(state.links));
          showToast(`Link ${active ? 'activated' : 'deactivated'} successfully`, 'success');
          return state.links[index];
        }
        throw new Error('Link not found');
      } catch (error) {
        console.error('Failed to update link status:', error);
        showToast('Failed to update link status', 'error');
        throw error;
      }
    }

    async function activateAllLinks() {
      try {
        // In a real app, this would be an API call
        state.links.forEach(link => {
          link.active = true;
        });
        localStorage.setItem('links', JSON.stringify(state.links));
        showToast('All links activated successfully', 'success');
        return state.links;
      } catch (error) {
        console.error('Failed to activate all links:', error);
        showToast('Failed to activate all links', 'error');
        throw error;
      }
    }

    async function deactivateAllLinks() {
      try {
        // In a real app, this would be an API call
        state.links.forEach(link => {
          link.active = false;
        });
        localStorage.setItem('links', JSON.stringify(state.links));
        showToast('All links deactivated successfully', 'success');
        return state.links;
      } catch (error) {
        console.error('Failed to deactivate all links:', error);
        showToast('Failed to deactivate all links', 'error');
        throw error;
      }
    }

    // Icon Components
    const icons = {
      edit: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>`,
      delete: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`,
      copy: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`,
      moon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`,
      sun: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`,
      link: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>`,
      report: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>`,
      plus: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`,
      click: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path><circle cx="12" cy="12" r="3"></circle></svg>`,
      category: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h18v18H3zM21 9H3M21 15H3M12 3v18"></path></svg>`,
      social: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>`,
      business: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>`,
      personal: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`,
      other: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>`,
      open: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>`
    };

    // Utility Functions
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} visible`;
      setTimeout(() => {
        toast.className = 'toast';
      }, 3000);
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text)
        .then(() => {
          showToast('Copied to clipboard!', 'success');
        })
        .catch(err => {
          console.error('Failed to copy text: ', err);
          showToast('Failed to copy to clipboard', 'error');
        });
    }

    // Data Functions
    async function refreshData() {
      await getLinks();
      await getStatistics();
      renderApp();
    }

    async function addLink(event) {
      event.preventDefault();
      const title = document.getElementById('addTitle').value;
      const url = document.getElementById('addUrl').value;
      const category = document.getElementById('addCategory').value;
      const description = document.getElementById('addDescription').value;
      
      await createLink({ title, url, category, description });
      closeModal('addLinkModal');
      refreshData();
    }

    async function editLink(event) {
      event.preventDefault();
      const id = document.getElementById('editId').value;
      const title = document.getElementById('editTitle').value;
      const url = document.getElementById('editUrl').value;
      const category = document.getElementById('editCategory').value;
      const description = document.getElementById('editDescription').value;
      
      await updateLink(id, { title, url, category, description });
      closeModal('editLinkModal');
      refreshData();
    }

    async function removeLink(id) {
      showConfirmDialog(
        'Delete Link',
        'Are you sure you want to delete this link?',
        async () => {
          await deleteLink(id);
          refreshData();
        }
      );
    }

    async function toggleLinkStatus(id, currentStatus) {
      await updateLinkStatus(id, !currentStatus);
      refreshData();
    }

    async function activateAll() {
      showConfirmDialog(
        'Activate All Links',
        'Are you sure you want to activate all links?',
        async () => {
          await activateAllLinks();
          refreshData();
        }
      );
    }

    async function deactivateAll() {
      showConfirmDialog(
        'Deactivate All Links',
        'Are you sure you want to deactivate all links?',
        async () => {
          await deactivateAllLinks();
          refreshData();
        }
      );
    }

    // UI Functions
    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.style.display = 'flex';
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.style.display = 'none';
    }

    function showAddLinkModal() {
      document.getElementById('addLinkForm').reset();
      openModal('addLinkModal');
    }

    function showEditLinkModal(link) {
      document.getElementById('editId').value = link.id;
      document.getElementById('editTitle').value = link.title;
      document.getElementById('editUrl').value = link.url;
      document.getElementById('editCategory').value = link.category;
      document.getElementById('editDescription').value = link.description || '';
      openModal('editLinkModal');
    }

    function showConfirmDialog(title, message, onConfirm) {
      document.getElementById('confirmTitle').textContent = title;
      document.getElementById('confirmMessage').textContent = message;
      
      const confirmButton = document.getElementById('confirmButton');
      // Remove previous event listeners
      const newConfirmButton = confirmButton.cloneNode(true);
      confirmButton.parentNode.replaceChild(newConfirmButton, confirmButton);
      
      newConfirmButton.addEventListener('click', () => {
        onConfirm();
        closeModal('confirmDialog');
      });
      
      openModal('confirmDialog');
    }

    function toggleTheme() {
      if (document.documentElement.classList.contains('dark')) {
        document.documentElement.classList.remove('dark');
        state.theme = 'light';
      } else {
        document.documentElement.classList.add('dark');
        state.theme = 'dark';
      }
      localStorage.setItem('theme', state.theme);
      renderApp();
    }

    // Report functions
    function showReportModal() {
      const reportStats = document.getElementById('reportStats');
      const reportLinks = document.getElementById('reportLinks');
      
      // Generate statistics summary
      reportStats.innerHTML = `
        <p><strong>Total Links:</strong> ${state.statistics.totalLinks}</p>
        <p><strong>Active Links:</strong> ${state.statistics.activeLinks}</p>
        <p><strong>Total Clicks:</strong> ${state.statistics.totalClicks}</p>
        <p><strong>Categories:</strong></p>
        <ul>
          ${Object.entries(state.statistics.categories).map(([category, count]) => 
            `<li>${category}: ${count}</li>`
          ).join('')}
        </ul>
      `;
      
      // Generate links list
      reportLinks.innerHTML = state.links
        .filter(link => link.active)
        .map(link => `
          <div class="mb-2">
            <p><strong>${link.title}</strong> (${link.category})</p>
            <p><small>${link.url}</small></p>
            <p>Clicks: ${link.clicks || 0}</p>
          </div>
        `).join('') || '<p>No active links found.</p>';
      
      openModal('reportModal');
    }

    function printReport() {
      const reportContent = document.getElementById('reportContent').innerHTML;
      const printWindow = window.open('', '_blank');
      printWindow.document.write(`
        <html>
          <head>
            <title>Link Report</title>
            <style>
              body { font-family: Arial, sans-serif; padding: 20px; }
              h1 { text-align: center; }
            </style>
          </head>
          <body>
            <h1>Link Report</h1>
            ${reportContent}
          </body>
        </html>
      `);
      printWindow.document.close();
      printWindow.print();
    }

    async function downloadReportPDF() {
      try {
        const { jsPDF } = window.jspdf;
        const reportElement = document.getElementById('reportContent');
        
        html2canvas(reportElement).then(canvas => {
          const imgData = canvas.toDataURL('image/png');
          const pdf = new jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4'
          });
          const imgProps = pdf.getImageProperties(imgData);
          const pdfWidth = pdf.internal.pageSize.getWidth();
          const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
          
          pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
          pdf.save('link-report.pdf');
        });
      } catch (error) {
        console.error('Failed to generate PDF:', error);
        showToast('Failed to generate PDF', 'error');
      }
    }

    function shareReport() {
      if (navigator.share) {
        navigator.share({
          title: 'Link Manager Report',
          text: `Total Links: ${state.statistics.totalLinks}, Active Links: ${state.statistics.activeLinks}, Total Clicks: ${state.statistics.totalClicks}`,
          url: window.location.href,
        })
        .then(() => showToast('Report shared successfully', 'success'))
        .catch((error) => {
          console.error('Error sharing:', error);
          showToast('Failed to share report', 'error');
        });
      } else {
        copyToClipboard(`Link Manager Report:
          Total Links: ${state.statistics.totalLinks}
          Active Links: ${state.statistics.activeLinks}
          Total Clicks: ${state.statistics.totalClicks}`);
      }
    }

    // Rendering Functions
    function renderStatistics() {
      return `
        <div class="mb-6">
          <h2 class="text-2xl font-bold mb-4">Statistics</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            ${renderStatCard('Total Links', state.statistics.totalLinks, 'link')}
            ${renderStatCard('Active Links', state.statistics.activeLinks, 'link')}
            ${renderStatCard('Total Clicks', state.statistics.totalClicks, 'click')}
            ${renderStatCard('Categories', Object.keys(state.statistics.categories).length, 'category')}
          </div>
        </div>
      `;
    }

    function renderStatCard(title, value, iconKey) {
      return `
        <div class="card flex items-center">
          <div class="mr-4 p-2 bg-blue-100 dark:bg-blue-900 rounded-full">
            ${icons[iconKey]}
          </div>
          <div>
            <h3 class="font-medium">${title}</h3>
            <p class="text-2xl font-bold">${value}</p>
          </div>
        </div>
      `;
    }

    function renderLinksList() {
      return `
        <div>
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold">Links</h2>
            <div class="flex gap-2">
              <button class="primary flex items-center" onclick="showAddLinkModal()">
                ${icons.plus} <span class="ml-1">Add Link</span>
              </button>
              <button class="secondary flex items-center" onclick="showReportModal()">
                ${icons.report} <span class="ml-1">Report</span>
              </button>
            </div>
          </div>
          
          <div class="mb-4">
            <button class="secondary mr-2" onclick="activateAll()">Activate All</button>
            <button class="secondary" onclick="deactivateAll()">Deactivate All</button>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            ${state.links.length > 0 
              ? state.links.map(link => renderLinkCard(link)).join('') 
              : '<p class="col-span-3 text-center py-8">No links found. Add your first link!</p>'}
          </div>
        </div>
      `;
    }

    function renderLinkCard(link) {
      const categoryIcon = icons[link.category] || icons.other;
      
      return `
        <div class="card">
          <div class="flex justify-between items-start">
            <h3 class="font-bold text-lg mb-2">${link.title}</h3>
            <div class="flex">
              <button class="p-1" onclick="showEditLinkModal(${JSON.stringify(link).replace(/"/g, '&quot;')})">
                ${icons.edit}
              </button>
              <button class="p-1" onclick="removeLink('${link.id}')">
                ${icons.delete}
              </button>
            </div>
          </div>
          
          <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mb-2">
            ${categoryIcon}
            <span class="ml-1 capitalize">${link.category}</span>
          </div>
          
          <p class="mb-2 text-sm truncate">
            <a href="${link.url}" target="_blank" class="text-blue-500 hover:underline flex items-center">
              ${link.url} ${icons.open}
            </a>
          </p>
          
          ${link.description ? `<p class="mb-4 text-sm">${link.description}</p>` : ''}
          
          <div class="flex justify-between items-center mt-2">
            <div class="flex items-center">
              <span class="mr-2">Active</span>
              <label class="toggle">
                <input type="checkbox" ${link.active ? 'checked' : ''} onchange="toggleLinkStatus('${link.id}', ${link.active})">
                <span class="slider"></span>
              </label>
            </div>
            
            <div class="flex items-center">
              ${icons.click}
              <span class="ml-1">${link.clicks || 0}</span>
            </div>
          </div>
        </div>
      `;
    }

    function renderApp() {
      const app = document.getElementById('app');
      
      app.innerHTML = `
        <header class="flex justify-between items-center mb-8">
          <h1 class="text-3xl font-bold">Link Manager</h1>
          <button class="p-2 rounded-full bg-gray-200 dark:bg-gray-700" onclick="toggleTheme()">
            ${state.theme === 'dark' ? icons.sun : icons.moon}
          </button>
        </header>
        
        ${renderStatistics()}
        ${renderLinksList()}
      `;
      
      // Setup event listeners
      document.getElementById('addLinkForm').addEventListener('submit', addLink);
      document.getElementById('editLinkForm').addEventListener('submit', editLink);
      
      // Close modals when clicking outside
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        modal.addEventListener('click', event => {
          if (event.target === modal) {
            modal.style.display = 'none';
          }
        });
      });
    }

    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
      refreshData();
    });
  </script>
</body>
</html>
