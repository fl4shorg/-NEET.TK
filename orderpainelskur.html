<html class="scroll-smooth" lang="pt-BR" data-theme="dark">
 <head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>Order Sticker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
   href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
   rel="stylesheet"
  />
  <link
   href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;display=swap"
   rel="stylesheet"
  />
  <style>
   body {
    font-family: "Inter", sans-serif;
    transition: background-color 0.3s, color 0.3s;
   }
   /* Dark theme */
   [data-theme="dark"] {
    --bg-color: #121826;
    --text-color: #cbd5e1;
    --header-bg: #1f2937;
    --input-bg: #1f2937;
    --input-border: #334155;
    --placeholder-color: #94a3b8;
    --card-bg: #0f172a;
    --card-border: #7c5aff;
    --time-bg: #1e293b;
    --time-text: #60a5fa;
    --status-indicator: #34d399;
    --status-text: #94a3b8;
    --btn-bg: #334155;
    --connected-indicator: #93c5fd; /* pastel blue */
   }
   /* Light theme */
   [data-theme="light"] {
    --bg-color: #f9fafb;
    --text-color: #1e293b;
    --header-bg: #e2e8f0;
    --input-bg: #fff;
    --input-border: #cbd5e1;
    --placeholder-color: #64748b;
    --card-bg: #fff;
    --card-border: #7c5aff;
    --time-bg: #e0e7ff;
    --time-text: #3b82f6;
    --status-indicator: #10b981;
    --status-text: #475569;
    --btn-bg: #cbd5e1;
    --connected-indicator: #bfdbfe; /* pastel blue light */
   }
   body {
    background-color: var(--bg-color);
    color: var(--text-color);
   }
   header {
    background-color: transparent;
   }
   input,
   select {
    background-color: var(--input-bg);
    border-color: var(--input-border);
    color: var(--text-color);
   }
   input::placeholder {
    color: var(--placeholder-color);
   }
   .card {
    background-color: var(--card-bg);
    border-color: var(--card-border);
    color: var(--text-color);
   }
   .time-label {
    background-color: var(--time-bg);
    color: var(--time-text);
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding-left: 1rem;
    padding-right: 1rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 600;
    user-select: none;
  }
   .status-indicator {
    background-color: var(--status-indicator);
   }
   .status-text {
    color: var(--status-text);
   }
   .btn-filter {
    background-color: var(--btn-bg);
   }
   .connected-indicator {
    background-color: var(--connected-indicator);
   }
   /* Transition for theme change */
   .transition-colors {
    transition-property: background-color, border-color, color;
    transition-duration: 0.3s;
    transition-timing-function: ease-in-out;
   }
  </style>
 </head>
 <body class="min-h-screen p-4 transition-colors" data-theme="dark">
  <header
   class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 transition-colors gap-4 sm:gap-0"
  >
   <div class="flex items-center gap-4 flex-wrap sm:flex-nowrap justify-between w-full sm:w-auto">
    <div
     class="w-12 h-12 rounded-xl bg-gradient-to-br from-[#7c5aff] to-[#4e3eff] flex items-center justify-center text-white flex-shrink-0"
    >
     <svg
      class="w-6 h-6"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
      aria-hidden="true"
     >
      <path d="M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z"></path>
      <path d="M14 3v4a2 2 0 0 0 2 2h4"></path>
      <path d="M8 13h.01"></path>
      <path d="M16 13h.01"></path>
      <path d="M10 16s.8 1 2 1c1.3 0 2-1 2-1"></path>
     </svg>
    </div>
    <h1
     class="text-2xl font-extrabold leading-none select-none flex-grow sm:flex-grow-0 text-center sm:text-left"
     id="title"
    >
     Order Sticker
    </h1>
    <button
     id="btnThemeToggle"
     aria-label="Alternar tema claro e escuro"
     class="w-10 h-10 rounded-full bg-[var(--btn-bg)] flex items-center justify-center text-[var(--text-color)] transition-colors flex-shrink-0"
     title="Alternar tema claro e escuro"
    >
     <svg
      id="iconTheme"
      xmlns="http://www.w3.org/2000/svg"
      class="w-6 h-6"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
     >
      <!-- Moon icon by default -->
      <path
       d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"
      ></path>
     </svg>
    </button>
   </div>
   <div
    class="flex items-center gap-4 justify-between w-full sm:w-auto flex-wrap sm:flex-nowrap"
   >
    <div class="flex flex-col items-center flex-shrink-0">
     <div
      class="mb-1 text-xs px-2 py-0.5 rounded border border-[var(--input-border)] text-[var(--placeholder-color)] select-none"
      id="versionLabel"
     >
      version 1.0 beta
     </div>
     <div
      class="flex items-center gap-2 bg-[var(--header-bg)] rounded-full px-4 py-1 select-none transition-colors w-full justify-center"
      id="greetingStatus"
      title="Saudação"
     >
      <span class="w-4 h-4 rounded-full connected-indicator block"></span>
      <span class="font-semibold text-[var(--text-color)] text-lg leading-none" id="greetingText">
       Carregando...
      </span>
     </div>
    </div>
    <div
     class="flex items-center gap-2 bg-[var(--header-bg)] rounded-full px-4 py-1 select-none transition-colors flex-shrink-0"
     id="pedidoCount"
    >
     <span class="w-4 h-4 rounded-full bg-[var(--status-indicator)] block"></span>
     <span class="font-semibold text-[var(--text-color)] text-lg leading-none" id="totalPedidosCount">
      0
     </span>
     <span class="font-semibold text-[var(--text-color)] text-lg leading-none">
      Pedidos
     </span>
    </div>
    <div
     class="flex items-center gap-2 bg-[var(--header-bg)] rounded-full px-4 py-1 select-none transition-colors flex-shrink-0"
     id="pedidoHojeCountContainer"
     title="Pedidos hoje para entregar"
    >
     <span class="w-4 h-4 rounded-full bg-[#facc15] block"></span>
     <span class="font-semibold text-[var(--text-color)] text-lg leading-none" id="pedidoHojeCount">
      0
     </span>
     <span class="font-semibold text-[var(--text-color)] text-lg leading-none">
      Pedidos hoje para entregar
     </span>
    </div>
   </div>
  </header>
  <section
   class="mb-6 rounded-xl border transition-colors border-[var(--input-border)] p-4 max-w-md w-full"
  >
   <form class="flex flex-col gap-4" onsubmit="event.preventDefault();">
    <label class="sr-only" for="search">Pesquisar pedidos</label>
    <input
     autocomplete="off"
     class="w-full rounded-lg py-3 px-4 text-lg focus:outline-none focus:ring-2 focus:ring-[#7c5aff] transition-colors border border-[var(--input-border)] bg-[var(--input-bg)] text-[var(--text-color)] placeholder-[var(--placeholder-color)]"
     id="search"
     placeholder="Pesquisar pedidos..."
     type="search"
     oninput="aplicarFiltros()"
    />
    <div class="flex items-center gap-2">
     <button
      aria-label="Filtrar pedidos"
      class="btn-filter w-14 h-14 rounded-lg flex items-center justify-center text-[var(--text-color)] text-2xl transition-colors"
      id="btnFiltro"
      type="button"
      onclick="toggleFiltroMenu()"
     >
      <i class="fas fa-filter"></i>
     </button>
     <select
      aria-label="Filtro de tempo"
      class="rounded-lg py-3 px-4 text-lg focus:outline-none focus:ring-2 focus:ring-[#7c5aff] transition-colors border border-[var(--input-border)] bg-[var(--input-bg)] text-[var(--text-color)]"
      id="filtroTempo"
      onchange="aplicarFiltros()"
     >
      <option value="todos" selected>Todos</option>
      <option value="ultimaHora">Última hora</option>
      <option value="hoje">Hoje</option>
      <option value="estaSemana">Esta semana</option>
      <option value="esteMes">Este mês</option>
     </select>
    </div>
   </form>
  </section>
  <div class="max-w-md w-full mb-6 px-2 flex items-center gap-2 select-none">
   <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-[var(--text-color)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
    <circle cx="12" cy="7" r="4" />
    <path d="M5.5 21a6.5 6.5 0 0113 0" />
   </svg>
   <div>
    <h2 class="text-lg font-semibold mb-1">Caixa de Entrada</h2>
    <p class="text-sm text-[var(--placeholder-color)]">Todos os pedidos</p>
   </div>
  </div>
  <section
   class="max-w-md w-full flex flex-col gap-6"
   id="listaPedidos"
  >
   <!-- Pedidos serão inseridos aqui -->
  </section>
  <script>
   const apiUrl =
    "https://script.google.com/macros/s/AKfycbwQW25Umk3TqMv4q47BbdJsb8frZMRa7_shbNhHDEx43xcser8OLxk8bDtgrs85P_90uQ/exec?dados=true";
   let pedidos = [];
   let pedidosFiltrados = [];

   // Função para formatar tempo decorrido em formato legível corrigida
   function tempoRelativo(dataString) {
    const data = new Date(dataString);
    const agora = new Date();
    let diffMs = agora - data;

    if (diffMs < 0) return "agora";

    const segundos = Math.floor(diffMs / 1000);
    if (segundos < 60)
     return segundos === 1 ? "há 1 segundo" : `há ${segundos} segundos`;

    const minutos = Math.floor(segundos / 60);
    if (minutos < 60) return minutos === 1 ? "há 1 minuto" : `há ${minutos} minutos`;

    const horas = Math.floor(minutos / 60);
    if (horas < 24) return horas === 1 ? "há 1 hora" : `há ${horas} horas`;

    const dias = Math.floor(horas / 24);
    if (dias < 30) return dias === 1 ? "há 1 dia" : `há ${dias} dias`;

    const meses = Math.floor(dias / 30);
    if (meses < 12) return meses === 1 ? "há 1 mês" : `há ${meses} meses`;

    const anos = Math.floor(meses / 12);
    return anos === 1 ? "há 1 ano" : `há ${anos} anos`;
   }

   // Função para criar o card de pedido
   function criarCardPedido(pedido) {
    const card = document.createElement("article");
    card.className =
     "card border rounded-xl p-4 flex flex-col gap-3 border-[var(--card-border)] transition-colors";

    const header = document.createElement("div");
    header.className = "flex justify-between items-start";

    const nomeContainer = document.createElement("div");
    nomeContainer.className = "flex items-center gap-2 select-none";

    const iconPessoa = document.createElementNS(
     "http://www.w3.org/2000/svg",
     "svg"
    );
    iconPessoa.setAttribute("xmlns", "http://www.w3.org/2000/svg");
    iconPessoa.setAttribute("fill", "none");
    iconPessoa.setAttribute("viewBox", "0 0 24 24");
    iconPessoa.setAttribute("stroke", "currentColor");
    iconPessoa.setAttribute("stroke-width", "2");
    iconPessoa.setAttribute("stroke-linecap", "round");
    iconPessoa.setAttribute("stroke-linejoin", "round");
    iconPessoa.classList.add("w-6", "h-6", "text-[var(--time-text)]");

    const circle = document.createElementNS(
     "http://www.w3.org/2000/svg",
     "circle"
    );
    circle.setAttribute("cx", "12");
    circle.setAttribute("cy", "7");
    circle.setAttribute("r", "4");
    iconPessoa.appendChild(circle);

    const path = document.createElementNS(
     "http://www.w3.org/2000/svg",
     "path"
    );
    path.setAttribute("d", "M5.5 21a6.5 6.5 0 0113 0");
    iconPessoa.appendChild(path);

    const nome = document.createElement("span");
    nome.className = "text-xl font-extrabold";
    nome.textContent = pedido.nome || ".";

    nomeContainer.appendChild(iconPessoa);
    nomeContainer.appendChild(nome);

    const tempo = document.createElement("span");
    tempo.className =
     "time-label rounded-full px-4 py-1 text-sm font-semibold select-none";
    // Add clock icon SVG inline before text
    tempo.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 inline-block mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <circle cx="12" cy="12" r="10" />
        <path d="M12 6v6l4 2" />
      </svg>
      ${tempoRelativo(pedido.data)}
    `;

    header.appendChild(nomeContainer);
    header.appendChild(tempo);

    const descricao = document.createElement("div");
    descricao.className =
     "bg-[var(--card-bg)] rounded-lg border-l-4 border-[var(--card-border)] p-4 text-lg font-normal select-none transition-colors";
    descricao.textContent = pedido.pedido || ".";

    const status = document.createElement("div");
    status.className = "flex items-center gap-2 select-none";

    const statusIndicador = document.createElement("span");
    statusIndicador.className = "status-indicator w-3 h-3 rounded-full block";

    const statusTexto = document.createElement("span");
    statusTexto.className = "status-text text-lg font-normal";
    statusTexto.textContent = "Recebido";

    status.appendChild(statusIndicador);
    status.appendChild(statusTexto);

    card.appendChild(header);
    card.appendChild(descricao);
    card.appendChild(status);

    return card;
   }

   // Função para exibir os pedidos na lista
   function exibirPedidos(lista) {
    const container = document.getElementById("listaPedidos");
    container.innerHTML = "";
    lista.forEach((pedido) => {
     container.appendChild(criarCardPedido(pedido));
    });
    // Atualiza o contador de pedidos total
    const pedidoCount = document
     .getElementById("pedidoCount")
     .querySelector("span:nth-child(2)");
    pedidoCount.textContent = lista.length;

    // Atualiza o contador de pedidos hoje para entregar
    const hojeCountSpan = document.getElementById("pedidoHojeCount");
    const hojeCount = lista.filter((pedido) => {
     if (!pedido.data) return false;
     const dataPedido = new Date(pedido.data);
     const agora = new Date();
     return dataPedido.toDateString() === agora.toDateString();
    }).length;
    hojeCountSpan.textContent = hojeCount;
   }

   // Função para carregar os dados da API
   function carregarDados() {
    fetch(apiUrl)
     .then((response) => response.json())
     .then((data) => {
      pedidos = data.reverse();
      pedidosFiltrados = pedidos;
      exibirPedidos(pedidosFiltrados);
      atualizarSaudacao();
     })
     .catch((error) => {
      console.error("Erro ao carregar os dados:", error);
      alert("Erro ao carregar os dados.");
     });
   }

   // Função para aplicar filtros de pesquisa e tempo
   function aplicarFiltros() {
    const termo = document.getElementById("search").value.toLowerCase();
    const filtroTempo = document.getElementById("filtroTempo").value;
    const agora = new Date();

    pedidosFiltrados = pedidos.filter((pedido) => {
     const nomeMatch = pedido.nome && pedido.nome.toLowerCase().includes(termo);
     const pedidoMatch =
      pedido.pedido && pedido.pedido.toLowerCase().includes(termo);
     if (!nomeMatch && !pedidoMatch) return false;

     if (!pedido.data) return false;
     const dataPedido = new Date(pedido.data);

     switch (filtroTempo) {
      case "ultimaHora":
       return agora - dataPedido <= 3600000; // 1 hora em ms
      case "hoje":
       return dataPedido.toDateString() === agora.toDateString();
      case "estaSemana": {
       const primeiroDiaSemana = new Date(agora);
       primeiroDiaSemana.setDate(agora.getDate() - agora.getDay());
       primeiroDiaSemana.setHours(0, 0, 0, 0);
       return dataPedido >= primeiroDiaSemana && dataPedido <= agora;
      }
      case "esteMes":
       return (
        dataPedido.getMonth() === agora.getMonth() &&
        dataPedido.getFullYear() === agora.getFullYear()
       );
      case "todos":
      default:
       return true;
     }
    });

    exibirPedidos(pedidosFiltrados);
   }

   // Função para toggle menu filtro (se quiser implementar dropdown no futuro)
   function toggleFiltroMenu() {
    // Placeholder para dropdown toggle se necessário
   }

   // Função para alternar tema claro/escuro
   function toggleTheme() {
    const html = document.documentElement;
    const icon = document.getElementById("iconTheme");
    if (html.getAttribute("data-theme") === "dark") {
     html.setAttribute("data-theme", "light");
     localStorage.setItem("theme", "light");
     // Sun icon
     icon.innerHTML = `
      <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" fill="none"></circle>
      <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
      <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
      <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
      <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
     `;
    } else {
     html.setAttribute("data-theme", "dark");
     localStorage.setItem("theme", "dark");
     // Moon icon
     icon.innerHTML = `
      <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z" />
     `;
    }
   }

   // Função para atualizar saudação conforme horário de Brasília e local
   async function atualizarSaudacao() {
    const greetingText = document.getElementById("greetingText");
    const connectedStatus = document.getElementById("greetingStatus");

    try {
     // Obter horário local do usuário
     const localDate = new Date();

     // Obter horário de Brasília via API pública
     const response = await fetch(
      "https://worldtimeapi.org/api/timezone/America/Sao_Paulo"
     );
     const data = await response.json();
     const brDate = new Date(data.datetime);

     // Função para obter saudação por hora
     function getGreeting(hour) {
      if (hour >= 5 && hour < 12) return "Bom dia";
      if (hour >= 12 && hour < 18) return "Boa tarde";
      if (hour >= 18 && hour < 22) return "Boa noite";
      return "Boa madrugada";
     }

     const localGreeting = getGreeting(localDate.getHours());
     const brGreeting = getGreeting(brDate.getHours());

     greetingText.textContent = `${localGreeting} - Você está conectado / ${brGreeting} (Horário de Brasília)`;
    } catch (error) {
     // Caso falhe, exibe só horário local
     const localDate = new Date();
     function getGreeting(hour) {
      if (hour >= 5 && hour < 12) return "Bom dia";
      if (hour >= 12 && hour < 18) return "Boa tarde";
      if (hour >= 18 && hour < 22) return "Boa noite";
      return "Boa madrugada";
     }
     greetingText.textContent = `${getGreeting(localDate.getHours())} - Você está conectado`;
    }
   }

   document.getElementById("btnThemeToggle").addEventListener("click", toggleTheme);

   window.onload = () => {
    // Load theme from localStorage if exists
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme) {
     document.documentElement.setAttribute("data-theme", savedTheme);
     const icon = document.getElementById("iconTheme");
     if (savedTheme === "light") {
      icon.innerHTML = `
       <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2" fill="none"></circle>
       <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
       <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
       <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
       <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
       <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
       <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
       <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
       <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></line>
      `;
     } else {
      icon.innerHTML = `
       <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z" />
      `;
     }
    }
    carregarDados();
    atualizarSaudacao();
   };
  </script>
 </body>
</html>