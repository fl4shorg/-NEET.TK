
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enterprise Dashboard</title>
  <meta name="description" content="Painel administrativo profissional" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“Š</text></svg>" />
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            display: ['Poppins', 'sans-serif']
          },
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
              950: '#082f49',
            },
            secondary: {
              50: '#f5f3ff',
              100: '#ede9fe',
              200: '#ddd6fe',
              300: '#c4b5fd',
              400: '#a78bfa',
              500: '#8b5cf6',
              600: '#7c3aed',
              700: '#6d28d9',
              800: '#5b21b6',
              900: '#4c1d95',
              950: '#2e1065',
            },
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: 0, transform: 'translateY(10px)' },
              '100%': { opacity: 1, transform: 'translateY(0)' }
            }
          }
        }
      }
    };
  </script>
  
  <!-- Custom Styles -->
  <style>
    body {
      font-family: 'Inter', sans-serif;
      transition: background-color 0.3s, color 0.3s;
    }
    
    .dashboard-card {
      transition: all 0.3s ease;
    }
    
    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .gradient-text {
      background-clip: text;
      -webkit-background-clip: text;
      color: transparent;
      background-image: linear-gradient(90deg, #0ea5e9, #8b5cf6);
    }
    
    .gradient-bg {
      background-image: linear-gradient(135deg, #0ea5e9, #8b5cf6);
    }
    
    .card-transition {
      transition: all 0.3s ease;
    }
    
    .card-transition:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    /* Loading bar animation */
    @keyframes progress {
      0% { width: 0; }
      100% { width: 100%; }
    }
    
    .animate-progress {
      animation: progress 0.8s ease-in-out;
    }
    
    /* Dark mode toggle styles */
    .dark-mode-toggle {
      width: 50px;
      height: 25px;
      background-color: #e2e8f0;
      border-radius: 25px;
      padding: 2px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .dark-mode-toggle.dark {
      background-color: #4c1d95;
    }
    
    .toggle-circle {
      width: 21px;
      height: 21px;
      background-color: white;
      border-radius: 50%;
      position: absolute;
      left: 2px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #f59e0b;
    }
    
    .dark .toggle-circle {
      left: calc(100% - 23px);
      color: #6366f1;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 8px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.3);
    }
    
    .dark ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .dark ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .dark ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    /* Toast Notification Styles */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      max-width: 350px;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 9999;
      transform: translateY(-20px);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .toast-success {
      background-color: #10b981;
      color: white;
      border-left: 5px solid #059669;
    }
    
    .toast-error {
      background-color: #ef4444;
      color: white;
      border-left: 5px solid #b91c1c;
    }
    
    .toast-info {
      background-color: #3b82f6;
      color: white;
      border-left: 5px solid #1d4ed8;
    }
    
    .toast-icon {
      margin-right: 12px;
    }
    
    .toast-close {
      cursor: pointer;
      padding: 2px 6px;
      border-radius: 4px;
      transition: all 0.2s;
    }
    
    .toast-close:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    /* Loading skeleton animation */
    @keyframes skeleton-loading {
      0% {
        background-color: rgba(206, 212, 218, 0.5);
      }
      100% {
        background-color: rgba(229, 232, 235, 0.5);
      }
    }
    
    .skeleton {
      animation: skeleton-loading 1.5s ease-in-out infinite alternate;
    }
    
    .dark .skeleton {
      animation-name: skeleton-loading-dark;
    }
    
    @keyframes skeleton-loading-dark {
      0% {
        background-color: rgba(48, 52, 63, 0.5);
      }
      100% {
        background-color: rgba(68, 72, 83, 0.5);
      }
    }
  </style>
</head>

<body class="min-h-screen bg-gray-50 text-gray-900 transition-colors">
  <div id="app" class="min-h-screen flex flex-col">
    <!-- Header/Navbar -->
    <header class="sticky top-0 z-50 gradient-bg text-white shadow-md">
      <div class="container mx-auto px-4 py-3">
        <div class="flex justify-between items-center">
          <!-- Logo & Title -->
          <div class="flex items-center gap-3">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-white/20 text-white">
              <i class="fas fa-chart-line"></i>
            </div>
            <h1 class="text-xl font-display font-bold hidden sm:block">Enterprise Dashboard</h1>
          </div>
          
          <!-- Controls -->
          <div class="flex items-center gap-4">
            <!-- Dark Mode Toggle -->
            <div id="darkModeToggle" class="dark-mode-toggle">
              <div class="toggle-circle">
                <i class="fas fa-sun text-xs"></i>
              </div>
            </div>
            
            <!-- User Profile -->
            <div class="relative group">
              <div class="flex items-center gap-2 cursor-pointer">
                <div id="profilePic" class="w-9 h-9 rounded-full bg-white/20 flex items-center justify-center overflow-hidden">
                  <i class="fas fa-user text-white"></i>
                </div>
                <div class="hidden sm:block">
                  <p class="text-sm font-medium leading-none">Admin</p>
                  <p class="text-xs text-white/70">Administrator</p>
                </div>
                <i class="fas fa-chevron-down text-xs ml-1"></i>
              </div>
              
              <!-- Dropdown Menu -->
              <div class="absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 py-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50">
                <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                  <i class="fas fa-user-circle mr-2"></i> Perfil
                </a>
                <a href="#" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
                  <i class="fas fa-cog mr-2"></i> ConfiguraÃ§Ãµes
                </a>
                <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
                <a href="#" id="logoutBtn" class="block px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700">
                  <i class="fas fa-sign-out-alt mr-2"></i> Sair
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    
    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-6">
      <!-- Dashboard Header -->
      <div class="mb-8">
        <h2 class="text-2xl font-bold font-display gradient-text mb-2">Painel de Controle</h2>
        <p class="text-gray-500 dark:text-gray-400">Gerenciamento completo do sistema administrativo</p>
      </div>
      
      <!-- Summary Section -->
      <section id="summarySection" class="mb-10">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-xl font-display font-semibold">Resumo do Sistema</h3>
          <div class="flex space-x-2">
            <button id="generateReportBtn" class="inline-flex items-center px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-700 transition-colors">
              <i class="fas fa-file-pdf mr-2"></i>
              <span class="hidden sm:inline">Gerar RelatÃ³rio</span>
            </button>
            <button id="downloadVcfBtn" class="inline-flex items-center px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 dark:hover:bg-gray-700 transition-colors">
              <i class="fas fa-address-book mr-2"></i>
              <span class="hidden sm:inline">Baixar Contatos</span>
            </button>
          </div>
        </div>
        
        <!-- Loading Skeleton -->
        <div id="summaryLoading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
          <div class="h-32 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-32 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-32 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-32 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-32 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-32 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-32 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-32 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
        </div>
        
        <!-- Summary Cards -->
        <div id="summaryCards" class="hidden">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            <!-- Status Card (Dynamic color based on data) -->
            <div id="statusCard" class="dashboard-card rounded-xl p-4 flex flex-col items-center justify-center text-white">
              <i id="statusIcon" class="text-3xl mb-2"></i>
              <h3 class="text-sm font-medium text-white/80">SituaÃ§Ã£o do Grupo</h3>
              <p id="statusText" class="text-xl font-bold"></p>
            </div>
            
            <!-- Group Number Card -->
            <div class="dashboard-card bg-blue-500 rounded-xl p-4 flex flex-col items-center justify-center text-white">
              <i class="fas fa-users text-3xl mb-2"></i>
              <h3 class="text-sm font-medium text-white/80">NÃºmero do Grupo</h3>
              <p id="groupNumber" class="text-xl font-bold">-</p>
            </div>
            
            <!-- Admins Count Card -->
            <div class="dashboard-card bg-red-500 rounded-xl p-4 flex flex-col items-center justify-center text-white">
              <i class="fas fa-user-shield text-3xl mb-2"></i>
              <h3 class="text-sm font-medium text-white/80">Total de Administradores</h3>
              <p id="adminCount" class="text-xl font-bold">-</p>
            </div>
            
            <!-- Young Users Card -->
            <div class="dashboard-card bg-green-500 rounded-xl p-4 flex flex-col items-center justify-center text-white">
              <i class="fas fa-child text-3xl mb-2"></i>
              <h3 class="text-sm font-medium text-white/80">Jovens</h3>
              <p id="youngCount" class="text-xl font-bold">-</p>
            </div>
            
            <!-- Teens Card -->
            <div class="dashboard-card bg-purple-500 rounded-xl p-4 flex flex-col items-center justify-center text-white">
              <i class="fas fa-user-graduate text-3xl mb-2"></i>
              <h3 class="text-sm font-medium text-white/80">Adolescentes</h3>
              <p id="teenCount" class="text-xl font-bold">-</p>
            </div>
            
            <!-- Adults Card -->
            <div class="dashboard-card bg-yellow-500 rounded-xl p-4 flex flex-col items-center justify-center text-white">
              <i class="fas fa-user text-3xl mb-2"></i>
              <h3 class="text-sm font-medium text-white/80">Adultos</h3>
              <p id="adultCount" class="text-xl font-bold">-</p>
            </div>
            
            <!-- Last ID Card -->
            <div class="dashboard-card bg-teal-500 rounded-xl p-4 flex flex-col items-center justify-center text-white">
              <i class="fas fa-id-card text-3xl mb-2"></i>
              <h3 class="text-sm font-medium text-white/80">Ãšltimo ID</h3>
              <p id="lastId" class="text-xl font-bold">-</p>
            </div>
            
            <!-- Growth Rate Card -->
            <div class="dashboard-card bg-amber-500 rounded-xl p-4 flex flex-col items-center justify-center text-white">
              <i class="fas fa-chart-line text-3xl mb-2"></i>
              <h3 class="text-sm font-medium text-white/80">Taxa de Crescimento</h3>
              <p id="growthRate" class="text-xl font-bold">-</p>
            </div>
          </div>
          
          <!-- Charts -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- CTS Score Chart -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm">
              <h3 class="text-lg font-semibold mb-4">PontuaÃ§Ã£o de CTS</h3>
              <div class="h-64">
                <canvas id="ctsChart"></canvas>
              </div>
            </div>
            
            <!-- Progress Chart -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm">
              <h3 class="text-lg font-semibold mb-4">Progresso para Meta</h3>
              <div class="h-64">
                <canvas id="progressChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Users Management Section -->
      <section class="mb-6">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-xl font-display font-semibold">Gerenciamento de Administradores</h3>
        </div>
        
        <!-- Search & Actions Bar -->
        <div class="mb-6 flex flex-col sm:flex-row gap-4">
          <!-- Search Input -->
          <div class="flex-1 relative">
            <div class="relative">
              <input 
                id="searchInput" 
                type="text" 
                placeholder="Pesquisar por ID, nome, nÃºmero..."
                class="w-full pl-10 py-2 pr-4 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-colors"
              />
              <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <i class="fas fa-search text-gray-400"></i>
              </div>
            </div>
            
            <!-- Loading Progress Bar (hidden by default) -->
            <div id="searchProgress" class="mt-2 h-1 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden hidden">
              <div class="h-full bg-primary-500 rounded-full animate-progress"></div>
            </div>
          </div>
          
          <!-- Action Buttons -->
          <div class="flex flex-wrap gap-2">
            <button id="registerBtn" class="gradient-bg text-white px-4 py-2 rounded-md shadow-sm hover:opacity-90 transition flex items-center gap-2">
              <i class="fas fa-user-plus"></i>
              <span>Cadastrar Novo</span>
            </button>
            
            <button id="blacklistBtn" class="bg-red-600 text-white px-4 py-2 rounded-md shadow-sm hover:bg-red-700 transition flex items-center gap-2">
              <i class="fas fa-ban"></i>
              <span>Verificar Lista Negra</span>
            </button>
          </div>
        </div>
        
        <!-- Users Loading Skeleton -->
        <div id="usersLoading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div class="h-64 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-64 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-64 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-64 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-64 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
          <div class="h-64 bg-white dark:bg-gray-800 rounded-xl shadow-sm skeleton"></div>
        </div>
        
        <!-- Users Grid -->
        <div id="usersGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 hidden">
          <!-- User cards will be dynamically inserted here -->
        </div>
        
        <!-- Empty State (No Users Found) -->
        <div id="emptyState" class="text-center py-12 bg-white dark:bg-gray-800 rounded-xl shadow-sm hidden">
          <i class="fas fa-search text-4xl text-gray-400 mb-3"></i>
          <h3 class="text-lg font-medium text-gray-900 dark:text-gray-200 mb-1">Nenhum administrador encontrado</h3>
          <p class="text-gray-500 dark:text-gray-400">Tente uma pesquisa diferente ou cadastre um novo administrador</p>
        </div>
      </section>
    </main>
    
    <!-- Footer -->
    <footer class="mt-auto bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 py-6">
      <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div class="text-center md:text-left mb-4 md:mb-0">
            <p class="text-sm text-gray-600 dark:text-gray-400">&copy; 2023 Enterprise Dashboard. Todos os direitos reservados.</p>
          </div>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-500 hover:text-primary-500 dark:text-gray-400 dark:hover:text-primary-400 transition-colors">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="text-gray-500 hover:text-primary-500 dark:text-gray-400 dark:hover:text-primary-400 transition-colors">
              <i class="fab fa-linkedin"></i>
            </a>
            <a href="#" class="text-gray-500 hover:text-primary-500 dark:text-gray-400 dark:hover:text-primary-400 transition-colors">
              <i class="fab fa-github"></i>
            </a>
          </div>
        </div>
      </div>
    </footer>
    
    <!-- Toast Container -->
    <div id="toastContainer"></div>
  </div>
  
  <!-- Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  
  <!-- Main Application Script -->
  <script>
    // ===== CONSTANTS =====
    const API_URL = 'https://script.google.com/macros/s/AKfycbwEDfU3AOA1dfU_muZSr6TGjF7UNQNlBgHByQeyTUiABCS0YzXD-IV-RL8upQPbvzYSzA/exec';
    const SUMMARY_API_URL = `${API_URL}?action=summary`;
    const BLACKLIST_API_URL = 'https://script.google.com/macros/s/AKfycbxIG53Hskr69iwx5OREGTqEHYkBCIQYwZr820x2gU7AJ2Fvd2b82iOszZMU0nQ5hQ/exec';
    
    // ===== DOM ELEMENTS =====
    // Summary Elements
    const summaryLoading = document.getElementById('summaryLoading');
    const summaryCards = document.getElementById('summaryCards');
    const statusCard = document.getElementById('statusCard');
    const statusIcon = document.getElementById('statusIcon');
    const statusText = document.getElementById('statusText');
    const groupNumber = document.getElementById('groupNumber');
    const adminCount = document.getElementById('adminCount');
    const youngCount = document.getElementById('youngCount');
    const teenCount = document.getElementById('teenCount');
    const adultCount = document.getElementById('adultCount');
    const lastId = document.getElementById('lastId');
    const growthRate = document.getElementById('growthRate');
    
    // Users Elements
    const searchInput = document.getElementById('searchInput');
    const searchProgress = document.getElementById('searchProgress');
    const usersLoading = document.getElementById('usersLoading');
    const usersGrid = document.getElementById('usersGrid');
    const emptyState = document.getElementById('emptyState');
    
    // Buttons
    const registerBtn = document.getElementById('registerBtn');
    const blacklistBtn = document.getElementById('blacklistBtn');
    const generateReportBtn = document.getElementById('generateReportBtn');
    const downloadVcfBtn = document.getElementById('downloadVcfBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const profilePic = document.getElementById('profilePic');
    
    // Charts
    let ctsChart = null;
    let progressChart = null;
    
    // ===== STATE VARIABLES =====
    let summaryData = null;
    let users = [];
    let filteredUsers = [];
    let isDarkMode = false;
    
    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', () => {
      initializeApp();
    });
    
    function initializeApp() {
      loadSummaryData();
      loadUsers();
      setupEventListeners();
      checkDarkMode();
      loadProfilePicture();
      
      // Auto-refresh summary data every 60 seconds
      setInterval(loadSummaryData, 60000);
    }
    
    function setupEventListeners() {
      // Search functionality
      searchInput.addEventListener('input', debounce(handleSearch, 300));
      
      // Button click handlers
      registerBtn.addEventListener('click', openRegisterDialog);
      blacklistBtn.addEventListener('click', openBlacklistDialog);
      generateReportBtn.addEventListener('click', generateReport);
      downloadVcfBtn.addEventListener('click', generateVCF);
      logoutBtn.addEventListener('click', confirmLogout);
      darkModeToggle.addEventListener('click', toggleDarkMode);
      
      // Profile pic click handler for upload
      profilePic.addEventListener('click', uploadProfilePicture);
    }
    
    // ===== DARK MODE MANAGEMENT =====
    function checkDarkMode() {
      // Check if dark mode is enabled in localStorage
      const darkModeStatus = localStorage.getItem('darkMode');
      if (darkModeStatus === 'enabled') {
        enableDarkMode();
      }
    }
    
    function toggleDarkMode() {
      if (isDarkMode) {
        disableDarkMode();
      } else {
        enableDarkMode();
      }
    }
    
    function enableDarkMode() {
      document.documentElement.classList.add('dark');
      document.body.classList.add('bg-gray-900', 'text-white');
      document.body.classList.remove('bg-gray-50', 'text-gray-900');
      darkModeToggle.classList.add('dark');
      isDarkMode = true;
      localStorage.setItem('darkMode', 'enabled');
      
      // Update charts if they exist
      if (summaryData) {
        updateCharts(summaryData);
      }
    }
    
    function disableDarkMode() {
      document.documentElement.classList.remove('dark');
      document.body.classList.remove('bg-gray-900', 'text-white');
      document.body.classList.add('bg-gray-50', 'text-gray-900');
      darkModeToggle.classList.remove('dark');
      isDarkMode = false;
      localStorage.setItem('darkMode', 'disabled');
      
      // Update charts if they exist
      if (summaryData) {
        updateCharts(summaryData);
      }
    }
    
    // ===== PROFILE PICTURE =====
    function loadProfilePicture() {
      const savedProfilePic = localStorage.getItem('profilePic');
      if (savedProfilePic) {
        profilePic.innerHTML = `<img src="${savedProfilePic}" alt="Profile" class="w-full h-full object-cover" />`;
      }
    }
    
    function uploadProfilePicture() {
      // Create a file input element
      const fileInput = document.createElement('input');
      fileInput.type = 'file';
      fileInput.accept = 'image/*';
      fileInput.style.display = 'none';
      document.body.appendChild(fileInput);
      
      // Listen for file selection
      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            const imageUrl = event.target.result;
            profilePic.innerHTML = `<img src="${imageUrl}" alt="Profile" class="w-full h-full object-cover" />`;
            localStorage.setItem('profilePic', imageUrl);
            showToast('Foto de perfil atualizada com sucesso!', 'success');
          };
          reader.readAsDataURL(file);
        }
        document.body.removeChild(fileInput);
      });
      
      // Trigger file selection dialog
      fileInput.click();
    }
    
    // ===== DATA LOADING =====
    async function loadSummaryData() {
      try {
        summaryLoading.classList.remove('hidden');
        summaryCards.classList.add('hidden');
        
        const response = await fetch(SUMMARY_API_URL);
        const data = await response.json();
        summaryData = data;
        
        updateSummaryUI(data);
        updateCharts(data);
        
        summaryLoading.classList.add('hidden');
        summaryCards.classList.remove('hidden');
      } catch (error) {
        console.error('Error loading summary data:', error);
        showToast('Erro ao carregar dados de resumo', 'error');
        summaryLoading.classList.add('hidden');
      }
    }
    
    async function loadUsers() {
      try {
        usersLoading.classList.remove('hidden');
        usersGrid.classList.add('hidden');
        emptyState.classList.add('hidden');
        
        const response = await fetch(`${API_URL}?action=read`);
        const data = await response.text();
        
        if (data.trim().length > 0) {
          const lines = data.trim().split('\n');
          users = lines.slice(1).map(line => {
            const [id, name, age, number, instagram, email] = line.split(',');
            return { id, name, age, number, instagram, email };
          });
          
          filteredUsers = [...users];
          renderUsers(filteredUsers);
          
          usersLoading.classList.add('hidden');
          
          if (filteredUsers.length > 0) {
            usersGrid.classList.remove('hidden');
          } else {
            emptyState.classList.remove('hidden');
          }
        } else {
          users = [];
          filteredUsers = [];
          usersLoading.classList.add('hidden');
          emptyState.classList.remove('hidden');
        }
      } catch (error) {
        console.error('Error loading users:', error);
        showToast('Erro ao carregar dados dos usuÃ¡rios', 'error');
        usersLoading.classList.add('hidden');
        emptyState.classList.remove('hidden');
      }
    }
    
    // ===== UI UPDATES =====
    function updateSummaryUI(data) {
      // Update summary card values
      groupNumber.textContent = data['NÃºmero do Grupo'];
      adminCount.textContent = data['Total de Administradores'];
      youngCount.textContent = data['Faixa EtÃ¡ria'].Jovens;
      teenCount.textContent = data['Faixa EtÃ¡ria'].Adolescentes;
      adultCount.textContent = data['Faixa EtÃ¡ria'].Adultos;
      lastId.textContent = data['Ãšltimo ID Enviado'];
      growthRate.textContent = data['Taxa de Crescimento'];
      
      // Update status card
      const statusInfo = getStatusInfo(data['Total de Administradores']);
      statusCard.style.backgroundColor = statusInfo.color;
      statusIcon.className = `${statusInfo.icon} text-3xl mb-2`;
      statusText.textContent = statusInfo.status;
    }
    
    function updateCharts(data) {
      const totalAdmins = data['Total de Administradores'];
      const growthRateValue = parseFloat(data['Taxa de Crescimento'].replace('%', '').trim()) / 100;
      const ctsScore = Math.min(Math.max((totalAdmins + growthRateValue * 100) / 10, 0), 10);
      
      // Destroy previous charts if they exist
      if (ctsChart) {
        ctsChart.destroy();
      }
      
      if (progressChart) {
        progressChart.destroy();
      }
      
      // Chart colors based on theme
      const textColor = isDarkMode ? '#e5e7eb' : '#374151';
      const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
      
      // Create CTS Score chart
      const ctxBar = document.getElementById('ctsChart');
      if (ctxBar) {
        ctsChart = new Chart(ctxBar, {
          type: 'bar',
          data: {
            labels: ['PontuaÃ§Ã£o de CTS'],
            datasets: [{
              label: 'PontuaÃ§Ã£o',
              data: [ctsScore],
              backgroundColor: '#3b82f6',
              borderColor: '#2563eb',
              borderWidth: 1,
              borderRadius: 8,
              barThickness: 50
            }]
          },
          options: {
            responsive: true,
            animation: {
              duration: 1000,
              easing: 'easeOutQuart'
            },
            scales: {
              y: {
                min: 0,
                max: 10,
                grid: {
                  display: true,
                  color: gridColor
                },
                ticks: {
                  color: textColor,
                  stepSize: 1,
                  font: {
                    family: "'Inter', sans-serif"
                  }
                }
              },
              x: {
                grid: {
                  display: false
                },
                ticks: {
                  color: textColor,
                  font: {
                    family: "'Inter', sans-serif"
                  }
                }
              }
            },
            plugins: {
              legend: {
                labels: {
                  color: textColor,
                  font: {
                    family: "'Inter', sans-serif",
                    size: 12
                  }
                }
              },
              tooltip: {
                backgroundColor: isDarkMode ? 'rgba(0, 0, 0, 0.8)' : 'rgba(255, 255, 255, 0.9)',
                titleColor: isDarkMode ? '#fff' : '#000',
                bodyColor: isDarkMode ? '#e5e7eb' : '#374151',
                padding: 12,
                titleFont: {
                  family: "'Inter', sans-serif",
                  size: 14
                },
                bodyFont: {
                  family: "'Inter', sans-serif",
                  size: 13
                },
                displayColors: false,
                borderColor: isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)',
                borderWidth: 1,
                cornerRadius: 8
              }
            }
          }
        });
      }
      
      // Create Progress Donut chart
      const remainingAdmins = Math.max(0, 50 - totalAdmins);
      const ctxDonut = document.getElementById('progressChart');
      if (ctxDonut) {
        progressChart = new Chart(ctxDonut, {
          type: 'doughnut',
          data: {
            labels: ['Administradores atuais', 'Meta a atingir'],
            datasets: [{
              data: [totalAdmins, remainingAdmins],
              backgroundColor: [
                '#3b82f6',
                isDarkMode ? '#374151' : '#e5e7eb'
              ],
              borderColor: [
                '#2563eb',
                isDarkMode ? '#1f2937' : '#d1d5db'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            cutout: '65%',
            animation: {
              animateRotate: true,
              animateScale: true,
              duration: 1000,
              easing: 'easeOutQuart'
            },
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  color: textColor,
                  padding: 20,
                  font: {
                    family: "'Inter', sans-serif",
                    size: 12
                  },
                  generateLabels: function(chart) {
                    const data = chart.data;
                    if (data.labels.length && data.datasets.length) {
                      return data.labels.map(function(label, i) {
                        const meta = chart.getDatasetMeta(0);
                        const style = meta.controller.getStyle(i);
                        
                        return {
                          text: `${label}: ${data.datasets[0].data[i]} (${(data.datasets[0].data[i] / (totalAdmins + remainingAdmins) * 100).toFixed(1)}%)`,
                          fillStyle: data.datasets[0].backgroundColor[i],
                          strokeStyle: data.datasets[0].borderColor[i],
                          lineWidth: data.datasets[0].borderWidth,
                          hidden: !chart.getDataVisibility(i),
                          index: i
                        };
                      });
                    }
                    return [];
                  }
                }
              },
              tooltip: {
                backgroundColor: isDarkMode ? 'rgba(0, 0, 0, 0.8)' : 'rgba(255, 255, 255, 0.9)',
                titleColor: isDarkMode ? '#fff' : '#000',
                bodyColor: isDarkMode ? '#e5e7eb' : '#374151',
                padding: 12,
                titleFont: {
                  family: "'Inter', sans-serif",
                  size: 14
                },
                bodyFont: {
                  family: "'Inter', sans-serif",
                  size: 13
                },
                displayColors: false,
                borderColor: isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)',
                borderWidth: 1,
                cornerRadius: 8,
                callbacks: {
                  label: function(context) {
                    return `${context.label}: ${context.raw} (${(context.raw / (totalAdmins + remainingAdmins) * 100).toFixed(1)}%)`;
                  }
                }
              }
            }
          }
        });
      }
    }
    
    function renderUsers(usersList) {
      usersGrid.innerHTML = '';
      
      if (usersList.length === 0) {
        usersGrid.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
      }
      
      usersGrid.classList.remove('hidden');
      emptyState.classList.add('hidden');
      
      usersList.forEach(user => {
        const userCard = document.createElement('div');
        userCard.className = 'bg-white dark:bg-gray-800 rounded-xl shadow-sm p-5 dashboard-card';
        userCard.innerHTML = `
          <div class="flex justify-between items-start mb-3">
            <div class="flex items-center">
              <i class="fas fa-user text-primary-500 mr-2"></i>
              <h3 class="font-semibold text-gray-900 dark:text-gray-100">${user.name}</h3>
            </div>
            <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded-full text-xs font-medium">
              ID: ${user.id}
            </span>
          </div>
          
          <div class="space-y-2 mb-4">
            <div class="flex items-center text-gray-700 dark:text-gray-300">
              <i class="fas fa-birthday-cake w-5 text-gray-400"></i>
              <span class="text-sm">${user.age} anos</span>
            </div>
            <div class="flex items-center text-gray-700 dark:text-gray-300">
              <i class="fas fa-phone-alt w-5 text-gray-400"></i>
              <span class="text-sm">${user.number}</span>
            </div>
            <div class="flex items-center text-gray-700 dark:text-gray-300">
              <i class="fab fa-instagram w-5 text-gray-400"></i>
              <span class="text-sm">${user.instagram}</span>
            </div>
            <div class="flex items-center text-gray-700 dark:text-gray-300">
              <i class="fas fa-envelope w-5 text-gray-400"></i>
              <span class="text-sm">${user.email || 'N/A'}</span>
            </div>
          </div>
          
          <div class="flex justify-end space-x-2">
            <button class="edit-btn px-3 py-1.5 bg-primary-50 text-primary-600 dark:bg-primary-900/30 dark:text-primary-300 border border-primary-200 dark:border-primary-800 rounded hover:bg-primary-100 dark:hover:bg-primary-800/50 transition-colors text-sm" data-id="${user.id}">
              <i class="fas fa-edit mr-1"></i>
              Editar
            </button>
            <button class="delete-btn px-3 py-1.5 bg-red-50 text-red-600 dark:bg-red-900/30 dark:text-red-300 border border-red-200 dark:border-red-800 rounded hover:bg-red-100 dark:hover:bg-red-800/50 transition-colors text-sm" data-id="${user.id}">
              <i class="fas fa-trash-alt mr-1"></i>
              Excluir
            </button>
          </div>
        `;
        
        // Add event listeners to the buttons
        userCard.querySelector('.edit-btn').addEventListener('click', () => editUser(user));
        userCard.querySelector('.delete-btn').addEventListener('click', () => deleteUser(user.id));
        
        usersGrid.appendChild(userCard);
      });
    }
    
    // ===== SEARCH FUNCTIONALITY =====
    function handleSearch() {
      const query = searchInput.value.trim().toLowerCase();
      
      // Show loading progress bar
      searchProgress.classList.remove('hidden');
      
      // Simulate a delay for better UX
      setTimeout(() => {
        if (!query) {
          filteredUsers = [...users];
        } else {
          filteredUsers = users.filter(user => 
            user.id.toLowerCase().includes(query) ||
            user.name.toLowerCase().includes(query) ||
            user.age.toLowerCase().includes(query) ||
            user.number.toLowerCase().includes(query) ||
            (user.instagram && user.instagram.toLowerCase().includes(query)) ||
            (user.email && user.email.toLowerCase().includes(query))
          );
        }
        
        renderUsers(filteredUsers);
        searchProgress.classList.add('hidden');
      }, 300);
    }
    
    // ===== USER MANAGEMENT =====
    function openRegisterDialog() {
      // Get suggested ID
      const newId = users.length > 0 ? (parseInt(users[users.length - 1].id) + 1).toString() : '1';
      
      Swal.fire({
        title: 'Cadastrar Novo Administrador',
        html: `
          <div class="mb-4">
            <label for="swal-name" class="block text-sm font-medium mb-1">Nome</label>
            <input id="swal-name" class="w-full px-3 py-2 border rounded-md" placeholder="Nome completo">
          </div>
          <div class="mb-4">
            <label for="swal-age" class="block text-sm font-medium mb-1">Idade</label>
            <input id="swal-age" type="number" class="w-full px-3 py-2 border rounded-md" placeholder="Idade">
          </div>
          <div class="mb-4">
            <label for="swal-number" class="block text-sm font-medium mb-1">NÃºmero</label>
            <input id="swal-number" class="w-full px-3 py-2 border rounded-md" placeholder="Formato: 11999999999">
          </div>
          <div class="mb-4">
            <label for="swal-instagram" class="block text-sm font-medium mb-1">Instagram</label>
            <input id="swal-instagram" class="w-full px-3 py-2 border rounded-md" placeholder="@usuario">
          </div>
          <div class="mb-4">
            <label for="swal-email" class="block text-sm font-medium mb-1">E-mail</label>
            <input id="swal-email" type="email" class="w-full px-3 py-2 border rounded-md" placeholder="email@exemplo.com">
          </div>
          <div class="mb-4">
            <p class="text-sm font-medium mb-1">ID DisponÃ­vel: ${newId}</p>
            <input id="swal-id" type="hidden" value="${newId}">
          </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'Cadastrar',
        cancelButtonText: 'Cancelar',
        confirmButtonColor: '#3b82f6',
        cancelButtonColor: '#64748b',
        focusConfirm: false,
        preConfirm: () => {
          const name = document.getElementById('swal-name').value;
          const age = document.getElementById('swal-age').value;
          const number = document.getElementById('swal-number').value;
          const instagram = document.getElementById('swal-instagram').value;
          const email = document.getElementById('swal-email').value;
          const id = document.getElementById('swal-id').value;
          
          // Validation
          if (!name) {
            Swal.showValidationMessage('Nome Ã© obrigatÃ³rio');
            return false;
          }
          
          if (!age || isNaN(age) || parseInt(age) <= 0) {
            Swal.showValidationMessage('Idade vÃ¡lida Ã© obrigatÃ³ria');
            return false;
          }
          
          if (!number) {
            Swal.showValidationMessage('NÃºmero Ã© obrigatÃ³rio');
            return false;
          }
          
          return { id, name, age, number, instagram, email, action: 'create' };
        }
      }).then((result) => {
        if (result.isConfirmed) {
          registerUser(result.value);
        }
      });
    }
    
    async function registerUser(userData) {
      try {
        const formData = new URLSearchParams(userData);
        
        showToast('Registrando novo administrador...', 'info');
        
        const response = await fetch(API_URL, {
          method: 'POST',
          body: formData
        });
        
        if (response.ok) {
          showToast('Administrador cadastrado com sucesso!', 'success');
          await loadUsers();
          await loadSummaryData();
        } else {
          showToast('Erro ao cadastrar administrador', 'error');
        }
      } catch (error) {
        console.error('Error registering user:', error);
        showToast('Erro ao cadastrar administrador', 'error');
      }
    }
    
    function editUser(user) {
      Swal.fire({
        title: 'Editar Administrador',
        html: `
          <div class="mb-4">
            <label for="swal-name" class="block text-sm font-medium mb-1"><i class="fas fa-user"></i> Nome</label>
            <input id="swal-name" class="w-full px-3 py-2 border rounded-md" value="${user.name}">
          </div>
          <div class="mb-4">
            <label for="swal-age" class="block text-sm font-medium mb-1"><i class="fas fa-birthday-cake"></i> Idade</label>
            <input id="swal-age" type="number" class="w-full px-3 py-2 border rounded-md" value="${user.age}">
          </div>
          <div class="mb-4">
            <label for="swal-number" class="block text-sm font-medium mb-1"><i class="fas fa-phone-alt"></i> NÃºmero</label>
            <input id="swal-number" class="w-full px-3 py-2 border rounded-md" value="${user.number}">
          </div>
          <div class="mb-4">
            <label for="swal-instagram" class="block text-sm font-medium mb-1"><i class="fab fa-instagram"></i> Instagram</label>
            <input id="swal-instagram" class="w-full px-3 py-2 border rounded-md" value="${user.instagram}">
          </div>
          <div class="mb-4">
            <label for="swal-email" class="block text-sm font-medium mb-1"><i class="fas fa-envelope"></i> E-mail</label>
            <input id="swal-email" type="email" class="w-full px-3 py-2 border rounded-md" value="${user.email || ''}">
          </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'Salvar',
        cancelButtonText: 'Cancelar',
        confirmButtonColor: '#3b82f6',
        cancelButtonColor: '#64748b',
        preConfirm: () => {
          return {
            id: user.id,
            name: document.getElementById('swal-name').value,
            age: document.getElementById('swal-age').value,
            number: document.getElementById('swal-number').value,
            instagram: document.getElementById('swal-instagram').value,
            email: document.getElementById('swal-email').value,
            action: 'update'
          };
        }
      }).then((result) => {
        if (result.isConfirmed) {
          updateUser(result.value);
        }
      });
    }
    
    async function updateUser(userData) {
      try {
        const formData = new URLSearchParams(userData);
        
        showToast('Atualizando administrador...', 'info');
        
        const response = await fetch(API_URL, {
          method: 'POST',
          body: formData
        });
        
        if (response.ok) {
          showToast('Administrador atualizado com sucesso!', 'success');
          await loadUsers();
        } else {
          showToast('Erro ao atualizar administrador', 'error');
        }
      } catch (error) {
        console.error('Error updating user:', error);
        showToast('Erro ao atualizar administrador', 'error');
      }
    }
    
    function deleteUser(id) {
      Swal.fire({
        title: 'Tem certeza?',
        text: 'VocÃª nÃ£o poderÃ¡ reverter isso!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sim, excluir',
        cancelButtonText: 'Cancelar',
        confirmButtonColor: '#ef4444',
        cancelButtonColor: '#64748b',
      }).then((result) => {
        if (result.isConfirmed) {
          removeUser(id);
        }
      });
    }
    
    async function removeUser(id) {
      try {
        showToast('Excluindo administrador...', 'info');
        
        const response = await fetch(API_URL, {
          method: 'POST',
          body: new URLSearchParams({ id, action: 'delete' })
        });
        
        if (response.ok) {
          showToast('Administrador excluÃ­do com sucesso', 'success');
          await loadUsers();
          await loadSummaryData();
        } else {
          showToast('Erro ao excluir administrador', 'error');
        }
      } catch (error) {
        console.error('Error deleting user:', error);
        showToast('Erro ao excluir administrador', 'error');
      }
    }
    
    function openBlacklistDialog() {
      Swal.fire({
        title: 'Verificar NÃºmero na Lista Negra',
        input: 'text',
        inputPlaceholder: 'Digite o nÃºmero para verificar',
        inputAttributes: {
          autocapitalize: 'off',
          autocorrect: 'off'
        },
        showCancelButton: true,
        confirmButtonText: 'Verificar',
        cancelButtonText: 'Cancelar',
        confirmButtonColor: '#3b82f6',
        cancelButtonColor: '#64748b',
        showLoaderOnConfirm: true,
        preConfirm: async (number) => {
          if (!number) {
            Swal.showValidationMessage('Digite um nÃºmero para pesquisa!');
            return false;
          }
          
          try {
            const response = await fetch(BLACKLIST_API_URL);
            
            if (!response.ok) {
              throw new Error('Erro ao carregar os nÃºmeros.');
            }
            
            const data = await response.text();
            const regex = /\d{11,}/g;
            const numbers = data.match(regex);
            
            return {
              number,
              isBlacklisted: numbers && numbers.includes(number)
            };
          } catch (error) {
            Swal.showValidationMessage(`Erro: ${error}`);
            return false;
          }
        },
        allowOutsideClick: () => !Swal.isLoading()
      }).then((result) => {
        if (result.isConfirmed && result.value) {
          const { number, isBlacklisted } = result.value;
          
          if (isBlacklisted) {
            Swal.fire({
              title: 'NÃºmero Encontrado',
              text: `O nÃºmero ${number} estÃ¡ na lista negra!`,
              icon: 'warning',
              confirmButtonText: 'OK',
              confirmButtonColor: '#3b82f6',
            });
          } else {
            Swal.fire({
              title: 'NÃºmero NÃ£o Encontrado',
              text: `O nÃºmero ${number} nÃ£o foi encontrado na lista negra.`,
              icon: 'success',
              confirmButtonText: 'OK',
              confirmButtonColor: '#3b82f6',
            });
          }
        }
      });
    }
    
    // ===== UTILITY FUNCTIONS =====
    function generateVCF() {
      if (users.length === 0) {
        showToast('NÃ£o hÃ¡ usuÃ¡rios para gerar contatos', 'error');
        return;
      }
      
      let vcfContent = '';
      
      users.forEach(user => {
        // Format the phone number correctly
        const phoneNumber = user.number.replace(/\D/g, '');
        
        // Create VCF entry for each user
        vcfContent += 'BEGIN:VCARD\r\n';
        vcfContent += 'VERSION:3.0\r\n';
        vcfContent += `FN:${user.name}\r\n`;
        vcfContent += `TEL;TYPE=CELL:${phoneNumber}\r\n`;
        if (user.email) {
          vcfContent += `EMAIL:${user.email}\r\n`;
        }
        vcfContent += `NOTE:ID: ${user.id}, Idade: ${user.age}, Instagram: ${user.instagram}\r\n`;
        vcfContent += 'END:VCARD\r\n';
      });
      
      // Create a download link and trigger it
      const blob = new Blob([vcfContent], { type: 'text/vcard' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'administradores_contatos.vcf';
      document.body.appendChild(a);
      a.click();
      
      // Clean up
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 100);
      
      showToast('Contatos baixados com sucesso!', 'success');
    }
    
    async function generateReport() {
      if (!summaryData) {
        showToast('NÃ£o foi possÃ­vel gerar o relatÃ³rio. Dados nÃ£o carregados.', 'error');
        return;
      }
      
      try {
        showToast('Gerando relatÃ³rio...', 'info');
        
        // Select the elements to capture
        const reportSection = document.getElementById('summarySection');
        
        // Generate screenshot using html2canvas
        const canvas = await html2canvas(reportSection, {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          backgroundColor: isDarkMode ? '#1f2937' : '#ffffff'
        });
        
        // Convert to image and download
        const imageUrl = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.download = `relatorio_dashboard_${new Date().toISOString().slice(0, 10)}.png`;
        link.href = imageUrl;
        link.click();
        
        showToast('RelatÃ³rio gerado com sucesso!', 'success');
      } catch (error) {
        console.error('Error generating report:', error);
        showToast('Erro ao gerar relatÃ³rio', 'error');
      }
    }
    
    function confirmLogout() {
      Swal.fire({
        title: 'Tem certeza?',
        text: 'VocÃª deseja encerrar a sessÃ£o?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Sim',
        cancelButtonText: 'Cancelar',
        confirmButtonColor: '#3b82f6',
        cancelButtonColor: '#64748b',
      }).then((result) => {
        if (result.isConfirmed) {
          // Clear preferences
          localStorage.removeItem('darkMode');
          localStorage.removeItem('profilePic');
          
          // Redirect to login page
          window.location.href = 'https://neetk.onrender.com/login';
          showToast('Logout realizado com sucesso', 'success');
        }
      });
    }
    
    function getStatusInfo(totalAdmins) {
      if (totalAdmins <= 20) {
        return {
          status: 'SituaÃ§Ã£o PÃ©ssima',
          color: '#e74c3c',
          icon: 'fas fa-angry'
        };
      } else if (totalAdmins <= 40) {
        return {
          status: 'SituaÃ§Ã£o Muito Ruim',
          color: '#e67e22',
          icon: 'fas fa-frown'
        };
      } else if (totalAdmins <= 49) {
        return {
          status: 'SituaÃ§Ã£o EstÃ¡vel',
          color: '#f1c40f',
          icon: 'fas fa-meh'
        };
      } else if (totalAdmins === 50) {
        return {
          status: 'SituaÃ§Ã£o Boa',
          color: '#27ae60',
          icon: 'fas fa-smile'
        };
      } else if (totalAdmins <= 60) {
        return {
          status: 'SituaÃ§Ã£o Muito Boa',
          color: '#2ecc71',
          icon: 'fas fa-laugh'
        };
      } else {
        return {
          status: 'SituaÃ§Ã£o Ultra Boa',
          color: '#9b59b6',
          icon: 'fas fa-grin-stars'
        };
      }
    }
    
    // ===== TOAST NOTIFICATIONS =====
    function showToast(message, type = 'info') {
      const toastContainer = document.getElementById('toastContainer');
      
      // Create toast element
      const toast = document.createElement('div');
      toast.className = `toast toast-${type} flex items-center justify-between`;
      
      let icon = '';
      switch (type) {
        case 'success':
          icon = '<i class="fas fa-check-circle toast-icon"></i>';
          break;
        case 'error':
          icon = '<i class="fas fa-exclamation-circle toast-icon"></i>';
          break;
        case 'info':
        default:
          icon = '<i class="fas fa-info-circle toast-icon"></i>';
          break;
      }
      
      toast.innerHTML = `
        <div class="flex items-center">
          ${icon}
          <span>${message}</span>
        </div>
        <span class="toast-close">&times;</span>
      `;
      
      // Add close button functionality
      const closeBtn = toast.querySelector('.toast-close');
      closeBtn.addEventListener('click', () => {
        toast.classList.remove('show');
        setTimeout(() => {
          toastContainer.removeChild(toast);
        }, 300);
      });
      
      // Add to container
      toastContainer.appendChild(toast);
      
      // Trigger animation after a brief delay for proper rendering
      setTimeout(() => {
        toast.classList.add('show');
      }, 10);
      
      // Auto-remove after 5 seconds
      setTimeout(() => {
        if (toastContainer.contains(toast)) {
          toast.classList.remove('show');
          setTimeout(() => {
            if (toastContainer.contains(toast)) {
              toastContainer.removeChild(toast);
            }
          }, 300);
        }
      }, 5000);
    }
    
    // ===== UTILITY FUNCTIONS =====
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
  </script>
</body>
</html>
