
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DASHBOARD</title>
    <meta name="description" content="Painel de Controle">
    <link rel="icon" href="https://www.exemplo.com/caminho/para/o/icone.jpg" type="image/jpg">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --background: 210 40% 98%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 224 64% 33%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96.1%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 222.2 84% 4.9%;
            --radius: 0.5rem;
        }

        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 5.9%;
            --card-foreground: 210 40% 98%;
            --popover: 222.2 84% 4.9%;
            --popover-foreground: 210 40% 98%;
            --primary: 210 40% 98%;
            --primary-foreground: 222.2 47.4% 11.2%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 212.7 26.8% 83.9%;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 40;
            width: 100%;
            backdrop-filter: blur(8px);
            background-color: hsla(0, 0%, 100%, 0.75);
            border-bottom: 1px solid hsl(var(--border));
        }

        .dark .header {
            background-color: hsla(0, 0%, 0%, 0.2);
        }

        .navbar {
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .brand-logo {
            height: 32px;
            width: 32px;
            border-radius: 6px;
            background: linear-gradient(to right, #2575fc, #6a11cb);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .brand-name {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .icon-button {
            border: none;
            background: none;
            width: 36px;
            height: 36px;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: hsl(var(--foreground));
            transition: background-color 0.2s, transform 0.2s;
        }

        .icon-button:hover {
            background-color: hsla(var(--muted), 0.8);
            transform: scale(1.05);
        }

        .icon-button i {
            font-size: 20px;
        }

        .profile-wrapper {
            position: relative;
            width: 40px;
            height: 40px;
            cursor: pointer;
            border-radius: 9999px;
            border: 2px solid hsl(var(--border));
            overflow: hidden;
            transition: box-shadow 0.2s;
        }

        .profile-wrapper:hover {
            box-shadow: 0 0 0 2px hsla(var(--ring), 0.3);
        }

        .profile-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            color: hsl(var(--muted-foreground));
        }

        .profile-pic {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .main-content {
            padding: 32px 0;
        }

        .header-section {
            margin-bottom: 40px;
            text-align: center;
            animation: fadeIn 0.5s ease-out;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.025em;
        }

        .page-description {
            color: hsl(var(--muted-foreground));
            max-width: 600px;
            margin: 0 auto;
        }

        .status-cards-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 16px;
            margin-bottom: 40px;
        }

        @media (min-width: 640px) {
            .status-cards-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .status-cards-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .status-card {
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px;
            min-height: 140px;
            border-radius: 12px;
            color: white;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .status-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .status-card .icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .status-card .title {
            font-size: 14px;
            font-weight: 500;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .status-card .value {
            font-size: 20px;
            font-weight: 700;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            margin-bottom: 40px;
        }

        @media (min-width: 1024px) {
            .charts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .chart-card {
            background-color: hsl(var(--card));
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s;
        }

        .dark .chart-card {
            background-color: hsl(var(--card));
        }

        .chart-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .chart-header {
            padding: 16px 16px 8px 16px;
            border-bottom: 1px solid hsla(var(--border), 0.5);
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
        }

        .chart-content {
            padding: 16px;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-section {
            margin-top: 64px;
            margin-bottom: 24px;
        }

        .admin-title {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 32px;
            letter-spacing: -0.025em;
        }

        .admin-actions {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            margin-bottom: 32px;
        }

        @media (min-width: 640px) {
            .admin-actions {
                flex-direction: row;
                justify-content: center;
            }
        }

        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 8px 16px;
            height: 40px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            white-space: nowrap;
            border: none;
        }

        .button:focus {
            outline: 2px solid hsla(var(--ring), 0.5);
            outline-offset: 2px;
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .button-primary {
            background: linear-gradient(to right, #2575fc, #6a11cb);
            color: white;
            border-radius: 9999px;
            padding: 8px 20px;
        }

        .button-primary:hover {
            opacity: 0.9;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .button-green {
            background-color: #10b981;
            color: white;
        }

        .button-green:hover {
            background-color: #059669;
        }

        .button-red {
            background-color: #ef4444;
            color: white;
        }

        .button-red:hover {
            background-color: #dc2626;
        }

        .button-outline {
            background-color: transparent;
            border: 1px solid hsl(var(--border));
        }

        .button-outline:hover {
            background-color: hsla(var(--muted), 0.8);
        }

        .search-container {
            max-width: 600px;
            margin: 0 auto 40px auto;
            animation: fadeIn 0.5s ease-out;
        }

        .search-input-wrapper {
            position: relative;
            max-width: 500px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            height: 48px;
            padding: 8px 16px 8px 40px;
            border-radius: 9999px;
            border: 1px solid hsl(var(--border));
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            font-size: 16px;
            transition: box-shadow 0.2s, border-color 0.2s;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .search-input:focus {
            outline: none;
            border-color: hsla(var(--ring), 0.5);
            box-shadow: 0 0 0 2px hsla(var(--ring), 0.2);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: hsl(var(--muted-foreground));
        }

        .search-loading {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: hsl(var(--muted-foreground));
            animation: spin 1s linear infinite;
        }

        .loading-bar {
            margin-top: 8px;
            margin-left: auto;
            margin-right: auto;
            width: 70%;
            height: 4px;
            overflow: hidden;
            border-radius: 9999px;
            background-color: hsla(var(--muted), 0.5);
        }

        .loading-bar-progress {
            height: 100%;
            width: 100%;
            background: linear-gradient(to right, #2575fc, #6a11cb);
            border-radius: 9999px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .users-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        @media (min-width: 768px) {
            .users-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .users-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .user-card {
            padding: 16px;
            border-radius: 8px;
            background-color: hsl(var(--card));
            border: 1px solid hsl(var(--border));
            transition: box-shadow 0.3s, transform 0.2s;
            animation: fadeIn 0.5s ease-out;
            overflow: hidden;
        }

        .dark .user-card {
            background-color: hsl(var(--card));
        }

        .user-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
        }

        .user-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-info {
            margin-bottom: 8px;
            color: hsl(var(--muted-foreground));
        }

        .user-info span {
            color: hsl(var(--foreground));
            font-weight: 500;
            margin-left: 4px;
        }

        .user-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid hsl(var(--border));
        }

        .user-actions button {
            flex: 1;
        }

        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            animation: fadeIn 0.2s ease-out;
        }

        .dialog-content {
            background-color: hsl(var(--background));
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 24px;
            animation: scaleIn 0.2s ease-out;
        }

        .dialog-header {
            margin-bottom: 16px;
        }

        .dialog-title {
            font-size: 18px;
            font-weight: 700;
        }

        .dialog-description {
            color: hsl(var(--muted-foreground));
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            height: 40px;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid hsl(var(--border));
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: hsla(var(--ring), 0.5);
            box-shadow: 0 0 0 2px hsla(var(--ring), 0.2);
        }

        .form-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: hsl(var(--muted));
        }

        .dialog-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 24px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 0;
            color: hsl(var(--muted-foreground));
        }

        .footer {
            padding: 24px 0;
            text-align: center;
            border-top: 1px solid hsl(var(--border));
            color: hsl(var(--muted-foreground));
            font-size: 14px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        @keyframes spin {
            from {
                transform: translateY(-50%) rotate(0deg);
            }
            to {
                transform: translateY(-50%) rotate(360deg);
            }
        }

        .animate-scale-in {
            animation: scaleIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .animate-pulse-slow {
            animation: pulse 1.5s ease-in-out infinite;
        }

        .bg-status-danger { background-color: #ef4444; }
        .bg-status-warning { background-color: #f59e0b; }
        .bg-status-success { background-color: #10b981; }
        .bg-status-info { background-color: #3b82f6; }
        .bg-status-purple { background-color: #8b5cf6; }
        .bg-orange-500 { background-color: #f97316; }
        .bg-emerald-600 { background-color: #059669; }
        .bg-yellow-500 { background-color: #eab308; }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="navbar">
                <div class="brand">
                    <div class="brand-logo">D</div>
                    <h1 class="brand-name">DASHBOARD</h1>
                </div>
                <div class="nav-actions">
                    <button id="theme-toggle" class="icon-button">
                        <i id="theme-icon" class="fas fa-moon"></i>
                    </button>
                    <div id="profile-wrapper" class="profile-wrapper">
                        <div id="default-icon" class="profile-icon">
                            <i class="fas fa-user"></i>
                        </div>
                        <img id="profile-pic" class="profile-pic" src="" alt="Profile" style="display: none;">
                    </div>
                    <input type="file" id="profile-input" accept="image/*" style="display: none;">
                    <button id="logout-button" class="icon-button">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content container">
        <div class="header-section">
            <h1 class="page-title">Painel de Controle</h1>
            <p class="page-description">
                Monitore estatísticas, administre usuários e mantenha o controle de seu grupo.
            </p>
        </div>

        <!-- Status Cards Grid -->
        <div id="status-cards-grid" class="status-cards-grid">
            <!-- Status cards will be inserted here by JavaScript -->
        </div>

        <!-- Charts -->
        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Pontuação de CTS</h3>
                </div>
                <div class="chart-content">
                    <canvas id="cts-chart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Meta de Administradores</h3>
                </div>
                <div class="chart-content">
                    <canvas id="admins-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- User Management Section -->
        <div class="admin-section">
            <h2 class="admin-title">Gerenciamento de Administradores</h2>
            
            <div class="admin-actions">
                <button id="register-admin-button" class="button button-primary">
                    <i class="fas fa-user-plus"></i>
                    Cadastrar Novo Adm
                </button>
                <button id="blacklist-check-button" class="button button-red">
                    <i class="fas fa-shield-alt"></i>
                    Verificar Lista Negra
                </button>
                <button id="download-contacts-button" class="button button-green">
                    <i class="fas fa-download"></i>
                    Baixar Contatos (VCF)
                </button>
            </div>

            <div class="search-container">
                <div class="search-input-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input 
                        type="text" 
                        id="search-input" 
                        class="search-input" 
                        placeholder="Pesquisar por ID, nome ou outros dados..."
                    >
                    <i id="search-loading" class="fas fa-spinner search-loading" style="display: none;"></i>
                </div>
                <div id="loading-bar" class="loading-bar" style="display: none;">
                    <div class="loading-bar-progress"></div>
                </div>
            </div>

            <div id="users-grid" class="users-grid">
                <!-- User cards will be inserted here by JavaScript -->
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; NEEXT LTDA. Todos os direitos reservados.</p>
    </footer>

    <!-- Register Admin Dialog (Hidden by default) -->
    <div id="register-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog-content">
            <div class="dialog-header">
                <h3 class="dialog-title">Cadastrar Novo Administrador</h3>
                <p class="dialog-description">
                    Preencha os dados para cadastrar um novo administrador no sistema.
                </p>
            </div>
            <div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-user"></i> Nome</label>
                    <input id="register-name" type="text" class="form-input" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-birthday-cake"></i> Idade</label>
                    <input id="register-age" type="number" class="form-input" placeholder="Idade">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-phone"></i> Número</label>
                    <input id="register-phone" type="text" class="form-input" placeholder="Número de telefone">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fab fa-instagram"></i> Instagram</label>
                    <input id="register-instagram" type="text" class="form-input" placeholder="Usuário do Instagram">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-envelope"></i> E-mail</label>
                    <input id="register-email" type="email" class="form-input" placeholder="Endereço de e-mail">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-tag"></i> ID</label>
                    <input id="register-id" type="text" class="form-input" placeholder="ID" disabled>
                    <p id="id-suggestion" style="margin-top: 4px; font-size: 12px; color: hsl(var(--muted-foreground));">
                        ID gerado automaticamente
                    </p>
                </div>
            </div>
            <div class="dialog-actions">
                <button id="register-cancel" class="button button-outline">Cancelar</button>
                <button id="register-submit" class="button button-primary">Cadastrar</button>
            </div>
        </div>
    </div>

    <!-- Edit User Dialog (Hidden by default) -->
    <div id="edit-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog-content">
            <div class="dialog-header">
                <h3 class="dialog-title">Editar Usuário</h3>
            </div>
            <div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-user"></i> Nome</label>
                    <input id="edit-name" type="text" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-birthday-cake"></i> Idade</label>
                    <input id="edit-age" type="number" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-phone"></i> Número</label>
                    <input id="edit-phone" type="text" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fab fa-instagram"></i> Instagram</label>
                    <input id="edit-instagram" type="text" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-envelope"></i> E-mail</label>
                    <input id="edit-email" type="email" class="form-input">
                </div>
                <input id="edit-id" type="hidden">
            </div>
            <div class="dialog-actions">
                <button id="edit-cancel" class="button button-outline">Cancelar</button>
                <button id="edit-submit" class="button button-primary">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Blacklist Check Dialog (Hidden by default) -->
    <div id="blacklist-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog-content">
            <div class="dialog-header">
                <h3 class="dialog-title">Verificar Número na Lista Negra</h3>
                <p class="dialog-description">
                    Digite o número de telefone que deseja verificar na lista negra.
                </p>
            </div>
            <div>
                <div class="form-group">
                    <label class="form-label"><i class="fas fa-phone"></i> Número de Telefone</label>
                    <input id="blacklist-number" type="text" class="form-input" placeholder="Digite o número de telefone">
                </div>
                <div id="blacklist-checking" style="display: none; text-align: center; padding: 16px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 8px;"></i>
                    <p>Verificando...</p>
                </div>
                <div id="blacklist-result" style="display: none; padding: 16px; border-radius: 6px; margin-top: 16px;">
                    <!-- Result will be displayed here -->
                </div>
            </div>
            <div class="dialog-actions">
                <button id="blacklist-cancel" class="button button-outline">Fechar</button>
                <button id="blacklist-check" class="button button-primary">Verificar</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Dialog (Hidden by default) -->
    <div id="delete-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog-content">
            <div class="dialog-header">
                <h3 class="dialog-title" style="color: #ef4444;"><i class="fas fa-exclamation-triangle"></i> Confirmar Exclusão</h3>
            </div>
            <p style="margin-bottom: 16px; color: hsl(var(--muted-foreground));">
                Tem certeza que deseja excluir o usuário <span id="delete-user-name" style="font-weight: 600;"></span>? Esta ação não pode ser desfeita.
            </p>
            <input id="delete-id" type="hidden">
            <div class="dialog-actions">
                <button id="delete-cancel" class="button button-outline">Cancelar</button>
                <button id="delete-confirm" class="button button-red">Excluir</button>
            </div>
        </div>
    </div>

    <!-- Logout Confirmation Dialog (Hidden by default) -->
    <div id="logout-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog-content">
            <div class="dialog-header">
                <h3 class="dialog-title">Confirmar saída</h3>
            </div>
            <p style="margin-bottom: 16px; color: hsl(var(--muted-foreground));">
                Tem certeza que deseja encerrar sua sessão?
            </p>
            <div class="dialog-actions">
                <button id="logout-cancel" class="button button-outline">Cancelar</button>
                <button id="logout-confirm" class="button button-red">Sair</button>
            </div>
        </div>
    </div>

    <script>
        // API URLs
        const API_URL = 'https://script.google.com/macros/s/AKfycbzUVFrJvOLFKWLvlJ2IQ-HC9dF9uN85Q-BSTI2D-S1dwgjSIHPvQ83fvNXslwA0Q-38/exec';
        const SUMMARY_API_URL = 'https://script.google.com/macros/s/AKfycbzUVFrJvOLFKWLvlJ2IQ-HC9dF9uN85Q-BSTI2D-S1dwgjSIHPvQ83fvNXslwA0Q-38/exec?action=summary';

        // DOM Elements
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const profileWrapper = document.getElementById('profile-wrapper');
        const defaultIcon = document.getElementById('default-icon');
        const profilePic = document.getElementById('profile-pic');
        const profileInput = document.getElementById('profile-input');
        const logoutButton = document.getElementById('logout-button');
        const searchInput = document.getElementById('search-input');
        const searchLoading = document.getElementById('search-loading');
        const loadingBar = document.getElementById('loading-bar');
        const statusCardsGrid = document.getElementById('status-cards-grid');
        const usersGrid = document.getElementById('users-grid');

        // Charts
        let ctsChart = null;
        let adminsChart = null;

        // Dialogs
        const registerDialog = document.getElementById('register-dialog');
        const editDialog = document.getElementById('edit-dialog');
        const blacklistDialog = document.getElementById('blacklist-dialog');
        const deleteDialog = document.getElementById('delete-dialog');
        const logoutDialog = document.getElementById('logout-dialog');

        // Current state
        let users = [];
        let summaryData = null;
        let filteredUsers = [];

        // ============================
        // Theme and Profile Functions
        // ============================

        // Initialize theme from localStorage
        function initTheme() {
            const savedTheme = localStorage.getItem('darkMode');
            if (savedTheme === 'enabled') {
                document.body.classList.add('dark');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
        }

        // Toggle theme
        function toggleTheme() {
            if (document.body.classList.contains('dark')) {
                document.body.classList.remove('dark');
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
                localStorage.setItem('darkMode', 'disabled');
            } else {
                document.body.classList.add('dark');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
                localStorage.setItem('darkMode', 'enabled');
            }
        }

        // Load profile picture from localStorage
        function loadProfilePic() {
            const savedProfilePic = localStorage.getItem('profilePic');
            if (savedProfilePic) {
                profilePic.src = savedProfilePic;
                profilePic.style.display = 'block';
                defaultIcon.style.display = 'none';
            }
        }

        // Handle profile picture change
        function handleProfilePicChange(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function() {
                profilePic.src = reader.result;
                profilePic.style.display = 'block';
                defaultIcon.style.display = 'none';
                localStorage.setItem('profilePic', reader.result);
                showToast('Foto de perfil atualizada', 'success');
            };
            reader.readAsDataURL(file);
        }

        // ======================
        // Data Loading Functions
        // ======================

        // Load summary data
        async function loadSummaryData() {
            try {
                const response = await fetch(SUMMARY_API_URL);
                const data = await response.json();
                summaryData = data;
                renderStatusCards();
                renderCharts();
                return data;
            } catch (error) {
                console.error('Error loading summary data:', error);
                showToast('Erro ao carregar dados', 'error');
            }
        }

        // Load users
        async function loadUsers() {
            try {
                const response = await fetch(`${API_URL}?action=read`);
                const data = await response.text();
                
                if (data.trim().length > 0) {
                    const lines = data.trim().split('\n');
                    // Skip header row
                    users = [];
                    for (let i = 1; i < lines.length; i++) {
                        const user = lines[i].split(',');
                        if (user.length >= 6) {
                            users.push({
                                id: user[0],
                                name: user[1],
                                age: parseInt(user[2]) || 0,
                                phoneNumber: user[3],
                                instagram: user[4],
                                email: user[5]
                            });
                        }
                    }
                    filteredUsers = [...users];
                    renderUsers();
                } else {
                    users = [];
                    filteredUsers = [];
                    renderUsers();
                }
            } catch (error) {
                console.error('Error loading users:', error);
                showToast('Erro ao carregar usuários', 'error');
            }
        }

        // ====================
        // Rendering Functions
        // ====================

        // Render status cards
        function renderStatusCards() {
            if (!summaryData) return;

            const totalAdmins = summaryData["Total de Administradores"];
            
            // Determine group status based on admin count
            let groupStatus = '';
            let statusColor = '';
            let statusIcon = '';

            if (totalAdmins <= 20) {
                groupStatus = 'Situação Péssima';
                statusColor = 'bg-status-danger';
                statusIcon = 'fas fa-angry';
            } else if (totalAdmins <= 40) {
                groupStatus = 'Situação Muito Ruim';
                statusColor = 'bg-status-warning';
                statusIcon = 'fas fa-frown';
            } else if (totalAdmins <= 49) {
                groupStatus = 'Situação Estável';
                statusColor = 'bg-yellow-500';
                statusIcon = 'fas fa-meh';
            } else if (totalAdmins === 50) {
                groupStatus = 'Situação Boa';
                statusColor = 'bg-status-success';
                statusIcon = 'fas fa-smile';
            } else if (totalAdmins <= 60) {
                groupStatus = 'Situação Muito Boa';
                statusColor = 'bg-status-success';
                statusIcon = 'fas fa-laugh';
            } else if (totalAdmins >= 70) {
                groupStatus = 'Situação Ultra Boa';
                statusColor = 'bg-status-purple';
                statusIcon = 'fas fa-grin-stars';
            }

            // Cards data
            const cards = [
                { 
                    title: 'Situação do Grupo', 
                    value: groupStatus, 
                    color: statusColor, 
                    icon: statusIcon,
                    cols: 'col-span-1 sm:col-span-2'
                },
                { 
                    title: 'Número do Grupo', 
                    value: summaryData["Número do Grupo"], 
                    color: 'bg-status-info', 
                    icon: 'fas fa-users' 
                },
                { 
                    title: 'Total de Administradores', 
                    value: totalAdmins, 
                    color: 'bg-status-danger', 
                    icon: 'fas fa-user-shield' 
                },
                { 
                    title: 'Jovens', 
                    value: summaryData["Faixa Etária"].Jovens, 
                    color: 'bg-status-success', 
                    icon: 'fas fa-baby' 
                },
                { 
                    title: 'Adolescentes', 
                    value: summaryData["Faixa Etária"].Adolescentes, 
                    color: 'bg-status-purple', 
                    icon: 'fas fa-graduation-cap' 
                },
                { 
                    title: 'Adultos', 
                    value: summaryData["Faixa Etária"].Adultos, 
                    color: 'bg-orange-500', 
                    icon: 'fas fa-user' 
                },
                { 
                    title: 'Último ID', 
                    value: summaryData["Último ID Enviado"], 
                    color: 'bg-emerald-600', 
                    icon: 'fas fa-id-card' 
                },
                { 
                    title: 'Taxa de Crescimento', 
                    value: summaryData["Taxa de Crescimento"], 
                    color: 'bg-yellow-500', 
                    icon: 'fas fa-chart-line' 
                }
            ];

            // Clear grid
            statusCardsGrid.innerHTML = '';

            // Create cards
            cards.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = `status-card ${card.color} ${card.cols || ''} animate-scale-in`;
                cardEl.style.animationDelay = `${index * 0.1}s`;
                
                cardEl.innerHTML = `
                    <div class="icon"><i class="${card.icon}"></i></div>
                    <h4 class="title">${card.title}</h4>
                    <p class="value">${card.value}</p>
                `;
                
                statusCardsGrid.appendChild(cardEl);
            });
        }

        // Render charts
        function renderCharts() {
            if (!summaryData) return;
            
            const totalAdmins = summaryData["Total de Administradores"];
            const growthRate = parseFloat(summaryData["Taxa de Crescimento"]);
            
            // Calculate CTS score
            const ctsScore = Math.min(Math.max((totalAdmins + growthRate) / 10, 0), 10);
            
            // Render CTS chart
            const ctsChartCtx = document.getElementById('cts-chart').getContext('2d');
            
            // Destroy previous chart instance if exists
            if (ctsChart) {
                ctsChart.destroy();
            }
            
            ctsChart = new Chart(ctsChartCtx, {
                type: 'bar',
                data: {
                    labels: ['Pontuação de CTS'],
                    datasets: [{
                        label: 'Pontuação',
                        data: [ctsScore],
                        backgroundColor: '#3b82f6',
                        borderColor: '#2563eb',
                        borderWidth: 1,
                        borderRadius: 6,
                        barThickness: 60
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    animation: {
                        duration: 1500
                    }
                }
            });
            
            // Calculate remaining admins to reach goal of 50
            const remainingAdmins = Math.max(0, 50 - totalAdmins);
            
            // Render Admins chart
            const adminsChartCtx = document.getElementById('admins-chart').getContext('2d');
            
            // Destroy previous chart instance if exists
            if (adminsChart) {
                adminsChart.destroy();
            }
            
            adminsChart = new Chart(adminsChartCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Admins atingidos', 'Faltando para meta'],
                    datasets: [{
                        data: [totalAdmins, remainingAdmins],
                        backgroundColor: ['#10b981', '#ef4444'],
                        borderColor: ['#059669', '#dc2626'],
                        borderWidth: 1,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw} Administradores`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        animateScale: true,
                        duration: 2000
                    }
                }
            });
        }

        // Render users
        function renderUsers() {
            usersGrid.innerHTML = '';
            
            if (filteredUsers.length === 0) {
                usersGrid.innerHTML = `
                    <div class="empty-state col-span-full">
                        <i class="fas fa-users" style="font-size: 48px; opacity: 0.3; margin-bottom: 16px;"></i>
                        <p>Nenhum administrador encontrado.</p>
                    </div>
                `;
                return;
            }
            
            filteredUsers.forEach((user, index) => {
                const card = document.createElement('div');
                card.className = 'user-card';
                card.style.animationDelay = `${index * 0.05}s`;
                
                card.innerHTML = `
                    <h3 class="user-name">
                        <i class="fas fa-user"></i>
                        ${user.name}
                    </h3>
                    <div class="user-info">
                        <i class="fas fa-birthday-cake"></i> Idade: <span>${user.age}</span>
                    </div>
                    <div class="user-info">
                        <i class="fas fa-phone"></i> Número: <span>${user.phoneNumber}</span>
                    </div>
                    <div class="user-info">
                        <i class="fab fa-instagram"></i> Instagram: <span>${user.instagram}</span>
                    </div>
                    <div class="user-info">
                        <i class="fas fa-envelope"></i> E-mail: <span>${user.email}</span>
                    </div>
                    <div class="user-info">
                        <i class="fas fa-id-badge"></i> ID: <span>${user.id}</span>
                    </div>
                    <div class="user-actions">
                        <button class="button button-green edit-user-btn" data-id="${user.id}">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="button button-red delete-user-btn" data-id="${user.id}" data-name="${user.name}">
                            <i class="fas fa-trash-alt"></i> Excluir
                        </button>
                    </div>
                `;
                
                usersGrid.appendChild(card);
            });
            
            // Add event listeners to the edit and delete buttons
            document.querySelectorAll('.edit-user-btn').forEach(btn => {
                btn.addEventListener('click', () => openEditDialog(btn.dataset.id));
            });
            
            document.querySelectorAll('.delete-user-btn').forEach(btn => {
                btn.addEventListener('click', () => openDeleteDialog(btn.dataset.id, btn.dataset.name));
            });
        }

        // =======================
        // Search and Filter Users
        // =======================

        // Search users
        function searchUsers() {
            const query = searchInput.value.toLowerCase().trim();
            
            if (query === '') {
                filteredUsers = [...users];
                renderUsers();
                return;
            }
            
            // Show loading indicators
            searchLoading.style.display = 'block';
            loadingBar.style.display = 'block';
            
            // Use setTimeout to allow the UI to update before filtering
            setTimeout(() => {
                filteredUsers = users.filter(user => {
                    return (
                        user.id.toLowerCase().includes(query) ||
                        user.name.toLowerCase().includes(query) ||
                        user.phoneNumber.toLowerCase().includes(query) ||
                        user.instagram.toLowerCase().includes(query) ||
                        user.email.toLowerCase().includes(query)
                    );
                });
                
                renderUsers();
                
                // Hide loading indicators
                searchLoading.style.display = 'none';
                loadingBar.style.display = 'none';
            }, 300);
        }

        // =================
        // Dialog Functions
        // =================

        // Open register dialog
        function openRegisterDialog() {
            document.getElementById('register-name').value = '';
            document.getElementById('register-age').value = '';
            document.getElementById('register-phone').value = '';
            document.getElementById('register-instagram').value = '';
            document.getElementById('register-email').value = '';
            
            // Get next available ID
            const nextId = summaryData ? (summaryData["Último ID Enviado"] + 1).toString() : '1';
            document.getElementById('register-id').value = nextId;
            document.getElementById('id-suggestion').textContent = `ID Disponível: ${nextId}`;
            
            registerDialog.style.display = 'flex';
        }

        // Open edit dialog
        function openEditDialog(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            document.getElementById('edit-id').value = user.id;
            document.getElementById('edit-name').value = user.name;
            document.getElementById('edit-age').value = user.age;
            document.getElementById('edit-phone').value = user.phoneNumber;
            document.getElementById('edit-instagram').value = user.instagram;
            document.getElementById('edit-email').value = user.email;
            
            editDialog.style.display = 'flex';
        }

        // Open blacklist check dialog
        function openBlacklistDialog() {
            document.getElementById('blacklist-number').value = '';
            document.getElementById('blacklist-result').innerHTML = '';
            document.getElementById('blacklist-result').style.display = 'none';
            document.getElementById('blacklist-checking').style.display = 'none';
            
            blacklistDialog.style.display = 'flex';
        }

        // Open delete dialog
        function openDeleteDialog(userId, userName) {
            document.getElementById('delete-id').value = userId;
            document.getElementById('delete-user-name').textContent = userName;
            
            deleteDialog.style.display = 'flex';
        }

        // Open logout dialog
        function openLogoutDialog() {
            logoutDialog.style.display = 'flex';
        }

        // Close all dialogs
        function closeDialogs() {
            registerDialog.style.display = 'none';
            editDialog.style.display = 'none';
            blacklistDialog.style.display = 'none';
            deleteDialog.style.display = 'none';
            logoutDialog.style.display = 'none';
        }

        // =======================
        // User CRUD Functions
        // =======================

        // Create user
        async function createUser() {
            const name = document.getElementById('register-name').value.trim();
            const age = document.getElementById('register-age').value;
            const phoneNumber = document.getElementById('register-phone').value.trim();
            const instagram = document.getElementById('register-instagram').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const id = document.getElementById('register-id').value;
            
            if (!name) {
                showToast('Nome é obrigatório', 'error');
                return;
            }
            
            try {
                const formData = new URLSearchParams({
                    action: 'create',
                    id,
                    name,
                    age: age || '0',
                    number: phoneNumber,
                    instagram,
                    email
                });
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                // Add the new user to the local array
                users.push({
                    id,
                    name,
                    age: parseInt(age) || 0,
                    phoneNumber,
                    instagram,
                    email
                });
                
                filteredUsers = [...users];
                
                // Update the UI
                closeDialogs();
                renderUsers();
                
                // Refresh summary data
                loadSummaryData();
                
                showToast('Administrador cadastrado com sucesso', 'success');
            } catch (error) {
                console.error('Error creating user:', error);
                showToast('Erro ao cadastrar administrador', 'error');
            }
        }

        // Update user
        async function updateUser() {
            const id = document.getElementById('edit-id').value;
            const name = document.getElementById('edit-name').value.trim();
            const age = document.getElementById('edit-age').value;
            const phoneNumber = document.getElementById('edit-phone').value.trim();
            const instagram = document.getElementById('edit-instagram').value.trim();
            const email = document.getElementById('edit-email').value.trim();
            
            if (!name) {
                showToast('Nome é obrigatório', 'error');
                return;
            }
            
            try {
                const formData = new URLSearchParams({
                    action: 'update',
                    id,
                    name,
                    age: age || '0',
                    number: phoneNumber,
                    instagram,
                    email
                });
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                // Update the user in the local array
                const userIndex = users.findIndex(u => u.id === id);
                if (userIndex !== -1) {
                    users[userIndex] = {
                        id,
                        name,
                        age: parseInt(age) || 0,
                        phoneNumber,
                        instagram,
                        email
                    };
                }
                
                // Update the filtered users array
                filteredUsers = searchInput.value.trim() === '' 
                    ? [...users] 
                    : filteredUsers.map(u => u.id === id ? users[userIndex] : u);
                
                // Update the UI
                closeDialogs();
                renderUsers();
                
                showToast('Usuário atualizado com sucesso', 'success');
            } catch (error) {
                console.error('Error updating user:', error);
                showToast('Erro ao atualizar usuário', 'error');
            }
        }

        // Delete user
        async function deleteUser() {
            const id = document.getElementById('delete-id').value;
            
            try {
                const formData = new URLSearchParams({
                    action: 'delete',
                    id
                });
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: formData
                });
                
                // Remove the user from the local array
                users = users.filter(u => u.id !== id);
                filteredUsers = filteredUsers.filter(u => u.id !== id);
                
                // Update the UI
                closeDialogs();
                renderUsers();
                
                // Refresh summary data
                loadSummaryData();
                
                showToast('Usuário excluído com sucesso', 'success');
            } catch (error) {
                console.error('Error deleting user:', error);
                showToast('Erro ao excluir usuário', 'error');
            }
        }

        // Check blacklist
        async function checkBlacklist() {
            const number = document.getElementById('blacklist-number').value.trim();
            
            if (!number) {
                showToast('Digite um número para pesquisa', 'error');
                return;
            }
            
            document.getElementById('blacklist-checking').style.display = 'block';
            document.getElementById('blacklist-result').style.display = 'none';
            
            try {
                // Simulating API call with a timeout
                setTimeout(() => {
                    const isInBlacklist = Math.random() > 0.5; // Random result for demo
                    
                    const resultDiv = document.getElementById('blacklist-result');
                    resultDiv.style.display = 'block';
                    
                    if (isInBlacklist) {
                        resultDiv.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
                        resultDiv.style.color = '#ef4444';
                        resultDiv.innerHTML = `
                            <i class="fas fa-exclamation-circle"></i>
                            <span>O número ${number} está na lista negra!</span>
                        `;
                    } else {
                        resultDiv.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
                        resultDiv.style.color = '#10b981';
                        resultDiv.innerHTML = `
                            <i class="fas fa-check-circle"></i>
                            <span>O número ${number} não foi encontrado na lista negra.</span>
                        `;
                    }
                    
                    document.getElementById('blacklist-checking').style.display = 'none';
                }, 1500);
            } catch (error) {
                console.error('Error checking blacklist:', error);
                document.getElementById('blacklist-checking').style.display = 'none';
                showToast('Erro ao verificar lista negra', 'error');
            }
        }

        // Download contacts as VCF
        function downloadContacts() {
            if (users.length === 0) {
                showToast('Não há contatos para baixar', 'error');
                return;
            }
            
            let vcfContent = '';
            
            users.forEach((user, index) => {
                vcfContent += 'BEGIN:VCARD\n';
                vcfContent += 'VERSION:3.0\n';
                vcfContent += `FN:ADM ${index + 1} - ${user.name}\n`;
                vcfContent += `N:${user.name};;;\n`;
                vcfContent += `TEL;TYPE=CELL:${user.phoneNumber}\n`;
                vcfContent += `EMAIL:${user.email}\n`;
                vcfContent += `NOTE:Instagram: ${user.instagram}, ID: ${user.id}, Idade: ${user.age}\n`;
                vcfContent += 'END:VCARD\n';
            });
            
            const blob = new Blob([vcfContent], { type: 'text/vcard' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            
            a.href = url;
            a.download = 'administradores.vcf';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Contatos baixados com sucesso', 'success');
        }

        // Logout
        function logout() {
            localStorage.removeItem('darkMode');
            localStorage.removeItem('profilePic');
            
            showToast('Sessão encerrada com sucesso', 'success');
            
            // Redirect after toast
            setTimeout(() => {
                window.location.href = "https://neetk.onrender.com/login";
            }, 2000);
        }

        // ===============
        // Toast Function
        // ===============

        // Show toast notification
        function showToast(message, type = 'info') {
            Swal.fire({
                text: message,
                icon: type,
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true
            });
        }

        // ======================
        // Event Listeners
        // ======================

        // Theme toggle
        themeToggle.addEventListener('click', toggleTheme);

        // Profile picture
        profileWrapper.addEventListener('click', () => profileInput.click());
        profileInput.addEventListener('change', handleProfilePicChange);

        // Logout
        logoutButton.addEventListener('click', openLogoutDialog);
        document.getElementById('logout-cancel').addEventListener('click', closeDialogs);
        document.getElementById('logout-confirm').addEventListener('click', logout);

        // Search
        searchInput.addEventListener('input', searchUsers);

        // Register dialog
        document.getElementById('register-admin-button').addEventListener('click', openRegisterDialog);
        document.getElementById('register-cancel').addEventListener('click', closeDialogs);
        document.getElementById('register-submit').addEventListener('click', createUser);

        // Edit dialog
        document.getElementById('edit-cancel').addEventListener('click', closeDialogs);
        document.getElementById('edit-submit').addEventListener('click', updateUser);

        // Blacklist dialog
        document.getElementById('blacklist-check-button').addEventListener('click', openBlacklistDialog);
        document.getElementById('blacklist-cancel').addEventListener('click', closeDialogs);
        document.getElementById('blacklist-check').addEventListener('click', checkBlacklist);

        // Delete dialog
        document.getElementById('delete-cancel').addEventListener('click', closeDialogs);
        document.getElementById('delete-confirm').addEventListener('click', deleteUser);

        // Download contacts
        document.getElementById('download-contacts-button').addEventListener('click', downloadContacts);

        // Close dialogs when clicking outside
        document.querySelectorAll('.dialog-overlay').forEach(dialog => {
            dialog.addEventListener('click', (e) => {
                if (e.target === dialog) {
                    closeDialogs();
                }
            });
        });

        // ======================
        // Initialization
        // ======================

        // Initialize the app
        function init() {
            initTheme();
            loadProfilePic();
            loadSummaryData();
            loadUsers();
            
            // Auto-refresh data every 30 seconds
            setInterval(() => {
                loadSummaryData();
                loadUsers();
            }, 30000);
        }

        // Run initialization when DOM is ready
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
